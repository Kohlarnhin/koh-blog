{"meta":{"version":1,"warehouse":"4.0.2"},"models":{"Asset":[{"_id":"themes/ayer/source/404.html","path":"404.html","modified":1,"renderable":1},{"_id":"themes/ayer/source/favicon.ico","path":"favicon.ico","modified":1,"renderable":1},{"_id":"themes/ayer/source/css/clipboard.styl","path":"css/clipboard.styl","modified":1,"renderable":1},{"_id":"themes/ayer/source/css/custom.styl","path":"css/custom.styl","modified":1,"renderable":1},{"_id":"themes/ayer/source/dist/main.js","path":"dist/main.js","modified":1,"renderable":1},{"_id":"themes/ayer/source/dist/main.css","path":"dist/main.css","modified":1,"renderable":1},{"_id":"themes/ayer/source/images/404.jpg","path":"images/404.jpg","modified":1,"renderable":1},{"_id":"themes/ayer/source/images/alipay.jpg","path":"images/alipay.jpg","modified":1,"renderable":1},{"_id":"themes/ayer/source/images/ayer-side.svg","path":"images/ayer-side.svg","modified":1,"renderable":1},{"_id":"themes/ayer/source/images/ayer.png","path":"images/ayer.png","modified":1,"renderable":1},{"_id":"themes/ayer/source/images/ayer.svg","path":"images/ayer.svg","modified":1,"renderable":1},{"_id":"themes/ayer/source/images/beian.png","path":"images/beian.png","modified":1,"renderable":1},{"_id":"themes/ayer/source/images/cover1.jpg","path":"images/cover1.jpg","modified":1,"renderable":1},{"_id":"themes/ayer/source/images/cover2.jpg","path":"images/cover2.jpg","modified":1,"renderable":1},{"_id":"themes/ayer/source/images/cover3.jpg","path":"images/cover3.jpg","modified":1,"renderable":1},{"_id":"themes/ayer/source/images/cover4.jpg","path":"images/cover4.jpg","modified":1,"renderable":1},{"_id":"themes/ayer/source/images/cover5.jpg","path":"images/cover5.jpg","modified":1,"renderable":1},{"_id":"themes/ayer/source/images/cover6.jpg","path":"images/cover6.jpg","modified":1,"renderable":1},{"_id":"themes/ayer/source/images/cover7.jpg","path":"images/cover7.jpg","modified":1,"renderable":1},{"_id":"themes/ayer/source/images/forkme.png","path":"images/forkme.png","modified":1,"renderable":1},{"_id":"themes/ayer/source/images/gitee.png","path":"images/gitee.png","modified":1,"renderable":1},{"_id":"themes/ayer/source/images/github.png","path":"images/github.png","modified":1,"renderable":1},{"_id":"themes/ayer/source/images/hexo-tag-chart.png","path":"images/hexo-tag-chart.png","modified":1,"renderable":1},{"_id":"themes/ayer/source/images/mouse.cur","path":"images/mouse.cur","modified":1,"renderable":1},{"_id":"themes/ayer/source/images/hexo.png","path":"images/hexo.png","modified":1,"renderable":1},{"_id":"themes/ayer/source/images/sponsor.jpg","path":"images/sponsor.jpg","modified":1,"renderable":1},{"_id":"themes/ayer/source/images/wechat.jpg","path":"images/wechat.jpg","modified":1,"renderable":1},{"_id":"themes/ayer/source/js/clickBoom1.js","path":"js/clickBoom1.js","modified":1,"renderable":1},{"_id":"themes/ayer/source/js/busuanzi-2.3.pure.min.js","path":"js/busuanzi-2.3.pure.min.js","modified":1,"renderable":1},{"_id":"themes/ayer/source/js/clickBoom2.js","path":"js/clickBoom2.js","modified":1,"renderable":1},{"_id":"themes/ayer/source/js/clickLove.js","path":"js/clickLove.js","modified":1,"renderable":1},{"_id":"themes/ayer/source/js/dz.js","path":"js/dz.js","modified":1,"renderable":1},{"_id":"themes/ayer/source/js/jquery-3.6.0.min.js","path":"js/jquery-3.6.0.min.js","modified":1,"renderable":1},{"_id":"themes/ayer/source/js/search.js","path":"js/search.js","modified":1,"renderable":1},{"_id":"themes/ayer/source/js/tocbot.min.js","path":"js/tocbot.min.js","modified":1,"renderable":1},{"_id":"themes/ayer/source/js/lazyload.min.js","path":"js/lazyload.min.js","modified":1,"renderable":1},{"_id":"themes/ayer/source/css/fonts/remixicon.css","path":"css/fonts/remixicon.css","modified":1,"renderable":1},{"_id":"themes/ayer/source/css/fonts/remixicon.eot","path":"css/fonts/remixicon.eot","modified":1,"renderable":1},{"_id":"themes/ayer/source/css/fonts/remixicon.ttf","path":"css/fonts/remixicon.ttf","modified":1,"renderable":1},{"_id":"themes/ayer/source/css/fonts/remixicon.svg","path":"css/fonts/remixicon.svg","modified":1,"renderable":1},{"_id":"themes/ayer/source/css/fonts/remixicon.woff2","path":"css/fonts/remixicon.woff2","modified":1,"renderable":1},{"_id":"themes/ayer/source/css/fonts/remixicon.woff","path":"css/fonts/remixicon.woff","modified":1,"renderable":1}],"Cache":[{"_id":"source/categories/index.md","hash":"42e8208d181d111422a3105d4f99a47398324828","modified":1672733094412},{"_id":"source/_posts/k8s和kubesphere搭建.md","hash":"168e7b8cdb9c75bf2b50d85d9a3a7acc729c8c5b","modified":1672733077660},{"_id":"themes/ayer/.gitattributes","hash":"0a06233e35936dfb7efe1472917805056a159fa2","modified":1662185562000},{"_id":"themes/ayer/.gitignore","hash":"b18b650c857471724778c1450c446b93192d8b0e","modified":1662185562000},{"_id":"themes/ayer/.stylintrc","hash":"557d72b4dcd86e66fc5c688595288cf06b12ce6c","modified":1662185562000},{"_id":"themes/ayer/.npmignore","hash":"1744752b89ad4271612ff0a03232ed56484e592c","modified":1662185562000},{"_id":"themes/ayer/_config.yml","hash":"267fbe4d9417f4e71d22869d550842dcb051ebfa","modified":1672734448714},{"_id":"themes/ayer/index.js","hash":"19292aa9df268dbab8ac51a2a3aa7a20ac1eb00a","modified":1662185562000},{"_id":"themes/ayer/README.md","hash":"13e97f83e2a85cbb809e97cd16c305b64c8851a1","modified":1662185562000},{"_id":"themes/ayer/.travis.yml","hash":"e8e8c5607528fd55ac11dde00b6186d3ea52fdef","modified":1662185562000},{"_id":"themes/ayer/logo.png","hash":"16fbb131601570b21890a922cd6e596691ccff42","modified":1662185562000},{"_id":"themes/ayer/package.json","hash":"5424c8abe79bf3dde54dfbf64f6814b31379f97b","modified":1672734656664},{"_id":"themes/ayer/move_config.js","hash":"e310bdb9a8738e506e53a40bd3cd895008d4cd61","modified":1662185562000},{"_id":"themes/ayer/LICENSE","hash":"e39066a824465f4d6ad5ce7903b4d683d38d2b6c","modified":1662185562000},{"_id":"themes/ayer/.github/FUNDING.yml","hash":"186f05c1b9509a4ad957490004ff37462aedd984","modified":1662185562000},{"_id":"themes/ayer/rollup.config.js","hash":"13b61821acd9fc27131a34853037184b94ae8577","modified":1662185562000},{"_id":"themes/ayer/languages/de.yml","hash":"cdeed93d1eb4e65195aaf97d8c517e97106ddfd5","modified":1662185562000},{"_id":"themes/ayer/.github/config.yml","hash":"0300d3458011582f8158a3588912dac4cb3ec21a","modified":1662185562000},{"_id":"themes/ayer/languages/en.yml","hash":"7e16c460c2c3d953c3bdebdef471ea747812b7a1","modified":1662185562000},{"_id":"themes/ayer/languages/default.yml","hash":"7e16c460c2c3d953c3bdebdef471ea747812b7a1","modified":1662185562000},{"_id":"themes/ayer/languages/es.yml","hash":"a3e8d81b99f62f86b3f34708253070b8806b31c8","modified":1662185562000},{"_id":"themes/ayer/languages/ja.yml","hash":"d2ccb7ac8c9ff2ee721843741bb30b019d0a8083","modified":1662185562000},{"_id":"themes/ayer/languages/nl.yml","hash":"2c289e97000c0c67636d96895aaa801c8abec0d4","modified":1662185562000},{"_id":"themes/ayer/languages/ko.yml","hash":"7dc54c2db864e5b725b55e201030e92acc1c422e","modified":1662185562000},{"_id":"themes/ayer/languages/fr.yml","hash":"4a3cb84884988624943c6b0f8c1754da34943092","modified":1662185562000},{"_id":"themes/ayer/languages/pt.yml","hash":"b137b9aead0dc4e2c2d9217ceb270460e41f5cb3","modified":1662185562000},{"_id":"themes/ayer/languages/no.yml","hash":"f8d7294f0d73ec35c37c050462cb725ea25a0fcc","modified":1662185562000},{"_id":"themes/ayer/languages/ru.yml","hash":"cdce73598db1aefb17b1c91658cfa4c906b98e24","modified":1662185562000},{"_id":"themes/ayer/layout/archive.ejs","hash":"2703b07cc8ac64ae46d1d263f4653013c7e1666b","modified":1662185562000},{"_id":"themes/ayer/languages/zh-CN.yml","hash":"68400b1859e58cba03b05020ac8f47b807933027","modified":1662185562000},{"_id":"themes/ayer/languages/zh-TW.yml","hash":"edb2654bdb684fe0f21e8d6c841496c3506006ed","modified":1662185562000},{"_id":"themes/ayer/languages/vi.yml","hash":"7d019ee795816a6a030a039d8238b71be04098fd","modified":1662185562000},{"_id":"themes/ayer/layout/categories.ejs","hash":"c40f84aacdf7d33cfcb4eb9f78f331dad699abff","modified":1662185562000},{"_id":"themes/ayer/layout/page.ejs","hash":"a9a48ae63f5d68a36382951166fdd6e482b901f1","modified":1662185562000},{"_id":"themes/ayer/layout/index.ejs","hash":"77347cbb8635611d8b1fb84bde75f9dedaf8632d","modified":1662185562000},{"_id":"themes/ayer/layout/layout.ejs","hash":"84864bd6b4fc92bdd0a8ccba491fe490a8ecbf9b","modified":1662185562000},{"_id":"themes/ayer/layout/friends.ejs","hash":"18382cd4429588e58bf046beacaed06704832fe3","modified":1662185562000},{"_id":"themes/ayer/scripts/default_config.js","hash":"70d6ee032d75410d540b6789b5949739a47f0125","modified":1662185562000},{"_id":"themes/ayer/layout/plain-page.ejs","hash":"39cce1936f5f0e2feb924a7af2f52a631d81b84f","modified":1662185562000},{"_id":"themes/ayer/layout/tags.ejs","hash":"88b34dd8d7b1e64fa27aa6ed72af996cf6700809","modified":1662185562000},{"_id":"themes/ayer/source/404.html","hash":"155c674062d18ab392fa47ac837dd7afe77f8a56","modified":1662185562000},{"_id":"themes/ayer/layout/post.ejs","hash":"a9a48ae63f5d68a36382951166fdd6e482b901f1","modified":1662185562000},{"_id":"themes/ayer/source/favicon.ico","hash":"473ba682e828a7e34f24fae320e77b6bed4260c7","modified":1662185562000},{"_id":"themes/ayer/source-src/main.js","hash":"13c57a2cec878217a5a3ee9afb6705d4c3cc0d3c","modified":1662185562000},{"_id":"themes/ayer/.github/ISSUE_TEMPLATE/bug-report.md","hash":"92978683b5c4c98c413989fe56acc775f0162ddf","modified":1662185562000},{"_id":"themes/ayer/layout/_partial/ads.ejs","hash":"d36962c66e3653aa94cc428731dd43a7ea4f979d","modified":1662185562000},{"_id":"themes/ayer/.github/ISSUE_TEMPLATE/feature-request.md","hash":"d8d4951f5f3f08660dc4ba6d1a44eb56d3b094b4","modified":1662185562000},{"_id":"themes/ayer/.github/workflows/npmpublish.yml","hash":"3ff1b124e532465ba14475f3ea8f4ec5d8856028","modified":1662185562000},{"_id":"themes/ayer/layout/_partial/after-footer.ejs","hash":"17ccda6fb61f1b6df94d23db936665c00a29a85b","modified":1662185562000},{"_id":"themes/ayer/.github/ISSUE_TEMPLATE/other.md","hash":"94ee4baf54bfa786228aafc0f2f8c17076a99a0b","modified":1662185562000},{"_id":"themes/ayer/.github/ISSUE_TEMPLATE/question.md","hash":"6cb78a96b83ed228fb3c956f2dbc654220335ec0","modified":1662185562000},{"_id":"themes/ayer/layout/_partial/archive.ejs","hash":"a56c8905987fa86657a9f081a89c12e5a5a5df54","modified":1662185562000},{"_id":"themes/ayer/layout/_partial/archive-post.ejs","hash":"9be7173badcca6582c1136204adb3aa432aada21","modified":1662185562000},{"_id":"themes/ayer/layout/_partial/article.ejs","hash":"3895f24a1ba9ef5d4a024b1f45a5f30bff9f9c7c","modified":1662185562000},{"_id":"themes/ayer/layout/_partial/ayer.ejs","hash":"01ca257dde90dcadf1288a641401f6cf21a0ad43","modified":1662185562000},{"_id":"themes/ayer/layout/_partial/broadcast.ejs","hash":"c228fa93bcf2f8403729342854211ea976df9a9f","modified":1662185562000},{"_id":"themes/ayer/layout/_partial/baidu-analytics.ejs","hash":"f0e6e88f9f7eb08b8fe51449a8a3016273507924","modified":1662185562000},{"_id":"themes/ayer/layout/_partial/google-analytics.ejs","hash":"ca81abe75c80ab32d6b6c4fe65de8e74df07bef3","modified":1662185562000},{"_id":"themes/ayer/layout/_partial/float-btns.ejs","hash":"43ba0cd1f9e898bcbd873b1e9a2d47249d6aaf77","modified":1662185562000},{"_id":"themes/ayer/layout/_partial/footer.ejs","hash":"1407c1043fdb628642de9d2990921d92a3c2f078","modified":1662185562000},{"_id":"themes/ayer/layout/_partial/head.ejs","hash":"61100fe248a744fab5dc71fb610992cbeff27e54","modified":1662185562000},{"_id":"themes/ayer/layout/_partial/katex.ejs","hash":"752666b28d5caed5e7d82d697d7546461e451d6f","modified":1662185562000},{"_id":"themes/ayer/layout/_partial/modal.ejs","hash":"cf441365eff1f8143e3c9ae54954d0ebe0a358e5","modified":1662185562000},{"_id":"themes/ayer/layout/_partial/lock.ejs","hash":"bbb00715c204197e7790d08be9a29afe5976146e","modified":1662185562000},{"_id":"themes/ayer/layout/_partial/music.ejs","hash":"cde5caf73f120b1300ec7539bbf675597688c734","modified":1662185562000},{"_id":"themes/ayer/scripts/events/index.js","hash":"2c84d99e881f5cd1ee8a406b595a4365f3aea41e","modified":1662185562000},{"_id":"themes/ayer/layout/_partial/viewer.ejs","hash":"7bcde0d6384819fd4c975a6e6e24e0919fbb1593","modified":1662185562000},{"_id":"themes/ayer/layout/_partial/mathjax.ejs","hash":"d38a59e2316b8a9c233c2f41edc2a03eab2c0a2e","modified":1662185562000},{"_id":"themes/ayer/layout/_partial/sidebar.ejs","hash":"e3b411aef6e5f25f6c5c66b93d653ef70da8d4af","modified":1662185562000},{"_id":"themes/ayer/scripts/filters/index.js","hash":"e435b782178da75656f9616c7af564fb9ff0de50","modified":1662185562000},{"_id":"themes/ayer/scripts/filters/meta_generator.js","hash":"58f4c93d22e4eb9743915223444335fb6fe06d21","modified":1662185562000},{"_id":"themes/ayer/scripts/helpers/ayer-plus-vendors.js","hash":"7b3df58faaa875d17afbf74ddef5601116f2ce3d","modified":1662185562000},{"_id":"themes/ayer/scripts/helpers/wordcount.js","hash":"f9c8fceb2130929b8f11e22b1c3476c99d1574a8","modified":1662185562000},{"_id":"themes/ayer/scripts/lib/core.js","hash":"7908a82a86d63f35c6f785cacb1cfaf99ae7e0f9","modified":1662185562000},{"_id":"themes/ayer/scripts/utils/join-path.js","hash":"629e7deb3955f750c1cfa6fc773f412e020fcef4","modified":1662185562000},{"_id":"themes/ayer/source/css/clipboard.styl","hash":"017f9b628806eeb199da2e77485cd9ac8e2117b3","modified":1662185562000},{"_id":"themes/ayer/source/css/custom.styl","hash":"56276abe6cd7cbf49fbf4fd4c986733188374160","modified":1662185562000},{"_id":"themes/ayer/scripts/utils/object.js","hash":"649457796374c79e49a19bd541e4ad8e78fe8995","modified":1662185562000},{"_id":"themes/ayer/source/dist/main.js","hash":"436093b4310b4656fb1e60ae946d04b85d6b1fa5","modified":1662185562000},{"_id":"themes/ayer/source/dist/main.css","hash":"1f49cde949291ed86277d30721a7e728a4f8671a","modified":1662185562000},{"_id":"themes/ayer/source/images/404.jpg","hash":"4f36a8d378712427cded03f5166949f5e0ba754c","modified":1662185562000},{"_id":"themes/ayer/source/images/ayer-side.svg","hash":"ad004ce7a873de0f91774f3d5923e010396a07bd","modified":1662185562000},{"_id":"themes/ayer/source/images/ayer.png","hash":"0466c05244273f645d239cd27513bfa3c50308aa","modified":1662185562000},{"_id":"themes/ayer/source/images/ayer.svg","hash":"379c3307f97c364718a1dbc1e52fb14de12eb11a","modified":1662185562000},{"_id":"themes/ayer/source/images/beian.png","hash":"29c400bc3b89f6085766dac4e0330ded5cb73d52","modified":1662185562000},{"_id":"themes/ayer/source/images/forkme.png","hash":"99c3e21a169421e4f249befb428396c729863a75","modified":1662185562000},{"_id":"themes/ayer/source/images/cover7.jpg","hash":"573bff6899d2d9c5bcba0dc9c60cd1ec9eb8b029","modified":1662185562000},{"_id":"themes/ayer/source/images/gitee.png","hash":"250da578e0bd1393f22737f58d0fbae95119e527","modified":1662185562000},{"_id":"themes/ayer/source/images/hexo-tag-chart.png","hash":"6db432aae30556d151c2fd2c1d11015d9309ba81","modified":1662185562000},{"_id":"themes/ayer/source/images/github.png","hash":"4853ff37f9d859e7faa77675632a73f8ef089a15","modified":1662185562000},{"_id":"themes/ayer/source/images/hexo.png","hash":"6b0315fba8a8f496491079b361e2fb5253e19a04","modified":1662185562000},{"_id":"themes/ayer/source/images/mouse.cur","hash":"c1ffe93a6ba0d25ef06bb3d097560762e4807593","modified":1662185562000},{"_id":"themes/ayer/source/images/sponsor.jpg","hash":"5b5e4498177b369a7eca7ab2b1d0710b8690e21d","modified":1662185562000},{"_id":"themes/ayer/source-src/css/_darkmode.styl","hash":"219753a5cf40cfbd557fbde01a71f589e6de4327","modified":1662185562000},{"_id":"themes/ayer/source-src/css/_mixins.styl","hash":"6959409df2dd0a1ca05be0c0e9b2a884efdfb82d","modified":1662185562000},{"_id":"themes/ayer/source-src/js/ayer.js","hash":"1388c227857f49084c057d10eff62b3c6edff5dd","modified":1672803889659},{"_id":"themes/ayer/source-src/css/_normalize.styl","hash":"630e719b9e805a26182a37152435d4787c0f1734","modified":1662185562000},{"_id":"themes/ayer/source-src/css/_extend.styl","hash":"8dedef428b6ac7d629e1d1f6039b0f60dacc4c5e","modified":1662185562000},{"_id":"themes/ayer/source-src/css/_remixicon.styl","hash":"ce395318edf69766fe11161c4587a97f84521d85","modified":1662185562000},{"_id":"themes/ayer/source-src/css/_variables.styl","hash":"910dd0682971a616e1610daec23e7ff5a556df98","modified":1662185562000},{"_id":"themes/ayer/source-src/js/share.js","hash":"7edce2efe23e75e29765201dc8b00fd2a5b5c9d2","modified":1662185562000},{"_id":"themes/ayer/source/js/clickBoom1.js","hash":"afd4a981d3a56c40898248152009d478a3cd0d1e","modified":1662185562000},{"_id":"themes/ayer/source/js/dz.js","hash":"079ae73e2e396c2e00919a50a6fe0d064f99303a","modified":1662185562000},{"_id":"themes/ayer/source/js/busuanzi-2.3.pure.min.js","hash":"6e41f31100ae7eb3a6f23f2c168f6dd56e7f7a9a","modified":1662185562000},{"_id":"themes/ayer/source/js/clickBoom2.js","hash":"d3fe9e8c7046bec9745628f61d61e4102171ac2b","modified":1662185562000},{"_id":"themes/ayer/source/js/clickLove.js","hash":"a35dfb7ff19796c005ee30b55fd95e39d6d59a89","modified":1662185562000},{"_id":"themes/ayer/source-src/css/style.styl","hash":"3941939bdb95297488d19e3e3716d5925b6eed44","modified":1662185562000},{"_id":"themes/ayer/source/js/search.js","hash":"118be0e0918532ac1225f62e1a0a6f0673e0b173","modified":1662185562000},{"_id":"themes/ayer/layout/_partial/post/albums.ejs","hash":"cfb16c9dda7a609776a28702e0c3854a52e422a7","modified":1662185562000},{"_id":"themes/ayer/source/js/tocbot.min.js","hash":"bae97e8a24a05a99335f8e725641c8ca9c50502a","modified":1662185562000},{"_id":"themes/ayer/source/js/lazyload.min.js","hash":"b801b3946fb9b72e03512c0663458e140e1fa77b","modified":1662185562000},{"_id":"themes/ayer/layout/_partial/post/author.ejs","hash":"57738b222e00bbd110be65d300d8bed34d73b3ea","modified":1662185562000},{"_id":"themes/ayer/layout/_partial/post/category.ejs","hash":"85f0ebeceee1c32623bfa1e4170dbe1e34442fea","modified":1662185562000},{"_id":"themes/ayer/layout/_partial/post/clipboard.ejs","hash":"9f86e3d222555181a3e631a09bcdabdd44507cb8","modified":1662185562000},{"_id":"themes/ayer/layout/_partial/post/busuanzi.ejs","hash":"4647234e5c4529d754c9d0fc53ca9e9205f21443","modified":1662185562000},{"_id":"themes/ayer/layout/_partial/post/date.ejs","hash":"6197802873157656e3077c5099a7dda3d3b01c29","modified":1662185562000},{"_id":"themes/ayer/layout/_partial/post/gitalk.ejs","hash":"bc540478d35780e142b069ba2adafd5d5ce8a7b0","modified":1662185562000},{"_id":"themes/ayer/layout/_partial/post/gallery.ejs","hash":"5f8487fe7bed9a09001c6655244ff35f583cf1eb","modified":1662185562000},{"_id":"themes/ayer/layout/_partial/post/justifiedGallery.ejs","hash":"4a21fd3d7335ffcd0661036fee81a927c125e2e2","modified":1662185562000},{"_id":"themes/ayer/layout/_partial/post/nav.ejs","hash":"e59198918e92ef92156aeefbf6023584ac1cae64","modified":1662185562000},{"_id":"themes/ayer/layout/_partial/post/search.ejs","hash":"2c9d19d1685e834aa2020998da2a2d259ce9b9ff","modified":1662185562000},{"_id":"themes/ayer/layout/_partial/post/share.ejs","hash":"0a364766931f48df60b7c92fec8fde1067a93e00","modified":1662185562000},{"_id":"themes/ayer/layout/_partial/post/tag.ejs","hash":"2fcb0bf9c8847a644167a27824c9bb19ac74dd14","modified":1662185562000},{"_id":"themes/ayer/layout/_partial/post/title.ejs","hash":"3b076a65b9847cd6e0d424f5c2874046ef51d4d9","modified":1662185562000},{"_id":"themes/ayer/layout/_partial/post/topping.ejs","hash":"fea793e132f627a8148059a9aee8bc33550506d1","modified":1662185562000},{"_id":"themes/ayer/layout/_partial/post/twikoo.ejs","hash":"63bc5c056b2db2aca479705fc94eaa7fd26a7976","modified":1662185562000},{"_id":"themes/ayer/layout/_partial/post/tocbot.ejs","hash":"9898b0dd9237e21908ba40292a8a9f947bed44d2","modified":1662185562000},{"_id":"themes/ayer/layout/_partial/post/valine.ejs","hash":"369396d0c5b669df7a26df95f7a1b8a52f4eea65","modified":1662185562000},{"_id":"themes/ayer/layout/_partial/post/word.ejs","hash":"4b8e8455709debd73fba6bf3aad63378c4156dc1","modified":1662185562000},{"_id":"themes/ayer/scripts/events/lib/hello.js","hash":"2ed130e5e1c2bc021be8d755f34c4fcf61a60121","modified":1662185562000},{"_id":"themes/ayer/scripts/events/lib/merge-configs.js","hash":"54836a1b41ebb32acc41839f53e1892779f66bb2","modified":1662185562000},{"_id":"themes/ayer/source-src/css/_partial/albums.styl","hash":"0659d5f7469f24a415354ff767d949926465d515","modified":1662185562000},{"_id":"themes/ayer/source-src/css/_partial/archive.styl","hash":"3044bf059522e79a726265c9a2f603ec8dc4222d","modified":1662185562000},{"_id":"themes/ayer/source-src/css/_partial/ads.styl","hash":"d4be39f60a81dd0e5bdd49671e7308deddc572de","modified":1662185562000},{"_id":"themes/ayer/source-src/css/_partial/apple.styl","hash":"e06dce604cc58ec39d677e4e59910c2725684901","modified":1662185562000},{"_id":"themes/ayer/source-src/css/_partial/article.styl","hash":"94342884feac98e5ef58c9bd2781fc8f35220c1c","modified":1662185562000},{"_id":"themes/ayer/source-src/css/_partial/ayer.styl","hash":"712cb4d8f3cef18dc33281bd8e9b6879efdb1687","modified":1662185562000},{"_id":"themes/ayer/source-src/css/_partial/articles.styl","hash":"39a0bc6c5cf85f0527d6ee81f6feebce8550c1dd","modified":1662185562000},{"_id":"themes/ayer/source-src/css/_partial/float.styl","hash":"d888df89a172e4c8119cb8740fc1eae1a9539157","modified":1662185562000},{"_id":"themes/ayer/source-src/css/_partial/categories.styl","hash":"3b11d0c6c4439b0856ba81c50bd8867d5bb081da","modified":1662185562000},{"_id":"themes/ayer/source-src/css/_partial/footer.styl","hash":"1a4576c38ef19834a4d0a8ac887e7b55d21f2f13","modified":1662185562000},{"_id":"themes/ayer/source-src/css/_partial/friends.styl","hash":"9dd116846c92daee1c8f80b79cab231613b164b2","modified":1662185562000},{"_id":"themes/ayer/source-src/css/_partial/gallery.styl","hash":"7bdc2c9fb4971dbd7511c5cbb69bd611f20db591","modified":1662185562000},{"_id":"themes/ayer/source-src/css/_partial/gitalk.styl","hash":"3706eef2e0541493f1679a30241d279e29dfdc17","modified":1662185562000},{"_id":"themes/ayer/source-src/css/_partial/lists.styl","hash":"da8a82a48852411c10e279dfee43038d46f4f273","modified":1662185562000},{"_id":"themes/ayer/source-src/css/_partial/layout.styl","hash":"b81d13334cf39941792dff0e3af393fb7b8cc214","modified":1662185562000},{"_id":"themes/ayer/source-src/css/_partial/justifiedGallery.styl","hash":"f2f43ae9831c3df017b35c68caa94f5eb911f697","modified":1662185562000},{"_id":"themes/ayer/source-src/css/_partial/mobile.styl","hash":"adc83b19e793491b1c6ea0fd8b46cd9f32e592fc","modified":1662185562000},{"_id":"themes/ayer/source-src/css/_partial/navbar.styl","hash":"da34b6125de01938d11de6ad3c0fed2c75faf40a","modified":1662185562000},{"_id":"themes/ayer/source-src/css/_partial/pace.styl","hash":"bde7bf3577c66a3ac829410d52fa2144212282ef","modified":1662185562000},{"_id":"themes/ayer/source-src/css/_partial/highlight.styl","hash":"e894b3a1aff76e84137e1e6db59a75afd0a53f52","modified":1662185562000},{"_id":"themes/ayer/source-src/css/_partial/reward.styl","hash":"a8a069ea34a0fd043832890db5341405e9f462cd","modified":1662185562000},{"_id":"themes/ayer/source-src/css/_partial/search.styl","hash":"f81076fc6d4a83be3371bcb79ab54d88e2605714","modified":1662185562000},{"_id":"themes/ayer/source-src/css/_partial/sidebar.styl","hash":"600c70f1de82da5223af290d47a583f9c379d188","modified":1662185562000},{"_id":"themes/ayer/source-src/css/_partial/tag.styl","hash":"87df748185edfba222c3f9a4b9ef8eee0e8e5ad3","modified":1662185562000},{"_id":"themes/ayer/source-src/css/_partial/share.styl","hash":"9ce2dd3ffdc4e170dfcb975a7158f913bc40b8d8","modified":1662185562000},{"_id":"themes/ayer/source-src/css/_partial/tocbot.styl","hash":"007bca390ec685349add74e033ff2cb90a1701bc","modified":1662185562000},{"_id":"themes/ayer/source-src/css/_partial/totop.styl","hash":"9e9d8dc167ed2c332e4520cbf41244c34c1ebf64","modified":1662185562000},{"_id":"themes/ayer/source/images/alipay.jpg","hash":"8f5409e29764fca573f1d274003910aa3c919de1","modified":1662185562000},{"_id":"themes/ayer/source/images/cover2.jpg","hash":"f61dd08c95327468c5f6bc5175eff68d00f05b46","modified":1662185562000},{"_id":"themes/ayer/source/images/wechat.jpg","hash":"93a362574a8498e75dca469b7bceb0b321fda387","modified":1662185562000},{"_id":"themes/ayer/source/js/jquery-3.6.0.min.js","hash":"b82d238d4e31fdf618bae8ac11a6c812c03dd0d4","modified":1662185562000},{"_id":"themes/ayer/source/css/fonts/remixicon.css","hash":"be1956502b9cf5081091ff78d7f11cd7ea733be8","modified":1662185562000},{"_id":"themes/ayer/source/css/fonts/remixicon.woff2","hash":"d83e667e2d8583bcd2d97b4ebe13ff1f147b947c","modified":1662185562000},{"_id":"themes/ayer/source/css/fonts/remixicon.woff","hash":"8d6a423fd373c0a1f45b927d37f8f932aaea21ec","modified":1662185562000},{"_id":"themes/ayer/source/images/cover6.jpg","hash":"a5b8a5dddff2607fee5fccf5fdef3b214a8468cc","modified":1662185562000},{"_id":"themes/ayer/screenshots/hexo-theme-ayer.png","hash":"4111670e622ce09837b6b9cc641782af75805079","modified":1662185562000},{"_id":"themes/ayer/source/images/cover1.jpg","hash":"e019fbed6158ae3e4ec3d255b41bddc1afcbfa90","modified":1662185562000},{"_id":"themes/ayer/source/images/cover3.jpg","hash":"7b4e7c9ce19ce5d5c1588b2567e88ecbb04370af","modified":1662185562000},{"_id":"themes/ayer/source/css/fonts/remixicon.ttf","hash":"7eba83fb4482a63f3b338ccb6dca312e8e95db7f","modified":1662185562000},{"_id":"themes/ayer/source/css/fonts/remixicon.eot","hash":"7e929b884b2201250fc49e8e79c3aba6cd9e4482","modified":1662185562000},{"_id":"themes/ayer/source/images/cover4.jpg","hash":"77040e609d2f1c60e00a8e47cb95b25bf7ff5b9c","modified":1662185562000},{"_id":"themes/ayer/source/images/cover5.jpg","hash":"1a2d6182d94b015a45fe4bf8e8a239dfcc0ef776","modified":1662185562000},{"_id":"themes/ayer/source/css/fonts/remixicon.svg","hash":"94144debfb5761d37d79336a10ef674f82baec1b","modified":1662185562000},{"_id":"public/categories/index.html","hash":"af4f4b6644570b51ba2167510adc8167cec9a745","modified":1672810183571},{"_id":"public/archives/index.html","hash":"f1fa909ad958d7f671888e27c812b03ce78c5f70","modified":1672810183571},{"_id":"public/archives/2023/index.html","hash":"2df0ce5bc81209bd33f25a6af5c770c0096679e7","modified":1672810183571},{"_id":"public/archives/2023/01/index.html","hash":"6737cb7f004e66a333b560985533b04d1dd20143","modified":1672810183571},{"_id":"public/categories/k8s/index.html","hash":"1802927aa820a34a5d7218320ab3599cd2415ea8","modified":1672810183571},{"_id":"public/2023/01/03/k8s和kubesphere搭建/index.html","hash":"0305d46117c2b85aca8185d52e025acb615ddead","modified":1672810183571},{"_id":"public/index.html","hash":"0c2b24e9cc5bc837dd70a6acfa94357b58af2e64","modified":1672810183571},{"_id":"public/favicon.ico","hash":"473ba682e828a7e34f24fae320e77b6bed4260c7","modified":1672810183571},{"_id":"public/images/ayer-side.svg","hash":"ad004ce7a873de0f91774f3d5923e010396a07bd","modified":1672810183571},{"_id":"public/images/404.jpg","hash":"4f36a8d378712427cded03f5166949f5e0ba754c","modified":1672810183571},{"_id":"public/images/ayer.png","hash":"0466c05244273f645d239cd27513bfa3c50308aa","modified":1672810183571},{"_id":"public/images/ayer.svg","hash":"379c3307f97c364718a1dbc1e52fb14de12eb11a","modified":1672810183571},{"_id":"public/images/beian.png","hash":"29c400bc3b89f6085766dac4e0330ded5cb73d52","modified":1672810183571},{"_id":"public/images/cover7.jpg","hash":"573bff6899d2d9c5bcba0dc9c60cd1ec9eb8b029","modified":1672810183571},{"_id":"public/images/forkme.png","hash":"99c3e21a169421e4f249befb428396c729863a75","modified":1672810183571},{"_id":"public/images/gitee.png","hash":"250da578e0bd1393f22737f58d0fbae95119e527","modified":1672810183571},{"_id":"public/images/github.png","hash":"4853ff37f9d859e7faa77675632a73f8ef089a15","modified":1672810183571},{"_id":"public/images/hexo-tag-chart.png","hash":"6db432aae30556d151c2fd2c1d11015d9309ba81","modified":1672810183571},{"_id":"public/images/mouse.cur","hash":"c1ffe93a6ba0d25ef06bb3d097560762e4807593","modified":1672810183571},{"_id":"public/images/hexo.png","hash":"6b0315fba8a8f496491079b361e2fb5253e19a04","modified":1672810183571},{"_id":"public/images/sponsor.jpg","hash":"5b5e4498177b369a7eca7ab2b1d0710b8690e21d","modified":1672810183571},{"_id":"public/images/alipay.jpg","hash":"8f5409e29764fca573f1d274003910aa3c919de1","modified":1672810183571},{"_id":"public/images/cover2.jpg","hash":"f61dd08c95327468c5f6bc5175eff68d00f05b46","modified":1672810183571},{"_id":"public/images/wechat.jpg","hash":"93a362574a8498e75dca469b7bceb0b321fda387","modified":1672810183571},{"_id":"public/css/fonts/remixicon.woff","hash":"8d6a423fd373c0a1f45b927d37f8f932aaea21ec","modified":1672810183571},{"_id":"public/css/fonts/remixicon.woff2","hash":"d83e667e2d8583bcd2d97b4ebe13ff1f147b947c","modified":1672810183571},{"_id":"public/css/clipboard.css","hash":"7990b92ffeda1b06b94b50140d9c95dac21bd418","modified":1672810183571},{"_id":"public/404.html","hash":"155c674062d18ab392fa47ac837dd7afe77f8a56","modified":1672810183571},{"_id":"public/dist/main.js","hash":"436093b4310b4656fb1e60ae946d04b85d6b1fa5","modified":1672810183571},{"_id":"public/css/custom.css","hash":"58950a4f4cd82465f85428ec17b3bc05f8153b56","modified":1672810183571},{"_id":"public/js/busuanzi-2.3.pure.min.js","hash":"6e41f31100ae7eb3a6f23f2c168f6dd56e7f7a9a","modified":1672810183571},{"_id":"public/js/clickBoom1.js","hash":"afd4a981d3a56c40898248152009d478a3cd0d1e","modified":1672810183571},{"_id":"public/js/clickBoom2.js","hash":"d3fe9e8c7046bec9745628f61d61e4102171ac2b","modified":1672810183571},{"_id":"public/js/dz.js","hash":"079ae73e2e396c2e00919a50a6fe0d064f99303a","modified":1672810183571},{"_id":"public/js/clickLove.js","hash":"9e8e79d69ad8338761272f86fe5cad0ad5e503cc","modified":1672810183571},{"_id":"public/js/search.js","hash":"118be0e0918532ac1225f62e1a0a6f0673e0b173","modified":1672810183571},{"_id":"public/js/lazyload.min.js","hash":"b801b3946fb9b72e03512c0663458e140e1fa77b","modified":1672810183571},{"_id":"public/js/tocbot.min.js","hash":"bae97e8a24a05a99335f8e725641c8ca9c50502a","modified":1672810183571},{"_id":"public/dist/main.css","hash":"1f49cde949291ed86277d30721a7e728a4f8671a","modified":1672810183571},{"_id":"public/js/jquery-3.6.0.min.js","hash":"b82d238d4e31fdf618bae8ac11a6c812c03dd0d4","modified":1672810183571},{"_id":"public/css/fonts/remixicon.css","hash":"be1956502b9cf5081091ff78d7f11cd7ea733be8","modified":1672810183571},{"_id":"public/images/cover6.jpg","hash":"a5b8a5dddff2607fee5fccf5fdef3b214a8468cc","modified":1672810183571},{"_id":"public/images/cover1.jpg","hash":"e019fbed6158ae3e4ec3d255b41bddc1afcbfa90","modified":1672810183571},{"_id":"public/images/cover3.jpg","hash":"7b4e7c9ce19ce5d5c1588b2567e88ecbb04370af","modified":1672810183571},{"_id":"public/css/fonts/remixicon.eot","hash":"7e929b884b2201250fc49e8e79c3aba6cd9e4482","modified":1672810183571},{"_id":"public/css/fonts/remixicon.ttf","hash":"7eba83fb4482a63f3b338ccb6dca312e8e95db7f","modified":1672810183571},{"_id":"public/images/cover4.jpg","hash":"77040e609d2f1c60e00a8e47cb95b25bf7ff5b9c","modified":1672810183571},{"_id":"public/images/cover5.jpg","hash":"1a2d6182d94b015a45fe4bf8e8a239dfcc0ef776","modified":1672810183571},{"_id":"public/css/fonts/remixicon.svg","hash":"94144debfb5761d37d79336a10ef674f82baec1b","modified":1672810183571}],"Category":[{"name":"k8s","_id":"clch7zqne0002gcv0gtkue90y"}],"Data":[],"Page":[{"title":"k8s","date":"2023-01-03T07:51:43.000Z","type":"categories","layout":"categories","_content":"","source":"categories/index.md","raw":"---\ntitle: k8s\ndate: 2023-01-03 15:51:43\ntype: \"categories\"\nlayout: \"categories\"\n---\n","updated":"2023-01-03T08:04:54.412Z","path":"categories/index.html","comments":1,"_id":"clch7zqn10000gcv0bwgb87tq","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"k8s和kubesphere搭建","date":"2023-01-03T08:03:00.000Z","_content":"\n### 安装containerd(每台机器)\n\n参考\n\nhttps://github.com/containerd/containerd/blob/main/docs/getting-started.md#step-1-installing-containerd\n\n#### 安装容器\n\n从https://github.com/containerd/containerd/releases 下载containerd-VERSION-OS-ARCH.tar.gz存档，并将其解压到：`/usr/local`\n\n```shell\nwget https://github.com/containerd/containerd/releases/download/v1.6.10/containerd-1.6.10-linux-amd64.tar.gz\ntar Cxzvf /usr/local containerd-1.6.10-linux-amd64.tar.gz\n```\n\n#### 通过 systemd 启动 containerd\n\nhttps://raw.githubusercontent.com/containerd/containerd/main/containerd.service\n\n```shell\nwget https://raw.githubusercontent.com/containerd/containerd/main/containerd.service\n```\n\n将下载的文件放到 /etc/systemd/system\n\n```shell\nmv containerd.service /etc/systemd/system\n```\n\n```shell\n#运行以下命令\nsystemctl daemon-reload\nsystemctl enable --now containerd\n```\n\n#### 安装 runc\n\n从[https://github.com/opencontainers/runc/releases ](https://github.com/opencontainers/runc/releases) 下载`runc.<ARCH>`二进制文件，验证其 sha256sum，并将其安装到`/usr/local/sbin/runc`\n\n```shell\nwget https://github.com/opencontainers/runc/releases/download/v1.1.4/runc.amd64\n#安装\ninstall -m 755 runc.amd64 /usr/local/sbin/runc\n```\n\n#### 安装CNI插件\n\n[从https://github.com/containernetworking/plugins/releases](https://github.com/containernetworking/plugins/releases)  下载`cni-plugins-<OS>-<ARCH>-<VERSION>.tgz`存档，并将其解压到：`/opt/cni/bin`\n\n```shell\nwget https://github.com/containernetworking/plugins/releases/download/v1.1.1/cni-plugins-linux-amd64-v1.1.1.tgz\n\nmkdir -p /opt/cni/bin\ntar Cxzvf /opt/cni/bin cni-plugins-linux-amd64-v1.1.1.tgz\n```\n\n#### 修改cgroup驱动以及自定义镜像\n\n```shell\n#生成默认配置文件\ncontainerd config default > /etc/containerd/config.toml\nvim /etc/containerd/config.toml\n```\n\n```yaml\n[plugins.\"io.containerd.grpc.v1.cri\".containerd.runtimes.runc.options]\n            ......\n            Root = \"\"\n            ShimCgroup = \"\"\n            SystemdCgroup = true # 将false改为true\n            \n[plugins.\"io.containerd.tracing.processor.v1.otlp\"]\n    endpoint = \"https://registry.aliyuncs.com\" #阿里云镜像\n    insecure = false\n    protocol = \"\"\n    \n[plugins.\"io.containerd.grpc.v1.cri\"]\n    netns_mounts_under_state_dir = false\n    restrict_oom_score_adj = false\n    #sandbox_image = \"k8s.gcr.io/pause:3.6\"\n    sandbox_image = \"registry.aliyuncs.com/google_containers/pause:3.8\" # 修改成这样\n```\n\n```shell\n#重启containerd\nsystemctl daemon-reload\nsystemctl restart containerd\n```\n\n#### 安装nerdctl\n\n```shell\n#下载精简版\nwget https://github.com/containerd/nerdctl/releases/download/v1.0.0/nerdctl-1.0.0-linux-amd64.tar.gz\n#解压到/usr/local/bin\ntar Cxzvvf /usr/local/bin nerdctl-1.0.0-linux-amd64.tar.gz\n```\n\n### 安装Kubernetes\n\n#### 设置每台机器的hostname以及hosts\n\n```shell\n#设置每个机器自己的hostname\nhostnamectl set-hostname cfc-master\nhostnamectl set-hostname cfc-node1\nhostnamectl set-hostname cfc-node2\n#hosts\nvim /etc/hosts\n\n172.16.0.4      cfc-master\n172.16.0.120    cfc-node1\n172.16.0.104    cfc-node2\n```\n\n#### 关闭swap\n\n```shell\nswapoff -a\nsed -i 's/.*swap.*/#&/' /etc/fstab\n```\n\n#### 允许 iptables 检查桥接流量\n\n```shell\n#允许 iptables 检查桥接流量\ncat <<EOF | sudo tee /etc/modules-load.d/k8s.conf\nbr_netfilter\nEOF\n\ncat <<EOF | sudo tee /etc/sysctl.d/k8s.conf\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nEOF\n#让配置生效\nsudo sysctl --system\n```\n\n#### 设置时区\n\n```shell\ntimedatectl set-timezone Asia/Shanghai\nsystemctl restart rsyslog\n```\n\n#### 配置k8s的yum源地址\n\n```shell\ncat <<EOF | sudo tee /etc/yum.repos.d/kubernetes.repo\n[kubernetes]\nname=Kubernetes\nbaseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64\nenabled=1\ngpgcheck=0\nrepo_gpgcheck=0\ngpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg\n   http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\nEOF\n```\n\n#### 安装kubelet、kubeadm、kubectl\n\n```shell\n#指定版本安装\nyum install -y kubelet-1.24.8 kubeadm-1.24.8 kubectl-1.24.8\n\n#设置启动\nsystemctl enable --now kubelet\n```\n\n#### 初始化master节点\n\n```shell\nkubeadm init \\\n--apiserver-advertise-address=172.16.0.4 \\\n--control-plane-endpoint=cfc-master \\\n--image-repository registry.aliyuncs.com/google_containers \\\n--kubernetes-version v1.24.8 \\\n--service-cidr=10.96.0.0/16 \\\n--pod-network-cidr=192.168.0.0/16\n\n#重置命令 如果有问题的话\nkubeadm reset\n```\n\n#### 初始化结果\n\n```shell\nYour Kubernetes control-plane has initialized successfully!\n\nTo start using your cluster, you need to run the following as a regular user:\n\n  mkdir -p $HOME/.kube\n  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\n  sudo chown $(id -u):$(id -g) $HOME/.kube/config\n\nAlternatively, if you are the root user, you can run:\n\n  export KUBECONFIG=/etc/kubernetes/admin.conf\n\nYou should now deploy a pod network to the cluster.\nRun \"kubectl apply -f [podnetwork].yaml\" with one of the options listed at:\n  https://kubernetes.io/docs/concepts/cluster-administration/addons/\n\nYou can now join any number of control-plane nodes by copying certificate authorities\nand service account keys on each node and then running the following as root:\n\n  kubeadm join cfc-master:6443 --token ubt61k.dql9idffl61rbj27 \\\n\t--discovery-token-ca-cert-hash sha256:45f8fe633b9711e94b78fa485f74519d96d08bd380d76d78324e800dbb82a76d \\\n\t--control-plane \n\nThen you can join any number of worker nodes by running the following on each as root:\n\nkubeadm join cfc-master:6443 --token ubt61k.dql9idffl61rbj27 --discovery-token-ca-cert-hash sha256:45f8fe633b9711e94b78fa485f74519d96d08bd380d76d78324e800dbb82a76d\n\n#执行以下命令\necho \"export KUBECONFIG=/etc/kubernetes/admin.conf\" >> /etc/profile\n追加到profile文件中\nsource /etc/profile\n```\n\n#### 安装calico网络插件\n\n```shell\nwget https://docs.projectcalico.org/manifests/calico.yaml\n\n在\n- name: CLUSTER_TYPE\n  value: \"k8s,bgp\" \n下增加两行\n- name: IP_AUTODETECTION_METHOD\n  value: \"interface=eth0\"\n  \nkubectl apply -f calico.yaml\n```\n\n#### 加入worker节点\n\n```shell\nkubeadm join cfc-master:6443 --token ubt61k.dql9idffl61rbj27 --discovery-token-ca-cert-hash sha256:45f8fe633b9711e94b78fa485f74519d96d08bd380d76d78324e800dbb82a76d\n```\n\n### 安装KubeSphere前置环境\n\n#### 安装nfs-server\n\n```shell\n# 在每个机器。\nyum install -y nfs-utils\n```\n\n```shell\n# 在master 执行以下命令 \necho \"/nfs/data/ *(insecure,rw,sync,no_root_squash)\" > /etc/exports\n# 执行以下命令，启动 nfs 服务;创建共享目录\nmkdir -p /nfs/data\n\nsystemctl enable rpcbind\nsystemctl enable nfs-server\nsystemctl start rpcbind\nsystemctl start nfs-server\n\n# 使配置生效\nexportfs -r\n\n#检查配置是否生效\nexportfs\n```\n\n##### 配置nfs-client\n\n```shell\n#在node节点上执行以下命令\nshowmount -e 172.16.0.4\n\nmkdir -p /nfs/data\n\nmount -t nfs 172.16.0.4:/nfs/data /nfs/data\n```\n\n##### 配置默认存储\n\n```shell\nvi sc.yaml\n```\n\nsc.yaml内容如下\n\n```yaml\n## 创建了一个存储类\napiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n  name: nfs-storage\n  annotations:\n    storageclass.kubernetes.io/is-default-class: \"true\"\nprovisioner: k8s-sigs.io/nfs-subdir-external-provisioner\nparameters:\n  archiveOnDelete: \"true\"  ## 删除pv的时候，pv的内容是否要备份\n\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: nfs-client-provisioner\n  labels:\n    app: nfs-client-provisioner\n  # replace with namespace where provisioner is deployed\n  namespace: default\nspec:\n  replicas: 1\n  strategy:\n    type: Recreate\n  selector:\n    matchLabels:\n      app: nfs-client-provisioner\n  template:\n    metadata:\n      labels:\n        app: nfs-client-provisioner\n    spec:\n      serviceAccountName: nfs-client-provisioner\n      containers:\n        - name: nfs-client-provisioner\n          image: registry.cn-hangzhou.aliyuncs.com/lfy_k8s_images/nfs-subdir-external-provisioner:v4.0.2\n          # resources:\n          #    limits:\n          #      cpu: 10m\n          #    requests:\n          #      cpu: 10m\n          volumeMounts:\n            - name: nfs-client-root\n              mountPath: /persistentvolumes\n          env:\n            - name: PROVISIONER_NAME\n              value: k8s-sigs.io/nfs-subdir-external-provisioner\n            - name: NFS_SERVER\n              value: 172.16.0.4 ## 指定自己nfs服务器地址\n            - name: NFS_PATH  \n              value: /nfs/data  ## nfs服务器共享的目录\n      volumes:\n        - name: nfs-client-root\n          nfs:\n            server: 172.16.0.4\n            path: /nfs/data\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: nfs-client-provisioner\n  # replace with namespace where provisioner is deployed\n  namespace: default\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: nfs-client-provisioner-runner\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"nodes\"]\n    verbs: [\"get\", \"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumes\"]\n    verbs: [\"get\", \"list\", \"watch\", \"create\", \"delete\"]\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumeclaims\"]\n    verbs: [\"get\", \"list\", \"watch\", \"update\"]\n  - apiGroups: [\"storage.k8s.io\"]\n    resources: [\"storageclasses\"]\n    verbs: [\"get\", \"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"events\"]\n    verbs: [\"create\", \"update\", \"patch\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: run-nfs-client-provisioner\nsubjects:\n  - kind: ServiceAccount\n    name: nfs-client-provisioner\n    # replace with namespace where provisioner is deployed\n    namespace: default\nroleRef:\n  kind: ClusterRole\n  name: nfs-client-provisioner-runner\n  apiGroup: rbac.authorization.k8s.io\n---\nkind: Role\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: leader-locking-nfs-client-provisioner\n  # replace with namespace where provisioner is deployed\n  namespace: default\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"endpoints\"]\n    verbs: [\"get\", \"list\", \"watch\", \"create\", \"update\", \"patch\"]\n---\nkind: RoleBinding\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: leader-locking-nfs-client-provisioner\n  # replace with namespace where provisioner is deployed\n  namespace: default\nsubjects:\n  - kind: ServiceAccount\n    name: nfs-client-provisioner\n    # replace with namespace where provisioner is deployed\n    namespace: default\nroleRef:\n  kind: Role\n  name: leader-locking-nfs-client-provisioner\n  apiGroup: rbac.authorization.k8s.io\n```\n\n##### 应用并检查是否生效\n\n```shell\n#应用sc.yaml\nkubectl apply -f sc.yaml\n#确认配置是否生效\nkubectl get sc\n```\n\n#### 安装metrics-server\n\n集群指标监控组件\n\n```shell\nvi metrics.yaml\n```\n\n##### metrics.yaml文件内容如下\n\n```yaml\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  labels:\n    k8s-app: metrics-server\n  name: metrics-server\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  labels:\n    k8s-app: metrics-server\n    rbac.authorization.k8s.io/aggregate-to-admin: \"true\"\n    rbac.authorization.k8s.io/aggregate-to-edit: \"true\"\n    rbac.authorization.k8s.io/aggregate-to-view: \"true\"\n  name: system:aggregated-metrics-reader\nrules:\n- apiGroups:\n  - metrics.k8s.io\n  resources:\n  - pods\n  - nodes\n  verbs:\n  - get\n  - list\n  - watch\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  labels:\n    k8s-app: metrics-server\n  name: system:metrics-server\nrules:\n- apiGroups:\n  - \"\"\n  resources:\n  - pods\n  - nodes\n  - nodes/stats\n  - namespaces\n  - configmaps\n  verbs:\n  - get\n  - list\n  - watch\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: RoleBinding\nmetadata:\n  labels:\n    k8s-app: metrics-server\n  name: metrics-server-auth-reader\n  namespace: kube-system\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: Role\n  name: extension-apiserver-authentication-reader\nsubjects:\n- kind: ServiceAccount\n  name: metrics-server\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  labels:\n    k8s-app: metrics-server\n  name: metrics-server:system:auth-delegator\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:auth-delegator\nsubjects:\n- kind: ServiceAccount\n  name: metrics-server\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  labels:\n    k8s-app: metrics-server\n  name: system:metrics-server\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:metrics-server\nsubjects:\n- kind: ServiceAccount\n  name: metrics-server\n  namespace: kube-system\n---\napiVersion: v1\nkind: Service\nmetadata:\n  labels:\n    k8s-app: metrics-server\n  name: metrics-server\n  namespace: kube-system\nspec:\n  ports:\n  - name: https\n    port: 443\n    protocol: TCP\n    targetPort: https\n  selector:\n    k8s-app: metrics-server\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  labels:\n    k8s-app: metrics-server\n  name: metrics-server\n  namespace: kube-system\nspec:\n  selector:\n    matchLabels:\n      k8s-app: metrics-server\n  strategy:\n    rollingUpdate:\n      maxUnavailable: 0\n  template:\n    metadata:\n      labels:\n        k8s-app: metrics-server\n    spec:\n      containers:\n      - args:\n        - --cert-dir=/tmp\n        - --kubelet-insecure-tls\n        - --secure-port=4443\n        - --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname\n        - --kubelet-use-node-status-port\n        image: registry.cn-hangzhou.aliyuncs.com/lfy_k8s_images/metrics-server:v0.4.3\n        imagePullPolicy: IfNotPresent\n        livenessProbe:\n          failureThreshold: 3\n          httpGet:\n            path: /livez\n            port: https\n            scheme: HTTPS\n          periodSeconds: 10\n        name: metrics-server\n        ports:\n        - containerPort: 4443\n          name: https\n          protocol: TCP\n        readinessProbe:\n          failureThreshold: 3\n          httpGet:\n            path: /readyz\n            port: https\n            scheme: HTTPS\n          periodSeconds: 10\n        securityContext:\n          readOnlyRootFilesystem: true\n          runAsNonRoot: true\n          runAsUser: 1000\n        volumeMounts:\n        - mountPath: /tmp\n          name: tmp-dir\n      nodeSelector:\n        kubernetes.io/os: linux\n      priorityClassName: system-cluster-critical\n      serviceAccountName: metrics-server\n      volumes:\n      - emptyDir: {}\n        name: tmp-dir\n---\napiVersion: apiregistration.k8s.io/v1\nkind: APIService\nmetadata:\n  labels:\n    k8s-app: metrics-server\n  name: v1beta1.metrics.k8s.io\nspec:\n  group: metrics.k8s.io\n  groupPriorityMinimum: 100\n  insecureSkipTLSVerify: true\n  service:\n    name: metrics-server\n    namespace: kube-system\n  version: v1beta1\n  versionPriority: 100\n```\n\n##### 应用metrics.yaml\n\n```\nkubectl apply -f metrics.yaml\n```\n\n##### 检查是否生效\n\n```\nkubectl top nodes\n```\n\n### 安装KubeSphere\n\n#### 下载核心文件\n\n##### 下载kubesphere-installer.yaml\n\n```shell\nwget https://github.com/kubesphere/ks-installer/releases/download/v3.3.1/kubesphere-installer.yaml\n#或者自行下载然后创建\nvi kubesphere-installer.yaml\n```\n\n```yaml\n---\napiVersion: apiextensions.k8s.io/v1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterconfigurations.installer.kubesphere.io\nspec:\n  group: installer.kubesphere.io\n  versions:\n    - name: v1alpha1\n      served: true\n      storage: true\n      schema:\n        openAPIV3Schema:\n          type: object\n          properties:\n            spec:\n              type: object\n              x-kubernetes-preserve-unknown-fields: true\n            status:\n              type: object\n              x-kubernetes-preserve-unknown-fields: true\n  scope: Namespaced\n  names:\n    plural: clusterconfigurations\n    singular: clusterconfiguration\n    kind: ClusterConfiguration\n    shortNames:\n      - cc\n\n---\napiVersion: v1\nkind: Namespace\nmetadata:\n  name: kubesphere-system\n\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: ks-installer\n  namespace: kubesphere-system\n\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  name: ks-installer\nrules:\n- apiGroups:\n  - \"\"\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - apps\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - extensions\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - batch\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - rbac.authorization.k8s.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - apiregistration.k8s.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - apiextensions.k8s.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - tenant.kubesphere.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - certificates.k8s.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - devops.kubesphere.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - monitoring.coreos.com\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - logging.kubesphere.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - jaegertracing.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - storage.k8s.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - admissionregistration.k8s.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - policy\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - autoscaling\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - networking.istio.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - config.istio.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - iam.kubesphere.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - notification.kubesphere.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - auditing.kubesphere.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - events.kubesphere.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - core.kubefed.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - installer.kubesphere.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - storage.kubesphere.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - security.istio.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - monitoring.kiali.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - kiali.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - networking.k8s.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - edgeruntime.kubesphere.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - types.kubefed.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - monitoring.kubesphere.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - application.kubesphere.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n\n\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: ks-installer\nsubjects:\n- kind: ServiceAccount\n  name: ks-installer\n  namespace: kubesphere-system\nroleRef:\n  kind: ClusterRole\n  name: ks-installer\n  apiGroup: rbac.authorization.k8s.io\n\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: ks-installer\n  namespace: kubesphere-system\n  labels:\n    app: ks-installer\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: ks-installer\n  template:\n    metadata:\n      labels:\n        app: ks-installer\n    spec:\n      serviceAccountName: ks-installer\n      containers:\n      - name: installer\n        image: kubesphere/ks-installer:v3.3.1\n        imagePullPolicy: \"Always\"\n        resources:\n          limits:\n            cpu: \"1\"\n            memory: 1Gi\n          requests:\n            cpu: 20m\n            memory: 100Mi\n        volumeMounts:\n        - mountPath: /etc/localtime\n          name: host-time\n          readOnly: true\n      volumes:\n      - hostPath:\n          path: /etc/localtime\n          type: \"\"\n        name: host-time\n\n```\n\n\n\n##### 下载cluster-configuration.yaml\n\n```shell\nwget https://github.com/kubesphere/ks-installer/releases/download/v3.3.1/cluster-configuration.yaml\n#或者自行下载然后创建\nvi cluster-configuration.yaml\n```\n\n##### 修改后的cluster-configuration.yaml\n\n```yaml\n---\napiVersion: installer.kubesphere.io/v1alpha1\nkind: ClusterConfiguration\nmetadata:\n  name: ks-installer\n  namespace: kubesphere-system\n  labels:\n    version: v3.3.1\nspec:\n  persistence:\n    storageClass: \"\"        # If there is no default StorageClass in your cluster, you need to specify an existing StorageClass here.\n  authentication:\n    # adminPassword: \"\"     # Custom password of the admin user. If the parameter exists but the value is empty, a random password is generated. If the parameter does not exist, P@88w0rd is used.\n    jwtSecret: \"\"           # Keep the jwtSecret consistent with the Host Cluster. Retrieve the jwtSecret by executing \"kubectl -n kubesphere-system get cm kubesphere-config -o yaml | grep -v \"apiVersion\" | grep jwtSecret\" on the Host Cluster.\n  local_registry: \"\"        # Add your private registry address if it is needed.\n  # dev_tag: \"\"               # Add your kubesphere image tag you want to install, by default it's same as ks-installer release version.\n  etcd:\n    monitoring: false       # Enable or disable etcd monitoring dashboard installation. You have to create a Secret for etcd before you enable it.\n    endpointIps: 172.16.0.4  # etcd cluster EndpointIps. It can be a bunch of IPs here.\n    port: 2379              # etcd port.\n    tlsEnable: true\n  common:\n    core:\n      console:\n        enableMultiLogin: true  # Enable or disable simultaneous logins. It allows different users to log in with the same account at the same time.\n        port: 30880\n        type: NodePort\n\n    # apiserver:            # Enlarge the apiserver and controller manager's resource requests and limits for the large cluster\n    #  resources: {}\n    # controllerManager:\n    #  resources: {}\n    redis:\n      enabled: true\n      enableHA: false\n      volumeSize: 2Gi # Redis PVC size.\n    openldap:\n      enabled: true\n      volumeSize: 2Gi   # openldap PVC size.\n    minio:\n      volumeSize: 20Gi # Minio PVC size.\n    monitoring:\n      # type: external   # Whether to specify the external prometheus stack, and need to modify the endpoint at the next line.\n      endpoint: http://prometheus-operated.kubesphere-monitoring-system.svc:9090 # Prometheus endpoint to get metrics data.\n      GPUMonitoring:     # Enable or disable the GPU-related metrics. If you enable this switch but have no GPU resources, Kubesphere will set it to zero.\n        enabled: false\n    gpu:                 # Install GPUKinds. The default GPU kind is nvidia.com/gpu. Other GPU kinds can be added here according to your needs.\n      kinds:\n      - resourceName: \"nvidia.com/gpu\"\n        resourceType: \"GPU\"\n        default: true\n    es:   # Storage backend for logging, events and auditing.\n      # master:\n      #   volumeSize: 4Gi  # The volume size of Elasticsearch master nodes.\n      #   replicas: 1      # The total number of master nodes. Even numbers are not allowed.\n      #   resources: {}\n      # data:\n      #   volumeSize: 20Gi  # The volume size of Elasticsearch data nodes.\n      #   replicas: 1       # The total number of data nodes.\n      #   resources: {}\n      logMaxAge: 7             # Log retention time in built-in Elasticsearch. It is 7 days by default.\n      elkPrefix: logstash      # The string making up index names. The index name will be formatted as ks-<elk_prefix>-log.\n      basicAuth:\n        enabled: false\n        username: \"\"\n        password: \"\"\n      externalElasticsearchHost: \"\"\n      externalElasticsearchPort: \"\"\n  alerting:                # (CPU: 0.1 Core, Memory: 100 MiB) It enables users to customize alerting policies to send messages to receivers in time with different time intervals and alerting levels to choose from.\n    enabled: true         # Enable or disable the KubeSphere Alerting System.\n    # thanosruler:\n    #   replicas: 1\n    #   resources: {}\n  auditing:                # Provide a security-relevant chronological set of records，recording the sequence of activities happening on the platform, initiated by different tenants.\n    enabled: true         # Enable or disable the KubeSphere Auditing Log System.\n    # operator:\n    #   resources: {}\n    # webhook:\n    #   resources: {}\n  devops:                  # (CPU: 0.47 Core, Memory: 8.6 G) Provide an out-of-the-box CI/CD system based on Jenkins, and automated workflow tools including Source-to-Image & Binary-to-Image.\n    enabled: true             # Enable or disable the KubeSphere DevOps System.\n    # resources: {}\n    jenkinsMemoryLim: 8Gi      # Jenkins memory limit.\n    jenkinsMemoryReq: 4Gi   # Jenkins memory request.\n    jenkinsVolumeSize: 8Gi     # Jenkins volume size.\n  events:                  # Provide a graphical web console for Kubernetes Events exporting, filtering and alerting in multi-tenant Kubernetes clusters.\n    enabled: true         # Enable or disable the KubeSphere Events System.\n    # operator:\n    #   resources: {}\n    # exporter:\n    #   resources: {}\n    # ruler:\n    #   enabled: true\n    #   replicas: 2\n    #   resources: {}\n  logging:                 # (CPU: 57 m, Memory: 2.76 G) Flexible logging functions are provided for log query, collection and management in a unified console. Additional log collectors can be added, such as Elasticsearch, Kafka and Fluentd.\n    enabled: true         # Enable or disable the KubeSphere Logging System.\n    logsidecar:\n      enabled: true\n      replicas: 2\n      # resources: {}\n  metrics_server:                    # (CPU: 56 m, Memory: 44.35 MiB) It enables HPA (Horizontal Pod Autoscaler).\n    enabled: false                   # Enable or disable metrics-server.\n  monitoring:\n    storageClass: \"\"                 # If there is an independent StorageClass you need for Prometheus, you can specify it here. The default StorageClass is used by default.\n    node_exporter:\n      port: 9100\n      # resources: {}\n    # kube_rbac_proxy:\n    #   resources: {}\n    # kube_state_metrics:\n    #   resources: {}\n    # prometheus:\n    #   replicas: 1  # Prometheus replicas are responsible for monitoring different segments of data source and providing high availability.\n    #   volumeSize: 20Gi  # Prometheus PVC size.\n    #   resources: {}\n    #   operator:\n    #     resources: {}\n    # alertmanager:\n    #   replicas: 1          # AlertManager Replicas.\n    #   resources: {}\n    # notification_manager:\n    #   resources: {}\n    #   operator:\n    #     resources: {}\n    #   proxy:\n    #     resources: {}\n    gpu:                           # GPU monitoring-related plug-in installation.\n      nvidia_dcgm_exporter:        # Ensure that gpu resources on your hosts can be used normally, otherwise this plug-in will not work properly.\n        enabled: false             # Check whether the labels on the GPU hosts contain \"nvidia.com/gpu.present=true\" to ensure that the DCGM pod is scheduled to these nodes.\n        # resources: {}\n  multicluster:\n    clusterRole: none  # host | member | none  # You can install a solo cluster, or specify it as the Host or Member Cluster.\n  network:\n    networkpolicy: # Network policies allow network isolation within the same cluster, which means firewalls can be set up between certain instances (Pods).\n      # Make sure that the CNI network plugin used by the cluster supports NetworkPolicy. There are a number of CNI network plugins that support NetworkPolicy, including Calico, Cilium, Kube-router, Romana and Weave Net.\n      enabled: true # Enable or disable network policies.\n    ippool: # Use Pod IP Pools to manage the Pod network address space. Pods to be created can be assigned IP addresses from a Pod IP Pool.\n      type: none # Specify \"calico\" for this field if Calico is used as your CNI plugin. \"none\" means that Pod IP Pools are disabled.\n    topology: # Use Service Topology to view Service-to-Service communication based on Weave Scope.\n      type: none # Specify \"weave-scope\" for this field to enable Service Topology. \"none\" means that Service Topology is disabled.\n  openpitrix: # An App Store that is accessible to all platform tenants. You can use it to manage apps across their entire lifecycle.\n    store:\n      enabled: true # Enable or disable the KubeSphere App Store.\n  servicemesh:         # (0.3 Core, 300 MiB) Provide fine-grained traffic management, observability and tracing, and visualized traffic topology.\n    enabled: true     # Base component (pilot). Enable or disable KubeSphere Service Mesh (Istio-based).\n    istio:  # Customizing the istio installation configuration, refer to https://istio.io/latest/docs/setup/additional-setup/customize-installation/\n      components:\n        ingressGateways:\n        - name: istio-ingressgateway\n          enabled: false\n        cni:\n          enabled: false\n  edgeruntime:          # Add edge nodes to your cluster and deploy workloads on edge nodes.\n    enabled: false\n    kubeedge:        # kubeedge configurations\n      enabled: false\n      cloudCore:\n        cloudHub:\n          advertiseAddress: # At least a public IP address or an IP address which can be accessed by edge nodes must be provided.\n            - \"\"            # Note that once KubeEdge is enabled, CloudCore will malfunction if the address is not provided.\n        service:\n          cloudhubNodePort: \"30000\"\n          cloudhubQuicNodePort: \"30001\"\n          cloudhubHttpsNodePort: \"30002\"\n          cloudstreamNodePort: \"30003\"\n          tunnelNodePort: \"30004\"\n        # resources: {}\n        # hostNetWork: false\n      iptables-manager:\n        enabled: true \n        mode: \"external\"\n        # resources: {}\n      # edgeService:\n      #   resources: {}\n  gatekeeper:        # Provide admission policy and rule management, A validating (mutating TBA) webhook that enforces CRD-based policies executed by Open Policy Agent.\n    enabled: false   # Enable or disable Gatekeeper.\n    # controller_manager:\n    #   resources: {}\n    # audit:\n    #   resources: {}\n  terminal:\n    # image: 'alpine:3.15' # There must be an nsenter program in the image\n    timeout: 600         # Container timeout, if set to 0, no timeout will be used. The unit is seconds\n\n```\n\n#### 执行安装\n\n```shell\nkubectl apply -f kubesphere-installer.yaml\nkubectl apply -f cluster-configuration.yaml\n\n#如果出错 执行命令 删除后重新apply\nkubectl delete -f kubesphere-installer.yaml\nkubectl delete -f cluster-configuration.yaml\n```\n\n##### 安装中的坑\n\n```shell\n#minio timeout\n#修改\nkubectl -n kube-system edit configmap coredns\n\n#注释掉下面的\nforward . /etc/resolv.conf {\nmax_concurrent 1000\n}        \n#修改后重新执行\nkubectl apply -f kubesphere-installer.yaml\n#执行完成后 恢复到默认配置 然后再次执行\nkubectl delete -f cluster-configuration.yaml\n```\n\n#### 查看安装日志\n\n```shell\nkubectl logs -n kubesphere-system $(kubectl get pod -n kubesphere-system -l 'app in (ks-install, ks-installer)' -o jsonpath='{.items[0].metadata.name}') -f\n```\n\n#### 安装成功\n\n```\n#####################################################\n###              Welcome to KubeSphere!           ###\n#####################################################\n\nConsole: http://172.16.0.4:30880\nAccount: admin\nPassword: P@88w0rd\nNOTES：\n  1. After you log into the console, please check the\n     monitoring status of service components in\n     \"Cluster Management\". If any service is not\n     ready, please wait patiently until all components \n     are up and running.\n  2. Please change the default password after login.\n\n#####################################################\nhttps://kubesphere.io             2022-11-25 14:04:12\n#####################################################\n```\n\n\n\n","source":"_posts/k8s和kubesphere搭建.md","raw":"---\ntitle: k8s和kubesphere搭建\ndate: 2023-01-03 16:03:00\ncategories: \n- k8s\n---\n\n### 安装containerd(每台机器)\n\n参考\n\nhttps://github.com/containerd/containerd/blob/main/docs/getting-started.md#step-1-installing-containerd\n\n#### 安装容器\n\n从https://github.com/containerd/containerd/releases 下载containerd-VERSION-OS-ARCH.tar.gz存档，并将其解压到：`/usr/local`\n\n```shell\nwget https://github.com/containerd/containerd/releases/download/v1.6.10/containerd-1.6.10-linux-amd64.tar.gz\ntar Cxzvf /usr/local containerd-1.6.10-linux-amd64.tar.gz\n```\n\n#### 通过 systemd 启动 containerd\n\nhttps://raw.githubusercontent.com/containerd/containerd/main/containerd.service\n\n```shell\nwget https://raw.githubusercontent.com/containerd/containerd/main/containerd.service\n```\n\n将下载的文件放到 /etc/systemd/system\n\n```shell\nmv containerd.service /etc/systemd/system\n```\n\n```shell\n#运行以下命令\nsystemctl daemon-reload\nsystemctl enable --now containerd\n```\n\n#### 安装 runc\n\n从[https://github.com/opencontainers/runc/releases ](https://github.com/opencontainers/runc/releases) 下载`runc.<ARCH>`二进制文件，验证其 sha256sum，并将其安装到`/usr/local/sbin/runc`\n\n```shell\nwget https://github.com/opencontainers/runc/releases/download/v1.1.4/runc.amd64\n#安装\ninstall -m 755 runc.amd64 /usr/local/sbin/runc\n```\n\n#### 安装CNI插件\n\n[从https://github.com/containernetworking/plugins/releases](https://github.com/containernetworking/plugins/releases)  下载`cni-plugins-<OS>-<ARCH>-<VERSION>.tgz`存档，并将其解压到：`/opt/cni/bin`\n\n```shell\nwget https://github.com/containernetworking/plugins/releases/download/v1.1.1/cni-plugins-linux-amd64-v1.1.1.tgz\n\nmkdir -p /opt/cni/bin\ntar Cxzvf /opt/cni/bin cni-plugins-linux-amd64-v1.1.1.tgz\n```\n\n#### 修改cgroup驱动以及自定义镜像\n\n```shell\n#生成默认配置文件\ncontainerd config default > /etc/containerd/config.toml\nvim /etc/containerd/config.toml\n```\n\n```yaml\n[plugins.\"io.containerd.grpc.v1.cri\".containerd.runtimes.runc.options]\n            ......\n            Root = \"\"\n            ShimCgroup = \"\"\n            SystemdCgroup = true # 将false改为true\n            \n[plugins.\"io.containerd.tracing.processor.v1.otlp\"]\n    endpoint = \"https://registry.aliyuncs.com\" #阿里云镜像\n    insecure = false\n    protocol = \"\"\n    \n[plugins.\"io.containerd.grpc.v1.cri\"]\n    netns_mounts_under_state_dir = false\n    restrict_oom_score_adj = false\n    #sandbox_image = \"k8s.gcr.io/pause:3.6\"\n    sandbox_image = \"registry.aliyuncs.com/google_containers/pause:3.8\" # 修改成这样\n```\n\n```shell\n#重启containerd\nsystemctl daemon-reload\nsystemctl restart containerd\n```\n\n#### 安装nerdctl\n\n```shell\n#下载精简版\nwget https://github.com/containerd/nerdctl/releases/download/v1.0.0/nerdctl-1.0.0-linux-amd64.tar.gz\n#解压到/usr/local/bin\ntar Cxzvvf /usr/local/bin nerdctl-1.0.0-linux-amd64.tar.gz\n```\n\n### 安装Kubernetes\n\n#### 设置每台机器的hostname以及hosts\n\n```shell\n#设置每个机器自己的hostname\nhostnamectl set-hostname cfc-master\nhostnamectl set-hostname cfc-node1\nhostnamectl set-hostname cfc-node2\n#hosts\nvim /etc/hosts\n\n172.16.0.4      cfc-master\n172.16.0.120    cfc-node1\n172.16.0.104    cfc-node2\n```\n\n#### 关闭swap\n\n```shell\nswapoff -a\nsed -i 's/.*swap.*/#&/' /etc/fstab\n```\n\n#### 允许 iptables 检查桥接流量\n\n```shell\n#允许 iptables 检查桥接流量\ncat <<EOF | sudo tee /etc/modules-load.d/k8s.conf\nbr_netfilter\nEOF\n\ncat <<EOF | sudo tee /etc/sysctl.d/k8s.conf\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nEOF\n#让配置生效\nsudo sysctl --system\n```\n\n#### 设置时区\n\n```shell\ntimedatectl set-timezone Asia/Shanghai\nsystemctl restart rsyslog\n```\n\n#### 配置k8s的yum源地址\n\n```shell\ncat <<EOF | sudo tee /etc/yum.repos.d/kubernetes.repo\n[kubernetes]\nname=Kubernetes\nbaseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64\nenabled=1\ngpgcheck=0\nrepo_gpgcheck=0\ngpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg\n   http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\nEOF\n```\n\n#### 安装kubelet、kubeadm、kubectl\n\n```shell\n#指定版本安装\nyum install -y kubelet-1.24.8 kubeadm-1.24.8 kubectl-1.24.8\n\n#设置启动\nsystemctl enable --now kubelet\n```\n\n#### 初始化master节点\n\n```shell\nkubeadm init \\\n--apiserver-advertise-address=172.16.0.4 \\\n--control-plane-endpoint=cfc-master \\\n--image-repository registry.aliyuncs.com/google_containers \\\n--kubernetes-version v1.24.8 \\\n--service-cidr=10.96.0.0/16 \\\n--pod-network-cidr=192.168.0.0/16\n\n#重置命令 如果有问题的话\nkubeadm reset\n```\n\n#### 初始化结果\n\n```shell\nYour Kubernetes control-plane has initialized successfully!\n\nTo start using your cluster, you need to run the following as a regular user:\n\n  mkdir -p $HOME/.kube\n  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\n  sudo chown $(id -u):$(id -g) $HOME/.kube/config\n\nAlternatively, if you are the root user, you can run:\n\n  export KUBECONFIG=/etc/kubernetes/admin.conf\n\nYou should now deploy a pod network to the cluster.\nRun \"kubectl apply -f [podnetwork].yaml\" with one of the options listed at:\n  https://kubernetes.io/docs/concepts/cluster-administration/addons/\n\nYou can now join any number of control-plane nodes by copying certificate authorities\nand service account keys on each node and then running the following as root:\n\n  kubeadm join cfc-master:6443 --token ubt61k.dql9idffl61rbj27 \\\n\t--discovery-token-ca-cert-hash sha256:45f8fe633b9711e94b78fa485f74519d96d08bd380d76d78324e800dbb82a76d \\\n\t--control-plane \n\nThen you can join any number of worker nodes by running the following on each as root:\n\nkubeadm join cfc-master:6443 --token ubt61k.dql9idffl61rbj27 --discovery-token-ca-cert-hash sha256:45f8fe633b9711e94b78fa485f74519d96d08bd380d76d78324e800dbb82a76d\n\n#执行以下命令\necho \"export KUBECONFIG=/etc/kubernetes/admin.conf\" >> /etc/profile\n追加到profile文件中\nsource /etc/profile\n```\n\n#### 安装calico网络插件\n\n```shell\nwget https://docs.projectcalico.org/manifests/calico.yaml\n\n在\n- name: CLUSTER_TYPE\n  value: \"k8s,bgp\" \n下增加两行\n- name: IP_AUTODETECTION_METHOD\n  value: \"interface=eth0\"\n  \nkubectl apply -f calico.yaml\n```\n\n#### 加入worker节点\n\n```shell\nkubeadm join cfc-master:6443 --token ubt61k.dql9idffl61rbj27 --discovery-token-ca-cert-hash sha256:45f8fe633b9711e94b78fa485f74519d96d08bd380d76d78324e800dbb82a76d\n```\n\n### 安装KubeSphere前置环境\n\n#### 安装nfs-server\n\n```shell\n# 在每个机器。\nyum install -y nfs-utils\n```\n\n```shell\n# 在master 执行以下命令 \necho \"/nfs/data/ *(insecure,rw,sync,no_root_squash)\" > /etc/exports\n# 执行以下命令，启动 nfs 服务;创建共享目录\nmkdir -p /nfs/data\n\nsystemctl enable rpcbind\nsystemctl enable nfs-server\nsystemctl start rpcbind\nsystemctl start nfs-server\n\n# 使配置生效\nexportfs -r\n\n#检查配置是否生效\nexportfs\n```\n\n##### 配置nfs-client\n\n```shell\n#在node节点上执行以下命令\nshowmount -e 172.16.0.4\n\nmkdir -p /nfs/data\n\nmount -t nfs 172.16.0.4:/nfs/data /nfs/data\n```\n\n##### 配置默认存储\n\n```shell\nvi sc.yaml\n```\n\nsc.yaml内容如下\n\n```yaml\n## 创建了一个存储类\napiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n  name: nfs-storage\n  annotations:\n    storageclass.kubernetes.io/is-default-class: \"true\"\nprovisioner: k8s-sigs.io/nfs-subdir-external-provisioner\nparameters:\n  archiveOnDelete: \"true\"  ## 删除pv的时候，pv的内容是否要备份\n\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: nfs-client-provisioner\n  labels:\n    app: nfs-client-provisioner\n  # replace with namespace where provisioner is deployed\n  namespace: default\nspec:\n  replicas: 1\n  strategy:\n    type: Recreate\n  selector:\n    matchLabels:\n      app: nfs-client-provisioner\n  template:\n    metadata:\n      labels:\n        app: nfs-client-provisioner\n    spec:\n      serviceAccountName: nfs-client-provisioner\n      containers:\n        - name: nfs-client-provisioner\n          image: registry.cn-hangzhou.aliyuncs.com/lfy_k8s_images/nfs-subdir-external-provisioner:v4.0.2\n          # resources:\n          #    limits:\n          #      cpu: 10m\n          #    requests:\n          #      cpu: 10m\n          volumeMounts:\n            - name: nfs-client-root\n              mountPath: /persistentvolumes\n          env:\n            - name: PROVISIONER_NAME\n              value: k8s-sigs.io/nfs-subdir-external-provisioner\n            - name: NFS_SERVER\n              value: 172.16.0.4 ## 指定自己nfs服务器地址\n            - name: NFS_PATH  \n              value: /nfs/data  ## nfs服务器共享的目录\n      volumes:\n        - name: nfs-client-root\n          nfs:\n            server: 172.16.0.4\n            path: /nfs/data\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: nfs-client-provisioner\n  # replace with namespace where provisioner is deployed\n  namespace: default\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: nfs-client-provisioner-runner\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"nodes\"]\n    verbs: [\"get\", \"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumes\"]\n    verbs: [\"get\", \"list\", \"watch\", \"create\", \"delete\"]\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumeclaims\"]\n    verbs: [\"get\", \"list\", \"watch\", \"update\"]\n  - apiGroups: [\"storage.k8s.io\"]\n    resources: [\"storageclasses\"]\n    verbs: [\"get\", \"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"events\"]\n    verbs: [\"create\", \"update\", \"patch\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: run-nfs-client-provisioner\nsubjects:\n  - kind: ServiceAccount\n    name: nfs-client-provisioner\n    # replace with namespace where provisioner is deployed\n    namespace: default\nroleRef:\n  kind: ClusterRole\n  name: nfs-client-provisioner-runner\n  apiGroup: rbac.authorization.k8s.io\n---\nkind: Role\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: leader-locking-nfs-client-provisioner\n  # replace with namespace where provisioner is deployed\n  namespace: default\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"endpoints\"]\n    verbs: [\"get\", \"list\", \"watch\", \"create\", \"update\", \"patch\"]\n---\nkind: RoleBinding\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: leader-locking-nfs-client-provisioner\n  # replace with namespace where provisioner is deployed\n  namespace: default\nsubjects:\n  - kind: ServiceAccount\n    name: nfs-client-provisioner\n    # replace with namespace where provisioner is deployed\n    namespace: default\nroleRef:\n  kind: Role\n  name: leader-locking-nfs-client-provisioner\n  apiGroup: rbac.authorization.k8s.io\n```\n\n##### 应用并检查是否生效\n\n```shell\n#应用sc.yaml\nkubectl apply -f sc.yaml\n#确认配置是否生效\nkubectl get sc\n```\n\n#### 安装metrics-server\n\n集群指标监控组件\n\n```shell\nvi metrics.yaml\n```\n\n##### metrics.yaml文件内容如下\n\n```yaml\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  labels:\n    k8s-app: metrics-server\n  name: metrics-server\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  labels:\n    k8s-app: metrics-server\n    rbac.authorization.k8s.io/aggregate-to-admin: \"true\"\n    rbac.authorization.k8s.io/aggregate-to-edit: \"true\"\n    rbac.authorization.k8s.io/aggregate-to-view: \"true\"\n  name: system:aggregated-metrics-reader\nrules:\n- apiGroups:\n  - metrics.k8s.io\n  resources:\n  - pods\n  - nodes\n  verbs:\n  - get\n  - list\n  - watch\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  labels:\n    k8s-app: metrics-server\n  name: system:metrics-server\nrules:\n- apiGroups:\n  - \"\"\n  resources:\n  - pods\n  - nodes\n  - nodes/stats\n  - namespaces\n  - configmaps\n  verbs:\n  - get\n  - list\n  - watch\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: RoleBinding\nmetadata:\n  labels:\n    k8s-app: metrics-server\n  name: metrics-server-auth-reader\n  namespace: kube-system\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: Role\n  name: extension-apiserver-authentication-reader\nsubjects:\n- kind: ServiceAccount\n  name: metrics-server\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  labels:\n    k8s-app: metrics-server\n  name: metrics-server:system:auth-delegator\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:auth-delegator\nsubjects:\n- kind: ServiceAccount\n  name: metrics-server\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  labels:\n    k8s-app: metrics-server\n  name: system:metrics-server\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:metrics-server\nsubjects:\n- kind: ServiceAccount\n  name: metrics-server\n  namespace: kube-system\n---\napiVersion: v1\nkind: Service\nmetadata:\n  labels:\n    k8s-app: metrics-server\n  name: metrics-server\n  namespace: kube-system\nspec:\n  ports:\n  - name: https\n    port: 443\n    protocol: TCP\n    targetPort: https\n  selector:\n    k8s-app: metrics-server\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  labels:\n    k8s-app: metrics-server\n  name: metrics-server\n  namespace: kube-system\nspec:\n  selector:\n    matchLabels:\n      k8s-app: metrics-server\n  strategy:\n    rollingUpdate:\n      maxUnavailable: 0\n  template:\n    metadata:\n      labels:\n        k8s-app: metrics-server\n    spec:\n      containers:\n      - args:\n        - --cert-dir=/tmp\n        - --kubelet-insecure-tls\n        - --secure-port=4443\n        - --kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname\n        - --kubelet-use-node-status-port\n        image: registry.cn-hangzhou.aliyuncs.com/lfy_k8s_images/metrics-server:v0.4.3\n        imagePullPolicy: IfNotPresent\n        livenessProbe:\n          failureThreshold: 3\n          httpGet:\n            path: /livez\n            port: https\n            scheme: HTTPS\n          periodSeconds: 10\n        name: metrics-server\n        ports:\n        - containerPort: 4443\n          name: https\n          protocol: TCP\n        readinessProbe:\n          failureThreshold: 3\n          httpGet:\n            path: /readyz\n            port: https\n            scheme: HTTPS\n          periodSeconds: 10\n        securityContext:\n          readOnlyRootFilesystem: true\n          runAsNonRoot: true\n          runAsUser: 1000\n        volumeMounts:\n        - mountPath: /tmp\n          name: tmp-dir\n      nodeSelector:\n        kubernetes.io/os: linux\n      priorityClassName: system-cluster-critical\n      serviceAccountName: metrics-server\n      volumes:\n      - emptyDir: {}\n        name: tmp-dir\n---\napiVersion: apiregistration.k8s.io/v1\nkind: APIService\nmetadata:\n  labels:\n    k8s-app: metrics-server\n  name: v1beta1.metrics.k8s.io\nspec:\n  group: metrics.k8s.io\n  groupPriorityMinimum: 100\n  insecureSkipTLSVerify: true\n  service:\n    name: metrics-server\n    namespace: kube-system\n  version: v1beta1\n  versionPriority: 100\n```\n\n##### 应用metrics.yaml\n\n```\nkubectl apply -f metrics.yaml\n```\n\n##### 检查是否生效\n\n```\nkubectl top nodes\n```\n\n### 安装KubeSphere\n\n#### 下载核心文件\n\n##### 下载kubesphere-installer.yaml\n\n```shell\nwget https://github.com/kubesphere/ks-installer/releases/download/v3.3.1/kubesphere-installer.yaml\n#或者自行下载然后创建\nvi kubesphere-installer.yaml\n```\n\n```yaml\n---\napiVersion: apiextensions.k8s.io/v1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterconfigurations.installer.kubesphere.io\nspec:\n  group: installer.kubesphere.io\n  versions:\n    - name: v1alpha1\n      served: true\n      storage: true\n      schema:\n        openAPIV3Schema:\n          type: object\n          properties:\n            spec:\n              type: object\n              x-kubernetes-preserve-unknown-fields: true\n            status:\n              type: object\n              x-kubernetes-preserve-unknown-fields: true\n  scope: Namespaced\n  names:\n    plural: clusterconfigurations\n    singular: clusterconfiguration\n    kind: ClusterConfiguration\n    shortNames:\n      - cc\n\n---\napiVersion: v1\nkind: Namespace\nmetadata:\n  name: kubesphere-system\n\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: ks-installer\n  namespace: kubesphere-system\n\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  name: ks-installer\nrules:\n- apiGroups:\n  - \"\"\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - apps\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - extensions\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - batch\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - rbac.authorization.k8s.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - apiregistration.k8s.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - apiextensions.k8s.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - tenant.kubesphere.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - certificates.k8s.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - devops.kubesphere.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - monitoring.coreos.com\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - logging.kubesphere.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - jaegertracing.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - storage.k8s.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - admissionregistration.k8s.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - policy\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - autoscaling\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - networking.istio.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - config.istio.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - iam.kubesphere.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - notification.kubesphere.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - auditing.kubesphere.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - events.kubesphere.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - core.kubefed.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - installer.kubesphere.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - storage.kubesphere.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - security.istio.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - monitoring.kiali.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - kiali.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - networking.k8s.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - edgeruntime.kubesphere.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - types.kubefed.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - monitoring.kubesphere.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n- apiGroups:\n  - application.kubesphere.io\n  resources:\n  - '*'\n  verbs:\n  - '*'\n\n\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: ks-installer\nsubjects:\n- kind: ServiceAccount\n  name: ks-installer\n  namespace: kubesphere-system\nroleRef:\n  kind: ClusterRole\n  name: ks-installer\n  apiGroup: rbac.authorization.k8s.io\n\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: ks-installer\n  namespace: kubesphere-system\n  labels:\n    app: ks-installer\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: ks-installer\n  template:\n    metadata:\n      labels:\n        app: ks-installer\n    spec:\n      serviceAccountName: ks-installer\n      containers:\n      - name: installer\n        image: kubesphere/ks-installer:v3.3.1\n        imagePullPolicy: \"Always\"\n        resources:\n          limits:\n            cpu: \"1\"\n            memory: 1Gi\n          requests:\n            cpu: 20m\n            memory: 100Mi\n        volumeMounts:\n        - mountPath: /etc/localtime\n          name: host-time\n          readOnly: true\n      volumes:\n      - hostPath:\n          path: /etc/localtime\n          type: \"\"\n        name: host-time\n\n```\n\n\n\n##### 下载cluster-configuration.yaml\n\n```shell\nwget https://github.com/kubesphere/ks-installer/releases/download/v3.3.1/cluster-configuration.yaml\n#或者自行下载然后创建\nvi cluster-configuration.yaml\n```\n\n##### 修改后的cluster-configuration.yaml\n\n```yaml\n---\napiVersion: installer.kubesphere.io/v1alpha1\nkind: ClusterConfiguration\nmetadata:\n  name: ks-installer\n  namespace: kubesphere-system\n  labels:\n    version: v3.3.1\nspec:\n  persistence:\n    storageClass: \"\"        # If there is no default StorageClass in your cluster, you need to specify an existing StorageClass here.\n  authentication:\n    # adminPassword: \"\"     # Custom password of the admin user. If the parameter exists but the value is empty, a random password is generated. If the parameter does not exist, P@88w0rd is used.\n    jwtSecret: \"\"           # Keep the jwtSecret consistent with the Host Cluster. Retrieve the jwtSecret by executing \"kubectl -n kubesphere-system get cm kubesphere-config -o yaml | grep -v \"apiVersion\" | grep jwtSecret\" on the Host Cluster.\n  local_registry: \"\"        # Add your private registry address if it is needed.\n  # dev_tag: \"\"               # Add your kubesphere image tag you want to install, by default it's same as ks-installer release version.\n  etcd:\n    monitoring: false       # Enable or disable etcd monitoring dashboard installation. You have to create a Secret for etcd before you enable it.\n    endpointIps: 172.16.0.4  # etcd cluster EndpointIps. It can be a bunch of IPs here.\n    port: 2379              # etcd port.\n    tlsEnable: true\n  common:\n    core:\n      console:\n        enableMultiLogin: true  # Enable or disable simultaneous logins. It allows different users to log in with the same account at the same time.\n        port: 30880\n        type: NodePort\n\n    # apiserver:            # Enlarge the apiserver and controller manager's resource requests and limits for the large cluster\n    #  resources: {}\n    # controllerManager:\n    #  resources: {}\n    redis:\n      enabled: true\n      enableHA: false\n      volumeSize: 2Gi # Redis PVC size.\n    openldap:\n      enabled: true\n      volumeSize: 2Gi   # openldap PVC size.\n    minio:\n      volumeSize: 20Gi # Minio PVC size.\n    monitoring:\n      # type: external   # Whether to specify the external prometheus stack, and need to modify the endpoint at the next line.\n      endpoint: http://prometheus-operated.kubesphere-monitoring-system.svc:9090 # Prometheus endpoint to get metrics data.\n      GPUMonitoring:     # Enable or disable the GPU-related metrics. If you enable this switch but have no GPU resources, Kubesphere will set it to zero.\n        enabled: false\n    gpu:                 # Install GPUKinds. The default GPU kind is nvidia.com/gpu. Other GPU kinds can be added here according to your needs.\n      kinds:\n      - resourceName: \"nvidia.com/gpu\"\n        resourceType: \"GPU\"\n        default: true\n    es:   # Storage backend for logging, events and auditing.\n      # master:\n      #   volumeSize: 4Gi  # The volume size of Elasticsearch master nodes.\n      #   replicas: 1      # The total number of master nodes. Even numbers are not allowed.\n      #   resources: {}\n      # data:\n      #   volumeSize: 20Gi  # The volume size of Elasticsearch data nodes.\n      #   replicas: 1       # The total number of data nodes.\n      #   resources: {}\n      logMaxAge: 7             # Log retention time in built-in Elasticsearch. It is 7 days by default.\n      elkPrefix: logstash      # The string making up index names. The index name will be formatted as ks-<elk_prefix>-log.\n      basicAuth:\n        enabled: false\n        username: \"\"\n        password: \"\"\n      externalElasticsearchHost: \"\"\n      externalElasticsearchPort: \"\"\n  alerting:                # (CPU: 0.1 Core, Memory: 100 MiB) It enables users to customize alerting policies to send messages to receivers in time with different time intervals and alerting levels to choose from.\n    enabled: true         # Enable or disable the KubeSphere Alerting System.\n    # thanosruler:\n    #   replicas: 1\n    #   resources: {}\n  auditing:                # Provide a security-relevant chronological set of records，recording the sequence of activities happening on the platform, initiated by different tenants.\n    enabled: true         # Enable or disable the KubeSphere Auditing Log System.\n    # operator:\n    #   resources: {}\n    # webhook:\n    #   resources: {}\n  devops:                  # (CPU: 0.47 Core, Memory: 8.6 G) Provide an out-of-the-box CI/CD system based on Jenkins, and automated workflow tools including Source-to-Image & Binary-to-Image.\n    enabled: true             # Enable or disable the KubeSphere DevOps System.\n    # resources: {}\n    jenkinsMemoryLim: 8Gi      # Jenkins memory limit.\n    jenkinsMemoryReq: 4Gi   # Jenkins memory request.\n    jenkinsVolumeSize: 8Gi     # Jenkins volume size.\n  events:                  # Provide a graphical web console for Kubernetes Events exporting, filtering and alerting in multi-tenant Kubernetes clusters.\n    enabled: true         # Enable or disable the KubeSphere Events System.\n    # operator:\n    #   resources: {}\n    # exporter:\n    #   resources: {}\n    # ruler:\n    #   enabled: true\n    #   replicas: 2\n    #   resources: {}\n  logging:                 # (CPU: 57 m, Memory: 2.76 G) Flexible logging functions are provided for log query, collection and management in a unified console. Additional log collectors can be added, such as Elasticsearch, Kafka and Fluentd.\n    enabled: true         # Enable or disable the KubeSphere Logging System.\n    logsidecar:\n      enabled: true\n      replicas: 2\n      # resources: {}\n  metrics_server:                    # (CPU: 56 m, Memory: 44.35 MiB) It enables HPA (Horizontal Pod Autoscaler).\n    enabled: false                   # Enable or disable metrics-server.\n  monitoring:\n    storageClass: \"\"                 # If there is an independent StorageClass you need for Prometheus, you can specify it here. The default StorageClass is used by default.\n    node_exporter:\n      port: 9100\n      # resources: {}\n    # kube_rbac_proxy:\n    #   resources: {}\n    # kube_state_metrics:\n    #   resources: {}\n    # prometheus:\n    #   replicas: 1  # Prometheus replicas are responsible for monitoring different segments of data source and providing high availability.\n    #   volumeSize: 20Gi  # Prometheus PVC size.\n    #   resources: {}\n    #   operator:\n    #     resources: {}\n    # alertmanager:\n    #   replicas: 1          # AlertManager Replicas.\n    #   resources: {}\n    # notification_manager:\n    #   resources: {}\n    #   operator:\n    #     resources: {}\n    #   proxy:\n    #     resources: {}\n    gpu:                           # GPU monitoring-related plug-in installation.\n      nvidia_dcgm_exporter:        # Ensure that gpu resources on your hosts can be used normally, otherwise this plug-in will not work properly.\n        enabled: false             # Check whether the labels on the GPU hosts contain \"nvidia.com/gpu.present=true\" to ensure that the DCGM pod is scheduled to these nodes.\n        # resources: {}\n  multicluster:\n    clusterRole: none  # host | member | none  # You can install a solo cluster, or specify it as the Host or Member Cluster.\n  network:\n    networkpolicy: # Network policies allow network isolation within the same cluster, which means firewalls can be set up between certain instances (Pods).\n      # Make sure that the CNI network plugin used by the cluster supports NetworkPolicy. There are a number of CNI network plugins that support NetworkPolicy, including Calico, Cilium, Kube-router, Romana and Weave Net.\n      enabled: true # Enable or disable network policies.\n    ippool: # Use Pod IP Pools to manage the Pod network address space. Pods to be created can be assigned IP addresses from a Pod IP Pool.\n      type: none # Specify \"calico\" for this field if Calico is used as your CNI plugin. \"none\" means that Pod IP Pools are disabled.\n    topology: # Use Service Topology to view Service-to-Service communication based on Weave Scope.\n      type: none # Specify \"weave-scope\" for this field to enable Service Topology. \"none\" means that Service Topology is disabled.\n  openpitrix: # An App Store that is accessible to all platform tenants. You can use it to manage apps across their entire lifecycle.\n    store:\n      enabled: true # Enable or disable the KubeSphere App Store.\n  servicemesh:         # (0.3 Core, 300 MiB) Provide fine-grained traffic management, observability and tracing, and visualized traffic topology.\n    enabled: true     # Base component (pilot). Enable or disable KubeSphere Service Mesh (Istio-based).\n    istio:  # Customizing the istio installation configuration, refer to https://istio.io/latest/docs/setup/additional-setup/customize-installation/\n      components:\n        ingressGateways:\n        - name: istio-ingressgateway\n          enabled: false\n        cni:\n          enabled: false\n  edgeruntime:          # Add edge nodes to your cluster and deploy workloads on edge nodes.\n    enabled: false\n    kubeedge:        # kubeedge configurations\n      enabled: false\n      cloudCore:\n        cloudHub:\n          advertiseAddress: # At least a public IP address or an IP address which can be accessed by edge nodes must be provided.\n            - \"\"            # Note that once KubeEdge is enabled, CloudCore will malfunction if the address is not provided.\n        service:\n          cloudhubNodePort: \"30000\"\n          cloudhubQuicNodePort: \"30001\"\n          cloudhubHttpsNodePort: \"30002\"\n          cloudstreamNodePort: \"30003\"\n          tunnelNodePort: \"30004\"\n        # resources: {}\n        # hostNetWork: false\n      iptables-manager:\n        enabled: true \n        mode: \"external\"\n        # resources: {}\n      # edgeService:\n      #   resources: {}\n  gatekeeper:        # Provide admission policy and rule management, A validating (mutating TBA) webhook that enforces CRD-based policies executed by Open Policy Agent.\n    enabled: false   # Enable or disable Gatekeeper.\n    # controller_manager:\n    #   resources: {}\n    # audit:\n    #   resources: {}\n  terminal:\n    # image: 'alpine:3.15' # There must be an nsenter program in the image\n    timeout: 600         # Container timeout, if set to 0, no timeout will be used. The unit is seconds\n\n```\n\n#### 执行安装\n\n```shell\nkubectl apply -f kubesphere-installer.yaml\nkubectl apply -f cluster-configuration.yaml\n\n#如果出错 执行命令 删除后重新apply\nkubectl delete -f kubesphere-installer.yaml\nkubectl delete -f cluster-configuration.yaml\n```\n\n##### 安装中的坑\n\n```shell\n#minio timeout\n#修改\nkubectl -n kube-system edit configmap coredns\n\n#注释掉下面的\nforward . /etc/resolv.conf {\nmax_concurrent 1000\n}        \n#修改后重新执行\nkubectl apply -f kubesphere-installer.yaml\n#执行完成后 恢复到默认配置 然后再次执行\nkubectl delete -f cluster-configuration.yaml\n```\n\n#### 查看安装日志\n\n```shell\nkubectl logs -n kubesphere-system $(kubectl get pod -n kubesphere-system -l 'app in (ks-install, ks-installer)' -o jsonpath='{.items[0].metadata.name}') -f\n```\n\n#### 安装成功\n\n```\n#####################################################\n###              Welcome to KubeSphere!           ###\n#####################################################\n\nConsole: http://172.16.0.4:30880\nAccount: admin\nPassword: P@88w0rd\nNOTES：\n  1. After you log into the console, please check the\n     monitoring status of service components in\n     \"Cluster Management\". If any service is not\n     ready, please wait patiently until all components \n     are up and running.\n  2. Please change the default password after login.\n\n#####################################################\nhttps://kubesphere.io             2022-11-25 14:04:12\n#####################################################\n```\n\n\n\n","slug":"k8s和kubesphere搭建","published":1,"updated":"2023-01-03T08:04:37.660Z","comments":1,"layout":"post","photos":[],"link":"","_id":"clch7zqnc0001gcv0dp07gjgl","content":"<h3 id=\"安装containerd-每台机器\"><a href=\"#安装containerd-每台机器\" class=\"headerlink\" title=\"安装containerd(每台机器)\"></a>安装containerd(每台机器)</h3><p>参考</p>\n<p><a href=\"https://github.com/containerd/containerd/blob/main/docs/getting-started.md#step-1-installing-containerd\">https://github.com/containerd/containerd/blob/main/docs/getting-started.md#step-1-installing-containerd</a></p>\n<h4 id=\"安装容器\"><a href=\"#安装容器\" class=\"headerlink\" title=\"安装容器\"></a>安装容器</h4><p>从<a href=\"https://github.com/containerd/containerd/releases\">https://github.com/containerd/containerd/releases</a> 下载containerd-VERSION-OS-ARCH.tar.gz存档，并将其解压到：<code>/usr/local</code></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://github.com/containerd/containerd/releases/download/v1.6.10/containerd-1.6.10-linux-amd64.tar.gz</span><br><span class=\"line\">tar Cxzvf /usr/local containerd-1.6.10-linux-amd64.tar.gz</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"通过-systemd-启动-containerd\"><a href=\"#通过-systemd-启动-containerd\" class=\"headerlink\" title=\"通过 systemd 启动 containerd\"></a>通过 systemd 启动 containerd</h4><p><a href=\"https://raw.githubusercontent.com/containerd/containerd/main/containerd.service\">https://raw.githubusercontent.com/containerd/containerd/main/containerd.service</a></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://raw.githubusercontent.com/containerd/containerd/main/containerd.service</span><br></pre></td></tr></table></figure>\n\n<p>将下载的文件放到 &#x2F;etc&#x2F;systemd&#x2F;system</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mv containerd.service /etc/systemd/system</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">运行以下命令</span></span><br><span class=\"line\">systemctl daemon-reload</span><br><span class=\"line\">systemctl enable --now containerd</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"安装-runc\"><a href=\"#安装-runc\" class=\"headerlink\" title=\"安装 runc\"></a>安装 runc</h4><p>从<a href=\"https://github.com/opencontainers/runc/releases\">https://github.com/opencontainers/runc/releases </a> 下载<code>runc.&lt;ARCH&gt;</code>二进制文件，验证其 sha256sum，并将其安装到<code>/usr/local/sbin/runc</code></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://github.com/opencontainers/runc/releases/download/v1.1.4/runc.amd64</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">安装</span></span><br><span class=\"line\">install -m 755 runc.amd64 /usr/local/sbin/runc</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"安装CNI插件\"><a href=\"#安装CNI插件\" class=\"headerlink\" title=\"安装CNI插件\"></a>安装CNI插件</h4><p><a href=\"https://github.com/containernetworking/plugins/releases\">从https://github.com/containernetworking/plugins/releases</a>  下载<code>cni-plugins-&lt;OS&gt;-&lt;ARCH&gt;-&lt;VERSION&gt;.tgz</code>存档，并将其解压到：<code>/opt/cni/bin</code></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://github.com/containernetworking/plugins/releases/download/v1.1.1/cni-plugins-linux-amd64-v1.1.1.tgz</span><br><span class=\"line\"></span><br><span class=\"line\">mkdir -p /opt/cni/bin</span><br><span class=\"line\">tar Cxzvf /opt/cni/bin cni-plugins-linux-amd64-v1.1.1.tgz</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"修改cgroup驱动以及自定义镜像\"><a href=\"#修改cgroup驱动以及自定义镜像\" class=\"headerlink\" title=\"修改cgroup驱动以及自定义镜像\"></a>修改cgroup驱动以及自定义镜像</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">生成默认配置文件</span></span><br><span class=\"line\">containerd config default &gt; /etc/containerd/config.toml</span><br><span class=\"line\">vim /etc/containerd/config.toml</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"string\">plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.runc.options</span>]</span><br><span class=\"line\">            <span class=\"string\">......</span></span><br><span class=\"line\">            <span class=\"string\">Root</span> <span class=\"string\">=</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">            <span class=\"string\">ShimCgroup</span> <span class=\"string\">=</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">            <span class=\"string\">SystemdCgroup</span> <span class=\"string\">=</span> <span class=\"literal\">true</span> <span class=\"comment\"># 将false改为true</span></span><br><span class=\"line\">            </span><br><span class=\"line\">[<span class=\"string\">plugins.&quot;io.containerd.tracing.processor.v1.otlp&quot;</span>]</span><br><span class=\"line\">    <span class=\"string\">endpoint</span> <span class=\"string\">=</span> <span class=\"string\">&quot;https://registry.aliyuncs.com&quot;</span> <span class=\"comment\">#阿里云镜像</span></span><br><span class=\"line\">    <span class=\"string\">insecure</span> <span class=\"string\">=</span> <span class=\"literal\">false</span></span><br><span class=\"line\">    <span class=\"string\">protocol</span> <span class=\"string\">=</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">[<span class=\"string\">plugins.&quot;io.containerd.grpc.v1.cri&quot;</span>]</span><br><span class=\"line\">    <span class=\"string\">netns_mounts_under_state_dir</span> <span class=\"string\">=</span> <span class=\"literal\">false</span></span><br><span class=\"line\">    <span class=\"string\">restrict_oom_score_adj</span> <span class=\"string\">=</span> <span class=\"literal\">false</span></span><br><span class=\"line\">    <span class=\"comment\">#sandbox_image = &quot;k8s.gcr.io/pause:3.6&quot;</span></span><br><span class=\"line\">    <span class=\"string\">sandbox_image</span> <span class=\"string\">=</span> <span class=\"string\">&quot;registry.aliyuncs.com/google_containers/pause:3.8&quot;</span> <span class=\"comment\"># 修改成这样</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">重启containerd</span></span><br><span class=\"line\">systemctl daemon-reload</span><br><span class=\"line\">systemctl restart containerd</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"安装nerdctl\"><a href=\"#安装nerdctl\" class=\"headerlink\" title=\"安装nerdctl\"></a>安装nerdctl</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">下载精简版</span></span><br><span class=\"line\">wget https://github.com/containerd/nerdctl/releases/download/v1.0.0/nerdctl-1.0.0-linux-amd64.tar.gz</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">解压到/usr/local/bin</span></span><br><span class=\"line\">tar Cxzvvf /usr/local/bin nerdctl-1.0.0-linux-amd64.tar.gz</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装Kubernetes\"><a href=\"#安装Kubernetes\" class=\"headerlink\" title=\"安装Kubernetes\"></a>安装Kubernetes</h3><h4 id=\"设置每台机器的hostname以及hosts\"><a href=\"#设置每台机器的hostname以及hosts\" class=\"headerlink\" title=\"设置每台机器的hostname以及hosts\"></a>设置每台机器的hostname以及hosts</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">设置每个机器自己的hostname</span></span><br><span class=\"line\">hostnamectl set-hostname cfc-master</span><br><span class=\"line\">hostnamectl set-hostname cfc-node1</span><br><span class=\"line\">hostnamectl set-hostname cfc-node2</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">hosts</span></span><br><span class=\"line\">vim /etc/hosts</span><br><span class=\"line\"></span><br><span class=\"line\">172.16.0.4      cfc-master</span><br><span class=\"line\">172.16.0.120    cfc-node1</span><br><span class=\"line\">172.16.0.104    cfc-node2</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"关闭swap\"><a href=\"#关闭swap\" class=\"headerlink\" title=\"关闭swap\"></a>关闭swap</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">swapoff -a</span><br><span class=\"line\">sed -i &#x27;s/.*swap.*/#&amp;/&#x27; /etc/fstab</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"允许-iptables-检查桥接流量\"><a href=\"#允许-iptables-检查桥接流量\" class=\"headerlink\" title=\"允许 iptables 检查桥接流量\"></a>允许 iptables 检查桥接流量</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">允许 iptables 检查桥接流量</span></span><br><span class=\"line\">cat &lt;&lt;EOF | sudo tee /etc/modules-load.d/k8s.conf</span><br><span class=\"line\">br_netfilter</span><br><span class=\"line\">EOF</span><br><span class=\"line\"></span><br><span class=\"line\">cat &lt;&lt;EOF | sudo tee /etc/sysctl.d/k8s.conf</span><br><span class=\"line\">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class=\"line\">net.bridge.bridge-nf-call-iptables = 1</span><br><span class=\"line\">EOF</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">让配置生效</span></span><br><span class=\"line\">sudo sysctl --system</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"设置时区\"><a href=\"#设置时区\" class=\"headerlink\" title=\"设置时区\"></a>设置时区</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">timedatectl set-timezone Asia/Shanghai</span><br><span class=\"line\">systemctl restart rsyslog</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"配置k8s的yum源地址\"><a href=\"#配置k8s的yum源地址\" class=\"headerlink\" title=\"配置k8s的yum源地址\"></a>配置k8s的yum源地址</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &lt;&lt;EOF | sudo tee /etc/yum.repos.d/kubernetes.repo</span><br><span class=\"line\">[kubernetes]</span><br><span class=\"line\">name=Kubernetes</span><br><span class=\"line\">baseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64</span><br><span class=\"line\">enabled=1</span><br><span class=\"line\">gpgcheck=0</span><br><span class=\"line\">repo_gpgcheck=0</span><br><span class=\"line\">gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg</span><br><span class=\"line\">   http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"安装kubelet、kubeadm、kubectl\"><a href=\"#安装kubelet、kubeadm、kubectl\" class=\"headerlink\" title=\"安装kubelet、kubeadm、kubectl\"></a>安装kubelet、kubeadm、kubectl</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">指定版本安装</span></span><br><span class=\"line\">yum install -y kubelet-1.24.8 kubeadm-1.24.8 kubectl-1.24.8</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">设置启动</span></span><br><span class=\"line\">systemctl enable --now kubelet</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"初始化master节点\"><a href=\"#初始化master节点\" class=\"headerlink\" title=\"初始化master节点\"></a>初始化master节点</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubeadm init \\</span><br><span class=\"line\">--apiserver-advertise-address=172.16.0.4 \\</span><br><span class=\"line\">--control-plane-endpoint=cfc-master \\</span><br><span class=\"line\">--image-repository registry.aliyuncs.com/google_containers \\</span><br><span class=\"line\">--kubernetes-version v1.24.8 \\</span><br><span class=\"line\">--service-cidr=10.96.0.0/16 \\</span><br><span class=\"line\">--pod-network-cidr=192.168.0.0/16</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">重置命令 如果有问题的话</span></span><br><span class=\"line\">kubeadm reset</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"初始化结果\"><a href=\"#初始化结果\" class=\"headerlink\" title=\"初始化结果\"></a>初始化结果</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Your Kubernetes control-plane has initialized successfully!</span><br><span class=\"line\"></span><br><span class=\"line\">To start using your cluster, you need to run the following as a regular user:</span><br><span class=\"line\"></span><br><span class=\"line\">  mkdir -p $HOME/.kube</span><br><span class=\"line\">  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br><span class=\"line\">  sudo chown $(id -u):$(id -g) $HOME/.kube/config</span><br><span class=\"line\"></span><br><span class=\"line\">Alternatively, if you are the root user, you can run:</span><br><span class=\"line\"></span><br><span class=\"line\">  export KUBECONFIG=/etc/kubernetes/admin.conf</span><br><span class=\"line\"></span><br><span class=\"line\">You should now deploy a pod network to the cluster.</span><br><span class=\"line\">Run &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at:</span><br><span class=\"line\">  https://kubernetes.io/docs/concepts/cluster-administration/addons/</span><br><span class=\"line\"></span><br><span class=\"line\">You can now join any number of control-plane nodes by copying certificate authorities</span><br><span class=\"line\">and service account keys on each node and then running the following as root:</span><br><span class=\"line\"></span><br><span class=\"line\">  kubeadm join cfc-master:6443 --token ubt61k.dql9idffl61rbj27 \\</span><br><span class=\"line\">\t--discovery-token-ca-cert-hash sha256:45f8fe633b9711e94b78fa485f74519d96d08bd380d76d78324e800dbb82a76d \\</span><br><span class=\"line\">\t--control-plane </span><br><span class=\"line\"></span><br><span class=\"line\">Then you can join any number of worker nodes by running the following on each as root:</span><br><span class=\"line\"></span><br><span class=\"line\">kubeadm join cfc-master:6443 --token ubt61k.dql9idffl61rbj27 --discovery-token-ca-cert-hash sha256:45f8fe633b9711e94b78fa485f74519d96d08bd380d76d78324e800dbb82a76d</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">执行以下命令</span></span><br><span class=\"line\">echo &quot;export KUBECONFIG=/etc/kubernetes/admin.conf&quot; &gt;&gt; /etc/profile</span><br><span class=\"line\">追加到profile文件中</span><br><span class=\"line\">source /etc/profile</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"安装calico网络插件\"><a href=\"#安装calico网络插件\" class=\"headerlink\" title=\"安装calico网络插件\"></a>安装calico网络插件</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://docs.projectcalico.org/manifests/calico.yaml</span><br><span class=\"line\"></span><br><span class=\"line\">在</span><br><span class=\"line\">- name: CLUSTER_TYPE</span><br><span class=\"line\">  value: &quot;k8s,bgp&quot; </span><br><span class=\"line\">下增加两行</span><br><span class=\"line\">- name: IP_AUTODETECTION_METHOD</span><br><span class=\"line\">  value: &quot;interface=eth0&quot;</span><br><span class=\"line\">  </span><br><span class=\"line\">kubectl apply -f calico.yaml</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"加入worker节点\"><a href=\"#加入worker节点\" class=\"headerlink\" title=\"加入worker节点\"></a>加入worker节点</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubeadm join cfc-master:6443 --token ubt61k.dql9idffl61rbj27 --discovery-token-ca-cert-hash sha256:45f8fe633b9711e94b78fa485f74519d96d08bd380d76d78324e800dbb82a76d</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装KubeSphere前置环境\"><a href=\"#安装KubeSphere前置环境\" class=\"headerlink\" title=\"安装KubeSphere前置环境\"></a>安装KubeSphere前置环境</h3><h4 id=\"安装nfs-server\"><a href=\"#安装nfs-server\" class=\"headerlink\" title=\"安装nfs-server\"></a>安装nfs-server</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">在每个机器。</span></span><br><span class=\"line\">yum install -y nfs-utils</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">在master 执行以下命令</span> </span><br><span class=\"line\">echo &quot;/nfs/data/ *(insecure,rw,sync,no_root_squash)&quot; &gt; /etc/exports</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">执行以下命令，启动 nfs 服务;创建共享目录</span></span><br><span class=\"line\">mkdir -p /nfs/data</span><br><span class=\"line\"></span><br><span class=\"line\">systemctl enable rpcbind</span><br><span class=\"line\">systemctl enable nfs-server</span><br><span class=\"line\">systemctl start rpcbind</span><br><span class=\"line\">systemctl start nfs-server</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">使配置生效</span></span><br><span class=\"line\">exportfs -r</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">检查配置是否生效</span></span><br><span class=\"line\">exportfs</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"配置nfs-client\"><a href=\"#配置nfs-client\" class=\"headerlink\" title=\"配置nfs-client\"></a>配置nfs-client</h5><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">在node节点上执行以下命令</span></span><br><span class=\"line\">showmount -e 172.16.0.4</span><br><span class=\"line\"></span><br><span class=\"line\">mkdir -p /nfs/data</span><br><span class=\"line\"></span><br><span class=\"line\">mount -t nfs 172.16.0.4:/nfs/data /nfs/data</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"配置默认存储\"><a href=\"#配置默认存储\" class=\"headerlink\" title=\"配置默认存储\"></a>配置默认存储</h5><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi sc.yaml</span><br></pre></td></tr></table></figure>\n\n<p>sc.yaml内容如下</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">## 创建了一个存储类</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">storage.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">StorageClass</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">nfs-storage</span></span><br><span class=\"line\">  <span class=\"attr\">annotations:</span></span><br><span class=\"line\">    <span class=\"attr\">storageclass.kubernetes.io/is-default-class:</span> <span class=\"string\">&quot;true&quot;</span></span><br><span class=\"line\"><span class=\"attr\">provisioner:</span> <span class=\"string\">k8s-sigs.io/nfs-subdir-external-provisioner</span></span><br><span class=\"line\"><span class=\"attr\">parameters:</span></span><br><span class=\"line\">  <span class=\"attr\">archiveOnDelete:</span> <span class=\"string\">&quot;true&quot;</span>  <span class=\"comment\">## 删除pv的时候，pv的内容是否要备份</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">nfs-client-provisioner</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">nfs-client-provisioner</span></span><br><span class=\"line\">  <span class=\"comment\"># replace with namespace where provisioner is deployed</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">default</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"attr\">strategy:</span></span><br><span class=\"line\">    <span class=\"attr\">type:</span> <span class=\"string\">Recreate</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">nfs-client-provisioner</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">nfs-client-provisioner</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">serviceAccountName:</span> <span class=\"string\">nfs-client-provisioner</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">nfs-client-provisioner</span></span><br><span class=\"line\">          <span class=\"attr\">image:</span> <span class=\"string\">registry.cn-hangzhou.aliyuncs.com/lfy_k8s_images/nfs-subdir-external-provisioner:v4.0.2</span></span><br><span class=\"line\">          <span class=\"comment\"># resources:</span></span><br><span class=\"line\">          <span class=\"comment\">#    limits:</span></span><br><span class=\"line\">          <span class=\"comment\">#      cpu: 10m</span></span><br><span class=\"line\">          <span class=\"comment\">#    requests:</span></span><br><span class=\"line\">          <span class=\"comment\">#      cpu: 10m</span></span><br><span class=\"line\">          <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">nfs-client-root</span></span><br><span class=\"line\">              <span class=\"attr\">mountPath:</span> <span class=\"string\">/persistentvolumes</span></span><br><span class=\"line\">          <span class=\"attr\">env:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">PROVISIONER_NAME</span></span><br><span class=\"line\">              <span class=\"attr\">value:</span> <span class=\"string\">k8s-sigs.io/nfs-subdir-external-provisioner</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">NFS_SERVER</span></span><br><span class=\"line\">              <span class=\"attr\">value:</span> <span class=\"number\">172.16</span><span class=\"number\">.0</span><span class=\"number\">.4</span> <span class=\"comment\">## 指定自己nfs服务器地址</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">NFS_PATH</span>  </span><br><span class=\"line\">              <span class=\"attr\">value:</span> <span class=\"string\">/nfs/data</span>  <span class=\"comment\">## nfs服务器共享的目录</span></span><br><span class=\"line\">      <span class=\"attr\">volumes:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">nfs-client-root</span></span><br><span class=\"line\">          <span class=\"attr\">nfs:</span></span><br><span class=\"line\">            <span class=\"attr\">server:</span> <span class=\"number\">172.16</span><span class=\"number\">.0</span><span class=\"number\">.4</span></span><br><span class=\"line\">            <span class=\"attr\">path:</span> <span class=\"string\">/nfs/data</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">nfs-client-provisioner</span></span><br><span class=\"line\">  <span class=\"comment\"># replace with namespace where provisioner is deployed</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">default</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ClusterRole</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">nfs-client-provisioner-runner</span></span><br><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span> [<span class=\"string\">&quot;&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">resources:</span> [<span class=\"string\">&quot;nodes&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">verbs:</span> [<span class=\"string\">&quot;get&quot;</span>, <span class=\"string\">&quot;list&quot;</span>, <span class=\"string\">&quot;watch&quot;</span>]</span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span> [<span class=\"string\">&quot;&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">resources:</span> [<span class=\"string\">&quot;persistentvolumes&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">verbs:</span> [<span class=\"string\">&quot;get&quot;</span>, <span class=\"string\">&quot;list&quot;</span>, <span class=\"string\">&quot;watch&quot;</span>, <span class=\"string\">&quot;create&quot;</span>, <span class=\"string\">&quot;delete&quot;</span>]</span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span> [<span class=\"string\">&quot;&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">resources:</span> [<span class=\"string\">&quot;persistentvolumeclaims&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">verbs:</span> [<span class=\"string\">&quot;get&quot;</span>, <span class=\"string\">&quot;list&quot;</span>, <span class=\"string\">&quot;watch&quot;</span>, <span class=\"string\">&quot;update&quot;</span>]</span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span> [<span class=\"string\">&quot;storage.k8s.io&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">resources:</span> [<span class=\"string\">&quot;storageclasses&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">verbs:</span> [<span class=\"string\">&quot;get&quot;</span>, <span class=\"string\">&quot;list&quot;</span>, <span class=\"string\">&quot;watch&quot;</span>]</span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span> [<span class=\"string\">&quot;&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">resources:</span> [<span class=\"string\">&quot;events&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">verbs:</span> [<span class=\"string\">&quot;create&quot;</span>, <span class=\"string\">&quot;update&quot;</span>, <span class=\"string\">&quot;patch&quot;</span>]</span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ClusterRoleBinding</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">run-nfs-client-provisioner</span></span><br><span class=\"line\"><span class=\"attr\">subjects:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">nfs-client-provisioner</span></span><br><span class=\"line\">    <span class=\"comment\"># replace with namespace where provisioner is deployed</span></span><br><span class=\"line\">    <span class=\"attr\">namespace:</span> <span class=\"string\">default</span></span><br><span class=\"line\"><span class=\"attr\">roleRef:</span></span><br><span class=\"line\">  <span class=\"attr\">kind:</span> <span class=\"string\">ClusterRole</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">nfs-client-provisioner-runner</span></span><br><span class=\"line\">  <span class=\"attr\">apiGroup:</span> <span class=\"string\">rbac.authorization.k8s.io</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Role</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">leader-locking-nfs-client-provisioner</span></span><br><span class=\"line\">  <span class=\"comment\"># replace with namespace where provisioner is deployed</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">default</span></span><br><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span> [<span class=\"string\">&quot;&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">resources:</span> [<span class=\"string\">&quot;endpoints&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">verbs:</span> [<span class=\"string\">&quot;get&quot;</span>, <span class=\"string\">&quot;list&quot;</span>, <span class=\"string\">&quot;watch&quot;</span>, <span class=\"string\">&quot;create&quot;</span>, <span class=\"string\">&quot;update&quot;</span>, <span class=\"string\">&quot;patch&quot;</span>]</span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">RoleBinding</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">leader-locking-nfs-client-provisioner</span></span><br><span class=\"line\">  <span class=\"comment\"># replace with namespace where provisioner is deployed</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">default</span></span><br><span class=\"line\"><span class=\"attr\">subjects:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">nfs-client-provisioner</span></span><br><span class=\"line\">    <span class=\"comment\"># replace with namespace where provisioner is deployed</span></span><br><span class=\"line\">    <span class=\"attr\">namespace:</span> <span class=\"string\">default</span></span><br><span class=\"line\"><span class=\"attr\">roleRef:</span></span><br><span class=\"line\">  <span class=\"attr\">kind:</span> <span class=\"string\">Role</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">leader-locking-nfs-client-provisioner</span></span><br><span class=\"line\">  <span class=\"attr\">apiGroup:</span> <span class=\"string\">rbac.authorization.k8s.io</span></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"应用并检查是否生效\"><a href=\"#应用并检查是否生效\" class=\"headerlink\" title=\"应用并检查是否生效\"></a>应用并检查是否生效</h5><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">应用sc.yaml</span></span><br><span class=\"line\">kubectl apply -f sc.yaml</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">确认配置是否生效</span></span><br><span class=\"line\">kubectl get sc</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"安装metrics-server\"><a href=\"#安装metrics-server\" class=\"headerlink\" title=\"安装metrics-server\"></a>安装metrics-server</h4><p>集群指标监控组件</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi metrics.yaml</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"metrics-yaml文件内容如下\"><a href=\"#metrics-yaml文件内容如下\" class=\"headerlink\" title=\"metrics.yaml文件内容如下\"></a>metrics.yaml文件内容如下</h5><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kube-system</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ClusterRole</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">    <span class=\"attr\">rbac.authorization.k8s.io/aggregate-to-admin:</span> <span class=\"string\">&quot;true&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">rbac.authorization.k8s.io/aggregate-to-edit:</span> <span class=\"string\">&quot;true&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">rbac.authorization.k8s.io/aggregate-to-view:</span> <span class=\"string\">&quot;true&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">system:aggregated-metrics-reader</span></span><br><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">metrics.k8s.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">pods</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">nodes</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">get</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">list</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">watch</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ClusterRole</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">system:metrics-server</span></span><br><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">pods</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">nodes</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">nodes/stats</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">namespaces</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">configmaps</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">get</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">list</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">watch</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">RoleBinding</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">metrics-server-auth-reader</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kube-system</span></span><br><span class=\"line\"><span class=\"attr\">roleRef:</span></span><br><span class=\"line\">  <span class=\"attr\">apiGroup:</span> <span class=\"string\">rbac.authorization.k8s.io</span></span><br><span class=\"line\">  <span class=\"attr\">kind:</span> <span class=\"string\">Role</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">extension-apiserver-authentication-reader</span></span><br><span class=\"line\"><span class=\"attr\">subjects:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kube-system</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ClusterRoleBinding</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">metrics-server:system:auth-delegator</span></span><br><span class=\"line\"><span class=\"attr\">roleRef:</span></span><br><span class=\"line\">  <span class=\"attr\">apiGroup:</span> <span class=\"string\">rbac.authorization.k8s.io</span></span><br><span class=\"line\">  <span class=\"attr\">kind:</span> <span class=\"string\">ClusterRole</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">system:auth-delegator</span></span><br><span class=\"line\"><span class=\"attr\">subjects:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kube-system</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ClusterRoleBinding</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">system:metrics-server</span></span><br><span class=\"line\"><span class=\"attr\">roleRef:</span></span><br><span class=\"line\">  <span class=\"attr\">apiGroup:</span> <span class=\"string\">rbac.authorization.k8s.io</span></span><br><span class=\"line\">  <span class=\"attr\">kind:</span> <span class=\"string\">ClusterRole</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">system:metrics-server</span></span><br><span class=\"line\"><span class=\"attr\">subjects:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kube-system</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kube-system</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">ports:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">https</span></span><br><span class=\"line\">    <span class=\"attr\">port:</span> <span class=\"number\">443</span></span><br><span class=\"line\">    <span class=\"attr\">protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\">    <span class=\"attr\">targetPort:</span> <span class=\"string\">https</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kube-system</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">strategy:</span></span><br><span class=\"line\">    <span class=\"attr\">rollingUpdate:</span></span><br><span class=\"line\">      <span class=\"attr\">maxUnavailable:</span> <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">args:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">--cert-dir=/tmp</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">--kubelet-insecure-tls</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">--secure-port=4443</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">--kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">--kubelet-use-node-status-port</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">registry.cn-hangzhou.aliyuncs.com/lfy_k8s_images/metrics-server:v0.4.3</span></span><br><span class=\"line\">        <span class=\"attr\">imagePullPolicy:</span> <span class=\"string\">IfNotPresent</span></span><br><span class=\"line\">        <span class=\"attr\">livenessProbe:</span></span><br><span class=\"line\">          <span class=\"attr\">failureThreshold:</span> <span class=\"number\">3</span></span><br><span class=\"line\">          <span class=\"attr\">httpGet:</span></span><br><span class=\"line\">            <span class=\"attr\">path:</span> <span class=\"string\">/livez</span></span><br><span class=\"line\">            <span class=\"attr\">port:</span> <span class=\"string\">https</span></span><br><span class=\"line\">            <span class=\"attr\">scheme:</span> <span class=\"string\">HTTPS</span></span><br><span class=\"line\">          <span class=\"attr\">periodSeconds:</span> <span class=\"number\">10</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">        <span class=\"attr\">ports:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">containerPort:</span> <span class=\"number\">4443</span></span><br><span class=\"line\">          <span class=\"attr\">name:</span> <span class=\"string\">https</span></span><br><span class=\"line\">          <span class=\"attr\">protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\">        <span class=\"attr\">readinessProbe:</span></span><br><span class=\"line\">          <span class=\"attr\">failureThreshold:</span> <span class=\"number\">3</span></span><br><span class=\"line\">          <span class=\"attr\">httpGet:</span></span><br><span class=\"line\">            <span class=\"attr\">path:</span> <span class=\"string\">/readyz</span></span><br><span class=\"line\">            <span class=\"attr\">port:</span> <span class=\"string\">https</span></span><br><span class=\"line\">            <span class=\"attr\">scheme:</span> <span class=\"string\">HTTPS</span></span><br><span class=\"line\">          <span class=\"attr\">periodSeconds:</span> <span class=\"number\">10</span></span><br><span class=\"line\">        <span class=\"attr\">securityContext:</span></span><br><span class=\"line\">          <span class=\"attr\">readOnlyRootFilesystem:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">          <span class=\"attr\">runAsNonRoot:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">          <span class=\"attr\">runAsUser:</span> <span class=\"number\">1000</span></span><br><span class=\"line\">        <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">mountPath:</span> <span class=\"string\">/tmp</span></span><br><span class=\"line\">          <span class=\"attr\">name:</span> <span class=\"string\">tmp-dir</span></span><br><span class=\"line\">      <span class=\"attr\">nodeSelector:</span></span><br><span class=\"line\">        <span class=\"attr\">kubernetes.io/os:</span> <span class=\"string\">linux</span></span><br><span class=\"line\">      <span class=\"attr\">priorityClassName:</span> <span class=\"string\">system-cluster-critical</span></span><br><span class=\"line\">      <span class=\"attr\">serviceAccountName:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">      <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">emptyDir:</span> &#123;&#125;</span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">tmp-dir</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apiregistration.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">APIService</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">v1beta1.metrics.k8s.io</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">group:</span> <span class=\"string\">metrics.k8s.io</span></span><br><span class=\"line\">  <span class=\"attr\">groupPriorityMinimum:</span> <span class=\"number\">100</span></span><br><span class=\"line\">  <span class=\"attr\">insecureSkipTLSVerify:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">service:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">    <span class=\"attr\">namespace:</span> <span class=\"string\">kube-system</span></span><br><span class=\"line\">  <span class=\"attr\">version:</span> <span class=\"string\">v1beta1</span></span><br><span class=\"line\">  <span class=\"attr\">versionPriority:</span> <span class=\"number\">100</span></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"应用metrics-yaml\"><a href=\"#应用metrics-yaml\" class=\"headerlink\" title=\"应用metrics.yaml\"></a>应用metrics.yaml</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl apply -f metrics.yaml</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"检查是否生效\"><a href=\"#检查是否生效\" class=\"headerlink\" title=\"检查是否生效\"></a>检查是否生效</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl top nodes</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装KubeSphere\"><a href=\"#安装KubeSphere\" class=\"headerlink\" title=\"安装KubeSphere\"></a>安装KubeSphere</h3><h4 id=\"下载核心文件\"><a href=\"#下载核心文件\" class=\"headerlink\" title=\"下载核心文件\"></a>下载核心文件</h4><h5 id=\"下载kubesphere-installer-yaml\"><a href=\"#下载kubesphere-installer-yaml\" class=\"headerlink\" title=\"下载kubesphere-installer.yaml\"></a>下载kubesphere-installer.yaml</h5><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://github.com/kubesphere/ks-installer/releases/download/v3.3.1/kubesphere-installer.yaml</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">或者自行下载然后创建</span></span><br><span class=\"line\">vi kubesphere-installer.yaml</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apiextensions.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">CustomResourceDefinition</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">clusterconfigurations.installer.kubesphere.io</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">group:</span> <span class=\"string\">installer.kubesphere.io</span></span><br><span class=\"line\">  <span class=\"attr\">versions:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">v1alpha1</span></span><br><span class=\"line\">      <span class=\"attr\">served:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      <span class=\"attr\">storage:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      <span class=\"attr\">schema:</span></span><br><span class=\"line\">        <span class=\"attr\">openAPIV3Schema:</span></span><br><span class=\"line\">          <span class=\"attr\">type:</span> <span class=\"string\">object</span></span><br><span class=\"line\">          <span class=\"attr\">properties:</span></span><br><span class=\"line\">            <span class=\"attr\">spec:</span></span><br><span class=\"line\">              <span class=\"attr\">type:</span> <span class=\"string\">object</span></span><br><span class=\"line\">              <span class=\"attr\">x-kubernetes-preserve-unknown-fields:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">            <span class=\"attr\">status:</span></span><br><span class=\"line\">              <span class=\"attr\">type:</span> <span class=\"string\">object</span></span><br><span class=\"line\">              <span class=\"attr\">x-kubernetes-preserve-unknown-fields:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">scope:</span> <span class=\"string\">Namespaced</span></span><br><span class=\"line\">  <span class=\"attr\">names:</span></span><br><span class=\"line\">    <span class=\"attr\">plural:</span> <span class=\"string\">clusterconfigurations</span></span><br><span class=\"line\">    <span class=\"attr\">singular:</span> <span class=\"string\">clusterconfiguration</span></span><br><span class=\"line\">    <span class=\"attr\">kind:</span> <span class=\"string\">ClusterConfiguration</span></span><br><span class=\"line\">    <span class=\"attr\">shortNames:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">cc</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Namespace</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">kubesphere-system</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">ks-installer</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kubesphere-system</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ClusterRole</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">ks-installer</span></span><br><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">apps</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">extensions</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">batch</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">rbac.authorization.k8s.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">apiregistration.k8s.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">apiextensions.k8s.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">tenant.kubesphere.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">certificates.k8s.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">devops.kubesphere.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">monitoring.coreos.com</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">logging.kubesphere.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">jaegertracing.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">storage.k8s.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">admissionregistration.k8s.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">policy</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">autoscaling</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">networking.istio.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">config.istio.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">iam.kubesphere.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">notification.kubesphere.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">auditing.kubesphere.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">events.kubesphere.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">core.kubefed.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">installer.kubesphere.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">storage.kubesphere.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">security.istio.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">monitoring.kiali.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">kiali.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">networking.k8s.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">edgeruntime.kubesphere.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">types.kubefed.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">monitoring.kubesphere.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">application.kubesphere.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ClusterRoleBinding</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">ks-installer</span></span><br><span class=\"line\"><span class=\"attr\">subjects:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">ks-installer</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kubesphere-system</span></span><br><span class=\"line\"><span class=\"attr\">roleRef:</span></span><br><span class=\"line\">  <span class=\"attr\">kind:</span> <span class=\"string\">ClusterRole</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">ks-installer</span></span><br><span class=\"line\">  <span class=\"attr\">apiGroup:</span> <span class=\"string\">rbac.authorization.k8s.io</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">ks-installer</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kubesphere-system</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">ks-installer</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">ks-installer</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">ks-installer</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">serviceAccountName:</span> <span class=\"string\">ks-installer</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">installer</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">kubesphere/ks-installer:v3.3.1</span></span><br><span class=\"line\">        <span class=\"attr\">imagePullPolicy:</span> <span class=\"string\">&quot;Always&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">resources:</span></span><br><span class=\"line\">          <span class=\"attr\">limits:</span></span><br><span class=\"line\">            <span class=\"attr\">cpu:</span> <span class=\"string\">&quot;1&quot;</span></span><br><span class=\"line\">            <span class=\"attr\">memory:</span> <span class=\"string\">1Gi</span></span><br><span class=\"line\">          <span class=\"attr\">requests:</span></span><br><span class=\"line\">            <span class=\"attr\">cpu:</span> <span class=\"string\">20m</span></span><br><span class=\"line\">            <span class=\"attr\">memory:</span> <span class=\"string\">100Mi</span></span><br><span class=\"line\">        <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">mountPath:</span> <span class=\"string\">/etc/localtime</span></span><br><span class=\"line\">          <span class=\"attr\">name:</span> <span class=\"string\">host-time</span></span><br><span class=\"line\">          <span class=\"attr\">readOnly:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">hostPath:</span></span><br><span class=\"line\">          <span class=\"attr\">path:</span> <span class=\"string\">/etc/localtime</span></span><br><span class=\"line\">          <span class=\"attr\">type:</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">host-time</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h5 id=\"下载cluster-configuration-yaml\"><a href=\"#下载cluster-configuration-yaml\" class=\"headerlink\" title=\"下载cluster-configuration.yaml\"></a>下载cluster-configuration.yaml</h5><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://github.com/kubesphere/ks-installer/releases/download/v3.3.1/cluster-configuration.yaml</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">或者自行下载然后创建</span></span><br><span class=\"line\">vi cluster-configuration.yaml</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"修改后的cluster-configuration-yaml\"><a href=\"#修改后的cluster-configuration-yaml\" class=\"headerlink\" title=\"修改后的cluster-configuration.yaml\"></a>修改后的cluster-configuration.yaml</h5><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">installer.kubesphere.io/v1alpha1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ClusterConfiguration</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">ks-installer</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kubesphere-system</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">version:</span> <span class=\"string\">v3.3.1</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">persistence:</span></span><br><span class=\"line\">    <span class=\"attr\">storageClass:</span> <span class=\"string\">&quot;&quot;</span>        <span class=\"comment\"># If there is no default StorageClass in your cluster, you need to specify an existing StorageClass here.</span></span><br><span class=\"line\">  <span class=\"attr\">authentication:</span></span><br><span class=\"line\">    <span class=\"comment\"># adminPassword: &quot;&quot;     # Custom password of the admin user. If the parameter exists but the value is empty, a random password is generated. If the parameter does not exist, P@88w0rd is used.</span></span><br><span class=\"line\">    <span class=\"attr\">jwtSecret:</span> <span class=\"string\">&quot;&quot;</span>           <span class=\"comment\"># Keep the jwtSecret consistent with the Host Cluster. Retrieve the jwtSecret by executing &quot;kubectl -n kubesphere-system get cm kubesphere-config -o yaml | grep -v &quot;apiVersion&quot; | grep jwtSecret&quot; on the Host Cluster.</span></span><br><span class=\"line\">  <span class=\"attr\">local_registry:</span> <span class=\"string\">&quot;&quot;</span>        <span class=\"comment\"># Add your private registry address if it is needed.</span></span><br><span class=\"line\">  <span class=\"comment\"># dev_tag: &quot;&quot;               # Add your kubesphere image tag you want to install, by default it&#x27;s same as ks-installer release version.</span></span><br><span class=\"line\">  <span class=\"attr\">etcd:</span></span><br><span class=\"line\">    <span class=\"attr\">monitoring:</span> <span class=\"literal\">false</span>       <span class=\"comment\"># Enable or disable etcd monitoring dashboard installation. You have to create a Secret for etcd before you enable it.</span></span><br><span class=\"line\">    <span class=\"attr\">endpointIps:</span> <span class=\"number\">172.16</span><span class=\"number\">.0</span><span class=\"number\">.4</span>  <span class=\"comment\"># etcd cluster EndpointIps. It can be a bunch of IPs here.</span></span><br><span class=\"line\">    <span class=\"attr\">port:</span> <span class=\"number\">2379</span>              <span class=\"comment\"># etcd port.</span></span><br><span class=\"line\">    <span class=\"attr\">tlsEnable:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">common:</span></span><br><span class=\"line\">    <span class=\"attr\">core:</span></span><br><span class=\"line\">      <span class=\"attr\">console:</span></span><br><span class=\"line\">        <span class=\"attr\">enableMultiLogin:</span> <span class=\"literal\">true</span>  <span class=\"comment\"># Enable or disable simultaneous logins. It allows different users to log in with the same account at the same time.</span></span><br><span class=\"line\">        <span class=\"attr\">port:</span> <span class=\"number\">30880</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">NodePort</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># apiserver:            # Enlarge the apiserver and controller manager&#x27;s resource requests and limits for the large cluster</span></span><br><span class=\"line\">    <span class=\"comment\">#  resources: &#123;&#125;</span></span><br><span class=\"line\">    <span class=\"comment\"># controllerManager:</span></span><br><span class=\"line\">    <span class=\"comment\">#  resources: &#123;&#125;</span></span><br><span class=\"line\">    <span class=\"attr\">redis:</span></span><br><span class=\"line\">      <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      <span class=\"attr\">enableHA:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">      <span class=\"attr\">volumeSize:</span> <span class=\"string\">2Gi</span> <span class=\"comment\"># Redis PVC size.</span></span><br><span class=\"line\">    <span class=\"attr\">openldap:</span></span><br><span class=\"line\">      <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      <span class=\"attr\">volumeSize:</span> <span class=\"string\">2Gi</span>   <span class=\"comment\"># openldap PVC size.</span></span><br><span class=\"line\">    <span class=\"attr\">minio:</span></span><br><span class=\"line\">      <span class=\"attr\">volumeSize:</span> <span class=\"string\">20Gi</span> <span class=\"comment\"># Minio PVC size.</span></span><br><span class=\"line\">    <span class=\"attr\">monitoring:</span></span><br><span class=\"line\">      <span class=\"comment\"># type: external   # Whether to specify the external prometheus stack, and need to modify the endpoint at the next line.</span></span><br><span class=\"line\">      <span class=\"attr\">endpoint:</span> <span class=\"string\">http://prometheus-operated.kubesphere-monitoring-system.svc:9090</span> <span class=\"comment\"># Prometheus endpoint to get metrics data.</span></span><br><span class=\"line\">      <span class=\"attr\">GPUMonitoring:</span>     <span class=\"comment\"># Enable or disable the GPU-related metrics. If you enable this switch but have no GPU resources, Kubesphere will set it to zero.</span></span><br><span class=\"line\">        <span class=\"attr\">enabled:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">    <span class=\"attr\">gpu:</span>                 <span class=\"comment\"># Install GPUKinds. The default GPU kind is nvidia.com/gpu. Other GPU kinds can be added here according to your needs.</span></span><br><span class=\"line\">      <span class=\"attr\">kinds:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">resourceName:</span> <span class=\"string\">&quot;nvidia.com/gpu&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">resourceType:</span> <span class=\"string\">&quot;GPU&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">default:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">es:</span>   <span class=\"comment\"># Storage backend for logging, events and auditing.</span></span><br><span class=\"line\">      <span class=\"comment\"># master:</span></span><br><span class=\"line\">      <span class=\"comment\">#   volumeSize: 4Gi  # The volume size of Elasticsearch master nodes.</span></span><br><span class=\"line\">      <span class=\"comment\">#   replicas: 1      # The total number of master nodes. Even numbers are not allowed.</span></span><br><span class=\"line\">      <span class=\"comment\">#   resources: &#123;&#125;</span></span><br><span class=\"line\">      <span class=\"comment\"># data:</span></span><br><span class=\"line\">      <span class=\"comment\">#   volumeSize: 20Gi  # The volume size of Elasticsearch data nodes.</span></span><br><span class=\"line\">      <span class=\"comment\">#   replicas: 1       # The total number of data nodes.</span></span><br><span class=\"line\">      <span class=\"comment\">#   resources: &#123;&#125;</span></span><br><span class=\"line\">      <span class=\"attr\">logMaxAge:</span> <span class=\"number\">7</span>             <span class=\"comment\"># Log retention time in built-in Elasticsearch. It is 7 days by default.</span></span><br><span class=\"line\">      <span class=\"attr\">elkPrefix:</span> <span class=\"string\">logstash</span>      <span class=\"comment\"># The string making up index names. The index name will be formatted as ks-&lt;elk_prefix&gt;-log.</span></span><br><span class=\"line\">      <span class=\"attr\">basicAuth:</span></span><br><span class=\"line\">        <span class=\"attr\">enabled:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">        <span class=\"attr\">username:</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">password:</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">      <span class=\"attr\">externalElasticsearchHost:</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">      <span class=\"attr\">externalElasticsearchPort:</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">alerting:</span>                <span class=\"comment\"># (CPU: 0.1 Core, Memory: 100 MiB) It enables users to customize alerting policies to send messages to receivers in time with different time intervals and alerting levels to choose from.</span></span><br><span class=\"line\">    <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span>         <span class=\"comment\"># Enable or disable the KubeSphere Alerting System.</span></span><br><span class=\"line\">    <span class=\"comment\"># thanosruler:</span></span><br><span class=\"line\">    <span class=\"comment\">#   replicas: 1</span></span><br><span class=\"line\">    <span class=\"comment\">#   resources: &#123;&#125;</span></span><br><span class=\"line\">  <span class=\"attr\">auditing:</span>                <span class=\"comment\"># Provide a security-relevant chronological set of records，recording the sequence of activities happening on the platform, initiated by different tenants.</span></span><br><span class=\"line\">    <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span>         <span class=\"comment\"># Enable or disable the KubeSphere Auditing Log System.</span></span><br><span class=\"line\">    <span class=\"comment\"># operator:</span></span><br><span class=\"line\">    <span class=\"comment\">#   resources: &#123;&#125;</span></span><br><span class=\"line\">    <span class=\"comment\"># webhook:</span></span><br><span class=\"line\">    <span class=\"comment\">#   resources: &#123;&#125;</span></span><br><span class=\"line\">  <span class=\"attr\">devops:</span>                  <span class=\"comment\"># (CPU: 0.47 Core, Memory: 8.6 G) Provide an out-of-the-box CI/CD system based on Jenkins, and automated workflow tools including Source-to-Image &amp; Binary-to-Image.</span></span><br><span class=\"line\">    <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span>             <span class=\"comment\"># Enable or disable the KubeSphere DevOps System.</span></span><br><span class=\"line\">    <span class=\"comment\"># resources: &#123;&#125;</span></span><br><span class=\"line\">    <span class=\"attr\">jenkinsMemoryLim:</span> <span class=\"string\">8Gi</span>      <span class=\"comment\"># Jenkins memory limit.</span></span><br><span class=\"line\">    <span class=\"attr\">jenkinsMemoryReq:</span> <span class=\"string\">4Gi</span>   <span class=\"comment\"># Jenkins memory request.</span></span><br><span class=\"line\">    <span class=\"attr\">jenkinsVolumeSize:</span> <span class=\"string\">8Gi</span>     <span class=\"comment\"># Jenkins volume size.</span></span><br><span class=\"line\">  <span class=\"attr\">events:</span>                  <span class=\"comment\"># Provide a graphical web console for Kubernetes Events exporting, filtering and alerting in multi-tenant Kubernetes clusters.</span></span><br><span class=\"line\">    <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span>         <span class=\"comment\"># Enable or disable the KubeSphere Events System.</span></span><br><span class=\"line\">    <span class=\"comment\"># operator:</span></span><br><span class=\"line\">    <span class=\"comment\">#   resources: &#123;&#125;</span></span><br><span class=\"line\">    <span class=\"comment\"># exporter:</span></span><br><span class=\"line\">    <span class=\"comment\">#   resources: &#123;&#125;</span></span><br><span class=\"line\">    <span class=\"comment\"># ruler:</span></span><br><span class=\"line\">    <span class=\"comment\">#   enabled: true</span></span><br><span class=\"line\">    <span class=\"comment\">#   replicas: 2</span></span><br><span class=\"line\">    <span class=\"comment\">#   resources: &#123;&#125;</span></span><br><span class=\"line\">  <span class=\"attr\">logging:</span>                 <span class=\"comment\"># (CPU: 57 m, Memory: 2.76 G) Flexible logging functions are provided for log query, collection and management in a unified console. Additional log collectors can be added, such as Elasticsearch, Kafka and Fluentd.</span></span><br><span class=\"line\">    <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span>         <span class=\"comment\"># Enable or disable the KubeSphere Logging System.</span></span><br><span class=\"line\">    <span class=\"attr\">logsidecar:</span></span><br><span class=\"line\">      <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      <span class=\"attr\">replicas:</span> <span class=\"number\">2</span></span><br><span class=\"line\">      <span class=\"comment\"># resources: &#123;&#125;</span></span><br><span class=\"line\">  <span class=\"attr\">metrics_server:</span>                    <span class=\"comment\"># (CPU: 56 m, Memory: 44.35 MiB) It enables HPA (Horizontal Pod Autoscaler).</span></span><br><span class=\"line\">    <span class=\"attr\">enabled:</span> <span class=\"literal\">false</span>                   <span class=\"comment\"># Enable or disable metrics-server.</span></span><br><span class=\"line\">  <span class=\"attr\">monitoring:</span></span><br><span class=\"line\">    <span class=\"attr\">storageClass:</span> <span class=\"string\">&quot;&quot;</span>                 <span class=\"comment\"># If there is an independent StorageClass you need for Prometheus, you can specify it here. The default StorageClass is used by default.</span></span><br><span class=\"line\">    <span class=\"attr\">node_exporter:</span></span><br><span class=\"line\">      <span class=\"attr\">port:</span> <span class=\"number\">9100</span></span><br><span class=\"line\">      <span class=\"comment\"># resources: &#123;&#125;</span></span><br><span class=\"line\">    <span class=\"comment\"># kube_rbac_proxy:</span></span><br><span class=\"line\">    <span class=\"comment\">#   resources: &#123;&#125;</span></span><br><span class=\"line\">    <span class=\"comment\"># kube_state_metrics:</span></span><br><span class=\"line\">    <span class=\"comment\">#   resources: &#123;&#125;</span></span><br><span class=\"line\">    <span class=\"comment\"># prometheus:</span></span><br><span class=\"line\">    <span class=\"comment\">#   replicas: 1  # Prometheus replicas are responsible for monitoring different segments of data source and providing high availability.</span></span><br><span class=\"line\">    <span class=\"comment\">#   volumeSize: 20Gi  # Prometheus PVC size.</span></span><br><span class=\"line\">    <span class=\"comment\">#   resources: &#123;&#125;</span></span><br><span class=\"line\">    <span class=\"comment\">#   operator:</span></span><br><span class=\"line\">    <span class=\"comment\">#     resources: &#123;&#125;</span></span><br><span class=\"line\">    <span class=\"comment\"># alertmanager:</span></span><br><span class=\"line\">    <span class=\"comment\">#   replicas: 1          # AlertManager Replicas.</span></span><br><span class=\"line\">    <span class=\"comment\">#   resources: &#123;&#125;</span></span><br><span class=\"line\">    <span class=\"comment\"># notification_manager:</span></span><br><span class=\"line\">    <span class=\"comment\">#   resources: &#123;&#125;</span></span><br><span class=\"line\">    <span class=\"comment\">#   operator:</span></span><br><span class=\"line\">    <span class=\"comment\">#     resources: &#123;&#125;</span></span><br><span class=\"line\">    <span class=\"comment\">#   proxy:</span></span><br><span class=\"line\">    <span class=\"comment\">#     resources: &#123;&#125;</span></span><br><span class=\"line\">    <span class=\"attr\">gpu:</span>                           <span class=\"comment\"># GPU monitoring-related plug-in installation.</span></span><br><span class=\"line\">      <span class=\"attr\">nvidia_dcgm_exporter:</span>        <span class=\"comment\"># Ensure that gpu resources on your hosts can be used normally, otherwise this plug-in will not work properly.</span></span><br><span class=\"line\">        <span class=\"attr\">enabled:</span> <span class=\"literal\">false</span>             <span class=\"comment\"># Check whether the labels on the GPU hosts contain &quot;nvidia.com/gpu.present=true&quot; to ensure that the DCGM pod is scheduled to these nodes.</span></span><br><span class=\"line\">        <span class=\"comment\"># resources: &#123;&#125;</span></span><br><span class=\"line\">  <span class=\"attr\">multicluster:</span></span><br><span class=\"line\">    <span class=\"attr\">clusterRole:</span> <span class=\"string\">none</span>  <span class=\"comment\"># host | member | none  # You can install a solo cluster, or specify it as the Host or Member Cluster.</span></span><br><span class=\"line\">  <span class=\"attr\">network:</span></span><br><span class=\"line\">    <span class=\"attr\">networkpolicy:</span> <span class=\"comment\"># Network policies allow network isolation within the same cluster, which means firewalls can be set up between certain instances (Pods).</span></span><br><span class=\"line\">      <span class=\"comment\"># Make sure that the CNI network plugin used by the cluster supports NetworkPolicy. There are a number of CNI network plugins that support NetworkPolicy, including Calico, Cilium, Kube-router, Romana and Weave Net.</span></span><br><span class=\"line\">      <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span> <span class=\"comment\"># Enable or disable network policies.</span></span><br><span class=\"line\">    <span class=\"attr\">ippool:</span> <span class=\"comment\"># Use Pod IP Pools to manage the Pod network address space. Pods to be created can be assigned IP addresses from a Pod IP Pool.</span></span><br><span class=\"line\">      <span class=\"attr\">type:</span> <span class=\"string\">none</span> <span class=\"comment\"># Specify &quot;calico&quot; for this field if Calico is used as your CNI plugin. &quot;none&quot; means that Pod IP Pools are disabled.</span></span><br><span class=\"line\">    <span class=\"attr\">topology:</span> <span class=\"comment\"># Use Service Topology to view Service-to-Service communication based on Weave Scope.</span></span><br><span class=\"line\">      <span class=\"attr\">type:</span> <span class=\"string\">none</span> <span class=\"comment\"># Specify &quot;weave-scope&quot; for this field to enable Service Topology. &quot;none&quot; means that Service Topology is disabled.</span></span><br><span class=\"line\">  <span class=\"attr\">openpitrix:</span> <span class=\"comment\"># An App Store that is accessible to all platform tenants. You can use it to manage apps across their entire lifecycle.</span></span><br><span class=\"line\">    <span class=\"attr\">store:</span></span><br><span class=\"line\">      <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span> <span class=\"comment\"># Enable or disable the KubeSphere App Store.</span></span><br><span class=\"line\">  <span class=\"attr\">servicemesh:</span>         <span class=\"comment\"># (0.3 Core, 300 MiB) Provide fine-grained traffic management, observability and tracing, and visualized traffic topology.</span></span><br><span class=\"line\">    <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span>     <span class=\"comment\"># Base component (pilot). Enable or disable KubeSphere Service Mesh (Istio-based).</span></span><br><span class=\"line\">    <span class=\"attr\">istio:</span>  <span class=\"comment\"># Customizing the istio installation configuration, refer to https://istio.io/latest/docs/setup/additional-setup/customize-installation/</span></span><br><span class=\"line\">      <span class=\"attr\">components:</span></span><br><span class=\"line\">        <span class=\"attr\">ingressGateways:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">istio-ingressgateway</span></span><br><span class=\"line\">          <span class=\"attr\">enabled:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">        <span class=\"attr\">cni:</span></span><br><span class=\"line\">          <span class=\"attr\">enabled:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"attr\">edgeruntime:</span>          <span class=\"comment\"># Add edge nodes to your cluster and deploy workloads on edge nodes.</span></span><br><span class=\"line\">    <span class=\"attr\">enabled:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">    <span class=\"attr\">kubeedge:</span>        <span class=\"comment\"># kubeedge configurations</span></span><br><span class=\"line\">      <span class=\"attr\">enabled:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">      <span class=\"attr\">cloudCore:</span></span><br><span class=\"line\">        <span class=\"attr\">cloudHub:</span></span><br><span class=\"line\">          <span class=\"attr\">advertiseAddress:</span> <span class=\"comment\"># At least a public IP address or an IP address which can be accessed by edge nodes must be provided.</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">&quot;&quot;</span>            <span class=\"comment\"># Note that once KubeEdge is enabled, CloudCore will malfunction if the address is not provided.</span></span><br><span class=\"line\">        <span class=\"attr\">service:</span></span><br><span class=\"line\">          <span class=\"attr\">cloudhubNodePort:</span> <span class=\"string\">&quot;30000&quot;</span></span><br><span class=\"line\">          <span class=\"attr\">cloudhubQuicNodePort:</span> <span class=\"string\">&quot;30001&quot;</span></span><br><span class=\"line\">          <span class=\"attr\">cloudhubHttpsNodePort:</span> <span class=\"string\">&quot;30002&quot;</span></span><br><span class=\"line\">          <span class=\"attr\">cloudstreamNodePort:</span> <span class=\"string\">&quot;30003&quot;</span></span><br><span class=\"line\">          <span class=\"attr\">tunnelNodePort:</span> <span class=\"string\">&quot;30004&quot;</span></span><br><span class=\"line\">        <span class=\"comment\"># resources: &#123;&#125;</span></span><br><span class=\"line\">        <span class=\"comment\"># hostNetWork: false</span></span><br><span class=\"line\">      <span class=\"attr\">iptables-manager:</span></span><br><span class=\"line\">        <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span> </span><br><span class=\"line\">        <span class=\"attr\">mode:</span> <span class=\"string\">&quot;external&quot;</span></span><br><span class=\"line\">        <span class=\"comment\"># resources: &#123;&#125;</span></span><br><span class=\"line\">      <span class=\"comment\"># edgeService:</span></span><br><span class=\"line\">      <span class=\"comment\">#   resources: &#123;&#125;</span></span><br><span class=\"line\">  <span class=\"attr\">gatekeeper:</span>        <span class=\"comment\"># Provide admission policy and rule management, A validating (mutating TBA) webhook that enforces CRD-based policies executed by Open Policy Agent.</span></span><br><span class=\"line\">    <span class=\"attr\">enabled:</span> <span class=\"literal\">false</span>   <span class=\"comment\"># Enable or disable Gatekeeper.</span></span><br><span class=\"line\">    <span class=\"comment\"># controller_manager:</span></span><br><span class=\"line\">    <span class=\"comment\">#   resources: &#123;&#125;</span></span><br><span class=\"line\">    <span class=\"comment\"># audit:</span></span><br><span class=\"line\">    <span class=\"comment\">#   resources: &#123;&#125;</span></span><br><span class=\"line\">  <span class=\"attr\">terminal:</span></span><br><span class=\"line\">    <span class=\"comment\"># image: &#x27;alpine:3.15&#x27; # There must be an nsenter program in the image</span></span><br><span class=\"line\">    <span class=\"attr\">timeout:</span> <span class=\"number\">600</span>         <span class=\"comment\"># Container timeout, if set to 0, no timeout will be used. The unit is seconds</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"执行安装\"><a href=\"#执行安装\" class=\"headerlink\" title=\"执行安装\"></a>执行安装</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl apply -f kubesphere-installer.yaml</span><br><span class=\"line\">kubectl apply -f cluster-configuration.yaml</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">如果出错 执行命令 删除后重新apply</span></span><br><span class=\"line\">kubectl delete -f kubesphere-installer.yaml</span><br><span class=\"line\">kubectl delete -f cluster-configuration.yaml</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"安装中的坑\"><a href=\"#安装中的坑\" class=\"headerlink\" title=\"安装中的坑\"></a>安装中的坑</h5><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">minio <span class=\"built_in\">timeout</span></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">修改</span></span><br><span class=\"line\">kubectl -n kube-system edit configmap coredns</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">注释掉下面的</span></span><br><span class=\"line\">forward . /etc/resolv.conf &#123;</span><br><span class=\"line\">max_concurrent 1000</span><br><span class=\"line\">&#125;        </span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">修改后重新执行</span></span><br><span class=\"line\">kubectl apply -f kubesphere-installer.yaml</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">执行完成后 恢复到默认配置 然后再次执行</span></span><br><span class=\"line\">kubectl delete -f cluster-configuration.yaml</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"查看安装日志\"><a href=\"#查看安装日志\" class=\"headerlink\" title=\"查看安装日志\"></a>查看安装日志</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl logs -n kubesphere-system $(kubectl get pod -n kubesphere-system -l &#x27;app in (ks-install, ks-installer)&#x27; -o jsonpath=&#x27;&#123;.items[0].metadata.name&#125;&#x27;) -f</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"安装成功\"><a href=\"#安装成功\" class=\"headerlink\" title=\"安装成功\"></a>安装成功</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#####################################################</span><br><span class=\"line\">###              Welcome to KubeSphere!           ###</span><br><span class=\"line\">#####################################################</span><br><span class=\"line\"></span><br><span class=\"line\">Console: http://172.16.0.4:30880</span><br><span class=\"line\">Account: admin</span><br><span class=\"line\">Password: P@88w0rd</span><br><span class=\"line\">NOTES：</span><br><span class=\"line\">  1. After you log into the console, please check the</span><br><span class=\"line\">     monitoring status of service components in</span><br><span class=\"line\">     &quot;Cluster Management&quot;. If any service is not</span><br><span class=\"line\">     ready, please wait patiently until all components </span><br><span class=\"line\">     are up and running.</span><br><span class=\"line\">  2. Please change the default password after login.</span><br><span class=\"line\"></span><br><span class=\"line\">#####################################################</span><br><span class=\"line\">https://kubesphere.io             2022-11-25 14:04:12</span><br><span class=\"line\">#####################################################</span><br></pre></td></tr></table></figure>\n\n\n\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"安装containerd-每台机器\"><a href=\"#安装containerd-每台机器\" class=\"headerlink\" title=\"安装containerd(每台机器)\"></a>安装containerd(每台机器)</h3><p>参考</p>\n<p><a href=\"https://github.com/containerd/containerd/blob/main/docs/getting-started.md#step-1-installing-containerd\">https://github.com/containerd/containerd/blob/main/docs/getting-started.md#step-1-installing-containerd</a></p>\n<h4 id=\"安装容器\"><a href=\"#安装容器\" class=\"headerlink\" title=\"安装容器\"></a>安装容器</h4><p>从<a href=\"https://github.com/containerd/containerd/releases\">https://github.com/containerd/containerd/releases</a> 下载containerd-VERSION-OS-ARCH.tar.gz存档，并将其解压到：<code>/usr/local</code></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://github.com/containerd/containerd/releases/download/v1.6.10/containerd-1.6.10-linux-amd64.tar.gz</span><br><span class=\"line\">tar Cxzvf /usr/local containerd-1.6.10-linux-amd64.tar.gz</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"通过-systemd-启动-containerd\"><a href=\"#通过-systemd-启动-containerd\" class=\"headerlink\" title=\"通过 systemd 启动 containerd\"></a>通过 systemd 启动 containerd</h4><p><a href=\"https://raw.githubusercontent.com/containerd/containerd/main/containerd.service\">https://raw.githubusercontent.com/containerd/containerd/main/containerd.service</a></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://raw.githubusercontent.com/containerd/containerd/main/containerd.service</span><br></pre></td></tr></table></figure>\n\n<p>将下载的文件放到 &#x2F;etc&#x2F;systemd&#x2F;system</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mv containerd.service /etc/systemd/system</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">运行以下命令</span></span><br><span class=\"line\">systemctl daemon-reload</span><br><span class=\"line\">systemctl enable --now containerd</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"安装-runc\"><a href=\"#安装-runc\" class=\"headerlink\" title=\"安装 runc\"></a>安装 runc</h4><p>从<a href=\"https://github.com/opencontainers/runc/releases\">https://github.com/opencontainers/runc/releases </a> 下载<code>runc.&lt;ARCH&gt;</code>二进制文件，验证其 sha256sum，并将其安装到<code>/usr/local/sbin/runc</code></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://github.com/opencontainers/runc/releases/download/v1.1.4/runc.amd64</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">安装</span></span><br><span class=\"line\">install -m 755 runc.amd64 /usr/local/sbin/runc</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"安装CNI插件\"><a href=\"#安装CNI插件\" class=\"headerlink\" title=\"安装CNI插件\"></a>安装CNI插件</h4><p><a href=\"https://github.com/containernetworking/plugins/releases\">从https://github.com/containernetworking/plugins/releases</a>  下载<code>cni-plugins-&lt;OS&gt;-&lt;ARCH&gt;-&lt;VERSION&gt;.tgz</code>存档，并将其解压到：<code>/opt/cni/bin</code></p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://github.com/containernetworking/plugins/releases/download/v1.1.1/cni-plugins-linux-amd64-v1.1.1.tgz</span><br><span class=\"line\"></span><br><span class=\"line\">mkdir -p /opt/cni/bin</span><br><span class=\"line\">tar Cxzvf /opt/cni/bin cni-plugins-linux-amd64-v1.1.1.tgz</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"修改cgroup驱动以及自定义镜像\"><a href=\"#修改cgroup驱动以及自定义镜像\" class=\"headerlink\" title=\"修改cgroup驱动以及自定义镜像\"></a>修改cgroup驱动以及自定义镜像</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">生成默认配置文件</span></span><br><span class=\"line\">containerd config default &gt; /etc/containerd/config.toml</span><br><span class=\"line\">vim /etc/containerd/config.toml</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[<span class=\"string\">plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.runc.options</span>]</span><br><span class=\"line\">            <span class=\"string\">......</span></span><br><span class=\"line\">            <span class=\"string\">Root</span> <span class=\"string\">=</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">            <span class=\"string\">ShimCgroup</span> <span class=\"string\">=</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">            <span class=\"string\">SystemdCgroup</span> <span class=\"string\">=</span> <span class=\"literal\">true</span> <span class=\"comment\"># 将false改为true</span></span><br><span class=\"line\">            </span><br><span class=\"line\">[<span class=\"string\">plugins.&quot;io.containerd.tracing.processor.v1.otlp&quot;</span>]</span><br><span class=\"line\">    <span class=\"string\">endpoint</span> <span class=\"string\">=</span> <span class=\"string\">&quot;https://registry.aliyuncs.com&quot;</span> <span class=\"comment\">#阿里云镜像</span></span><br><span class=\"line\">    <span class=\"string\">insecure</span> <span class=\"string\">=</span> <span class=\"literal\">false</span></span><br><span class=\"line\">    <span class=\"string\">protocol</span> <span class=\"string\">=</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">[<span class=\"string\">plugins.&quot;io.containerd.grpc.v1.cri&quot;</span>]</span><br><span class=\"line\">    <span class=\"string\">netns_mounts_under_state_dir</span> <span class=\"string\">=</span> <span class=\"literal\">false</span></span><br><span class=\"line\">    <span class=\"string\">restrict_oom_score_adj</span> <span class=\"string\">=</span> <span class=\"literal\">false</span></span><br><span class=\"line\">    <span class=\"comment\">#sandbox_image = &quot;k8s.gcr.io/pause:3.6&quot;</span></span><br><span class=\"line\">    <span class=\"string\">sandbox_image</span> <span class=\"string\">=</span> <span class=\"string\">&quot;registry.aliyuncs.com/google_containers/pause:3.8&quot;</span> <span class=\"comment\"># 修改成这样</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">重启containerd</span></span><br><span class=\"line\">systemctl daemon-reload</span><br><span class=\"line\">systemctl restart containerd</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"安装nerdctl\"><a href=\"#安装nerdctl\" class=\"headerlink\" title=\"安装nerdctl\"></a>安装nerdctl</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">下载精简版</span></span><br><span class=\"line\">wget https://github.com/containerd/nerdctl/releases/download/v1.0.0/nerdctl-1.0.0-linux-amd64.tar.gz</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">解压到/usr/local/bin</span></span><br><span class=\"line\">tar Cxzvvf /usr/local/bin nerdctl-1.0.0-linux-amd64.tar.gz</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装Kubernetes\"><a href=\"#安装Kubernetes\" class=\"headerlink\" title=\"安装Kubernetes\"></a>安装Kubernetes</h3><h4 id=\"设置每台机器的hostname以及hosts\"><a href=\"#设置每台机器的hostname以及hosts\" class=\"headerlink\" title=\"设置每台机器的hostname以及hosts\"></a>设置每台机器的hostname以及hosts</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">设置每个机器自己的hostname</span></span><br><span class=\"line\">hostnamectl set-hostname cfc-master</span><br><span class=\"line\">hostnamectl set-hostname cfc-node1</span><br><span class=\"line\">hostnamectl set-hostname cfc-node2</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">hosts</span></span><br><span class=\"line\">vim /etc/hosts</span><br><span class=\"line\"></span><br><span class=\"line\">172.16.0.4      cfc-master</span><br><span class=\"line\">172.16.0.120    cfc-node1</span><br><span class=\"line\">172.16.0.104    cfc-node2</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"关闭swap\"><a href=\"#关闭swap\" class=\"headerlink\" title=\"关闭swap\"></a>关闭swap</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">swapoff -a</span><br><span class=\"line\">sed -i &#x27;s/.*swap.*/#&amp;/&#x27; /etc/fstab</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"允许-iptables-检查桥接流量\"><a href=\"#允许-iptables-检查桥接流量\" class=\"headerlink\" title=\"允许 iptables 检查桥接流量\"></a>允许 iptables 检查桥接流量</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">允许 iptables 检查桥接流量</span></span><br><span class=\"line\">cat &lt;&lt;EOF | sudo tee /etc/modules-load.d/k8s.conf</span><br><span class=\"line\">br_netfilter</span><br><span class=\"line\">EOF</span><br><span class=\"line\"></span><br><span class=\"line\">cat &lt;&lt;EOF | sudo tee /etc/sysctl.d/k8s.conf</span><br><span class=\"line\">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class=\"line\">net.bridge.bridge-nf-call-iptables = 1</span><br><span class=\"line\">EOF</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">让配置生效</span></span><br><span class=\"line\">sudo sysctl --system</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"设置时区\"><a href=\"#设置时区\" class=\"headerlink\" title=\"设置时区\"></a>设置时区</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">timedatectl set-timezone Asia/Shanghai</span><br><span class=\"line\">systemctl restart rsyslog</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"配置k8s的yum源地址\"><a href=\"#配置k8s的yum源地址\" class=\"headerlink\" title=\"配置k8s的yum源地址\"></a>配置k8s的yum源地址</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat &lt;&lt;EOF | sudo tee /etc/yum.repos.d/kubernetes.repo</span><br><span class=\"line\">[kubernetes]</span><br><span class=\"line\">name=Kubernetes</span><br><span class=\"line\">baseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64</span><br><span class=\"line\">enabled=1</span><br><span class=\"line\">gpgcheck=0</span><br><span class=\"line\">repo_gpgcheck=0</span><br><span class=\"line\">gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg</span><br><span class=\"line\">   http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br><span class=\"line\">EOF</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"安装kubelet、kubeadm、kubectl\"><a href=\"#安装kubelet、kubeadm、kubectl\" class=\"headerlink\" title=\"安装kubelet、kubeadm、kubectl\"></a>安装kubelet、kubeadm、kubectl</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">指定版本安装</span></span><br><span class=\"line\">yum install -y kubelet-1.24.8 kubeadm-1.24.8 kubectl-1.24.8</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">设置启动</span></span><br><span class=\"line\">systemctl enable --now kubelet</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"初始化master节点\"><a href=\"#初始化master节点\" class=\"headerlink\" title=\"初始化master节点\"></a>初始化master节点</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubeadm init \\</span><br><span class=\"line\">--apiserver-advertise-address=172.16.0.4 \\</span><br><span class=\"line\">--control-plane-endpoint=cfc-master \\</span><br><span class=\"line\">--image-repository registry.aliyuncs.com/google_containers \\</span><br><span class=\"line\">--kubernetes-version v1.24.8 \\</span><br><span class=\"line\">--service-cidr=10.96.0.0/16 \\</span><br><span class=\"line\">--pod-network-cidr=192.168.0.0/16</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">重置命令 如果有问题的话</span></span><br><span class=\"line\">kubeadm reset</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"初始化结果\"><a href=\"#初始化结果\" class=\"headerlink\" title=\"初始化结果\"></a>初始化结果</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Your Kubernetes control-plane has initialized successfully!</span><br><span class=\"line\"></span><br><span class=\"line\">To start using your cluster, you need to run the following as a regular user:</span><br><span class=\"line\"></span><br><span class=\"line\">  mkdir -p $HOME/.kube</span><br><span class=\"line\">  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br><span class=\"line\">  sudo chown $(id -u):$(id -g) $HOME/.kube/config</span><br><span class=\"line\"></span><br><span class=\"line\">Alternatively, if you are the root user, you can run:</span><br><span class=\"line\"></span><br><span class=\"line\">  export KUBECONFIG=/etc/kubernetes/admin.conf</span><br><span class=\"line\"></span><br><span class=\"line\">You should now deploy a pod network to the cluster.</span><br><span class=\"line\">Run &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at:</span><br><span class=\"line\">  https://kubernetes.io/docs/concepts/cluster-administration/addons/</span><br><span class=\"line\"></span><br><span class=\"line\">You can now join any number of control-plane nodes by copying certificate authorities</span><br><span class=\"line\">and service account keys on each node and then running the following as root:</span><br><span class=\"line\"></span><br><span class=\"line\">  kubeadm join cfc-master:6443 --token ubt61k.dql9idffl61rbj27 \\</span><br><span class=\"line\">\t--discovery-token-ca-cert-hash sha256:45f8fe633b9711e94b78fa485f74519d96d08bd380d76d78324e800dbb82a76d \\</span><br><span class=\"line\">\t--control-plane </span><br><span class=\"line\"></span><br><span class=\"line\">Then you can join any number of worker nodes by running the following on each as root:</span><br><span class=\"line\"></span><br><span class=\"line\">kubeadm join cfc-master:6443 --token ubt61k.dql9idffl61rbj27 --discovery-token-ca-cert-hash sha256:45f8fe633b9711e94b78fa485f74519d96d08bd380d76d78324e800dbb82a76d</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">执行以下命令</span></span><br><span class=\"line\">echo &quot;export KUBECONFIG=/etc/kubernetes/admin.conf&quot; &gt;&gt; /etc/profile</span><br><span class=\"line\">追加到profile文件中</span><br><span class=\"line\">source /etc/profile</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"安装calico网络插件\"><a href=\"#安装calico网络插件\" class=\"headerlink\" title=\"安装calico网络插件\"></a>安装calico网络插件</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://docs.projectcalico.org/manifests/calico.yaml</span><br><span class=\"line\"></span><br><span class=\"line\">在</span><br><span class=\"line\">- name: CLUSTER_TYPE</span><br><span class=\"line\">  value: &quot;k8s,bgp&quot; </span><br><span class=\"line\">下增加两行</span><br><span class=\"line\">- name: IP_AUTODETECTION_METHOD</span><br><span class=\"line\">  value: &quot;interface=eth0&quot;</span><br><span class=\"line\">  </span><br><span class=\"line\">kubectl apply -f calico.yaml</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"加入worker节点\"><a href=\"#加入worker节点\" class=\"headerlink\" title=\"加入worker节点\"></a>加入worker节点</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubeadm join cfc-master:6443 --token ubt61k.dql9idffl61rbj27 --discovery-token-ca-cert-hash sha256:45f8fe633b9711e94b78fa485f74519d96d08bd380d76d78324e800dbb82a76d</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装KubeSphere前置环境\"><a href=\"#安装KubeSphere前置环境\" class=\"headerlink\" title=\"安装KubeSphere前置环境\"></a>安装KubeSphere前置环境</h3><h4 id=\"安装nfs-server\"><a href=\"#安装nfs-server\" class=\"headerlink\" title=\"安装nfs-server\"></a>安装nfs-server</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">在每个机器。</span></span><br><span class=\"line\">yum install -y nfs-utils</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">在master 执行以下命令</span> </span><br><span class=\"line\">echo &quot;/nfs/data/ *(insecure,rw,sync,no_root_squash)&quot; &gt; /etc/exports</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">执行以下命令，启动 nfs 服务;创建共享目录</span></span><br><span class=\"line\">mkdir -p /nfs/data</span><br><span class=\"line\"></span><br><span class=\"line\">systemctl enable rpcbind</span><br><span class=\"line\">systemctl enable nfs-server</span><br><span class=\"line\">systemctl start rpcbind</span><br><span class=\"line\">systemctl start nfs-server</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">使配置生效</span></span><br><span class=\"line\">exportfs -r</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">检查配置是否生效</span></span><br><span class=\"line\">exportfs</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"配置nfs-client\"><a href=\"#配置nfs-client\" class=\"headerlink\" title=\"配置nfs-client\"></a>配置nfs-client</h5><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">在node节点上执行以下命令</span></span><br><span class=\"line\">showmount -e 172.16.0.4</span><br><span class=\"line\"></span><br><span class=\"line\">mkdir -p /nfs/data</span><br><span class=\"line\"></span><br><span class=\"line\">mount -t nfs 172.16.0.4:/nfs/data /nfs/data</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"配置默认存储\"><a href=\"#配置默认存储\" class=\"headerlink\" title=\"配置默认存储\"></a>配置默认存储</h5><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi sc.yaml</span><br></pre></td></tr></table></figure>\n\n<p>sc.yaml内容如下</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">## 创建了一个存储类</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">storage.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">StorageClass</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">nfs-storage</span></span><br><span class=\"line\">  <span class=\"attr\">annotations:</span></span><br><span class=\"line\">    <span class=\"attr\">storageclass.kubernetes.io/is-default-class:</span> <span class=\"string\">&quot;true&quot;</span></span><br><span class=\"line\"><span class=\"attr\">provisioner:</span> <span class=\"string\">k8s-sigs.io/nfs-subdir-external-provisioner</span></span><br><span class=\"line\"><span class=\"attr\">parameters:</span></span><br><span class=\"line\">  <span class=\"attr\">archiveOnDelete:</span> <span class=\"string\">&quot;true&quot;</span>  <span class=\"comment\">## 删除pv的时候，pv的内容是否要备份</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">nfs-client-provisioner</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">nfs-client-provisioner</span></span><br><span class=\"line\">  <span class=\"comment\"># replace with namespace where provisioner is deployed</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">default</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"attr\">strategy:</span></span><br><span class=\"line\">    <span class=\"attr\">type:</span> <span class=\"string\">Recreate</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">nfs-client-provisioner</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">nfs-client-provisioner</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">serviceAccountName:</span> <span class=\"string\">nfs-client-provisioner</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">nfs-client-provisioner</span></span><br><span class=\"line\">          <span class=\"attr\">image:</span> <span class=\"string\">registry.cn-hangzhou.aliyuncs.com/lfy_k8s_images/nfs-subdir-external-provisioner:v4.0.2</span></span><br><span class=\"line\">          <span class=\"comment\"># resources:</span></span><br><span class=\"line\">          <span class=\"comment\">#    limits:</span></span><br><span class=\"line\">          <span class=\"comment\">#      cpu: 10m</span></span><br><span class=\"line\">          <span class=\"comment\">#    requests:</span></span><br><span class=\"line\">          <span class=\"comment\">#      cpu: 10m</span></span><br><span class=\"line\">          <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">nfs-client-root</span></span><br><span class=\"line\">              <span class=\"attr\">mountPath:</span> <span class=\"string\">/persistentvolumes</span></span><br><span class=\"line\">          <span class=\"attr\">env:</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">PROVISIONER_NAME</span></span><br><span class=\"line\">              <span class=\"attr\">value:</span> <span class=\"string\">k8s-sigs.io/nfs-subdir-external-provisioner</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">NFS_SERVER</span></span><br><span class=\"line\">              <span class=\"attr\">value:</span> <span class=\"number\">172.16</span><span class=\"number\">.0</span><span class=\"number\">.4</span> <span class=\"comment\">## 指定自己nfs服务器地址</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">NFS_PATH</span>  </span><br><span class=\"line\">              <span class=\"attr\">value:</span> <span class=\"string\">/nfs/data</span>  <span class=\"comment\">## nfs服务器共享的目录</span></span><br><span class=\"line\">      <span class=\"attr\">volumes:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">nfs-client-root</span></span><br><span class=\"line\">          <span class=\"attr\">nfs:</span></span><br><span class=\"line\">            <span class=\"attr\">server:</span> <span class=\"number\">172.16</span><span class=\"number\">.0</span><span class=\"number\">.4</span></span><br><span class=\"line\">            <span class=\"attr\">path:</span> <span class=\"string\">/nfs/data</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">nfs-client-provisioner</span></span><br><span class=\"line\">  <span class=\"comment\"># replace with namespace where provisioner is deployed</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">default</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ClusterRole</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">nfs-client-provisioner-runner</span></span><br><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span> [<span class=\"string\">&quot;&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">resources:</span> [<span class=\"string\">&quot;nodes&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">verbs:</span> [<span class=\"string\">&quot;get&quot;</span>, <span class=\"string\">&quot;list&quot;</span>, <span class=\"string\">&quot;watch&quot;</span>]</span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span> [<span class=\"string\">&quot;&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">resources:</span> [<span class=\"string\">&quot;persistentvolumes&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">verbs:</span> [<span class=\"string\">&quot;get&quot;</span>, <span class=\"string\">&quot;list&quot;</span>, <span class=\"string\">&quot;watch&quot;</span>, <span class=\"string\">&quot;create&quot;</span>, <span class=\"string\">&quot;delete&quot;</span>]</span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span> [<span class=\"string\">&quot;&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">resources:</span> [<span class=\"string\">&quot;persistentvolumeclaims&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">verbs:</span> [<span class=\"string\">&quot;get&quot;</span>, <span class=\"string\">&quot;list&quot;</span>, <span class=\"string\">&quot;watch&quot;</span>, <span class=\"string\">&quot;update&quot;</span>]</span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span> [<span class=\"string\">&quot;storage.k8s.io&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">resources:</span> [<span class=\"string\">&quot;storageclasses&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">verbs:</span> [<span class=\"string\">&quot;get&quot;</span>, <span class=\"string\">&quot;list&quot;</span>, <span class=\"string\">&quot;watch&quot;</span>]</span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span> [<span class=\"string\">&quot;&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">resources:</span> [<span class=\"string\">&quot;events&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">verbs:</span> [<span class=\"string\">&quot;create&quot;</span>, <span class=\"string\">&quot;update&quot;</span>, <span class=\"string\">&quot;patch&quot;</span>]</span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ClusterRoleBinding</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">run-nfs-client-provisioner</span></span><br><span class=\"line\"><span class=\"attr\">subjects:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">nfs-client-provisioner</span></span><br><span class=\"line\">    <span class=\"comment\"># replace with namespace where provisioner is deployed</span></span><br><span class=\"line\">    <span class=\"attr\">namespace:</span> <span class=\"string\">default</span></span><br><span class=\"line\"><span class=\"attr\">roleRef:</span></span><br><span class=\"line\">  <span class=\"attr\">kind:</span> <span class=\"string\">ClusterRole</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">nfs-client-provisioner-runner</span></span><br><span class=\"line\">  <span class=\"attr\">apiGroup:</span> <span class=\"string\">rbac.authorization.k8s.io</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Role</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">leader-locking-nfs-client-provisioner</span></span><br><span class=\"line\">  <span class=\"comment\"># replace with namespace where provisioner is deployed</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">default</span></span><br><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span> [<span class=\"string\">&quot;&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">resources:</span> [<span class=\"string\">&quot;endpoints&quot;</span>]</span><br><span class=\"line\">    <span class=\"attr\">verbs:</span> [<span class=\"string\">&quot;get&quot;</span>, <span class=\"string\">&quot;list&quot;</span>, <span class=\"string\">&quot;watch&quot;</span>, <span class=\"string\">&quot;create&quot;</span>, <span class=\"string\">&quot;update&quot;</span>, <span class=\"string\">&quot;patch&quot;</span>]</span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">RoleBinding</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">leader-locking-nfs-client-provisioner</span></span><br><span class=\"line\">  <span class=\"comment\"># replace with namespace where provisioner is deployed</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">default</span></span><br><span class=\"line\"><span class=\"attr\">subjects:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">nfs-client-provisioner</span></span><br><span class=\"line\">    <span class=\"comment\"># replace with namespace where provisioner is deployed</span></span><br><span class=\"line\">    <span class=\"attr\">namespace:</span> <span class=\"string\">default</span></span><br><span class=\"line\"><span class=\"attr\">roleRef:</span></span><br><span class=\"line\">  <span class=\"attr\">kind:</span> <span class=\"string\">Role</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">leader-locking-nfs-client-provisioner</span></span><br><span class=\"line\">  <span class=\"attr\">apiGroup:</span> <span class=\"string\">rbac.authorization.k8s.io</span></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"应用并检查是否生效\"><a href=\"#应用并检查是否生效\" class=\"headerlink\" title=\"应用并检查是否生效\"></a>应用并检查是否生效</h5><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">应用sc.yaml</span></span><br><span class=\"line\">kubectl apply -f sc.yaml</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">确认配置是否生效</span></span><br><span class=\"line\">kubectl get sc</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"安装metrics-server\"><a href=\"#安装metrics-server\" class=\"headerlink\" title=\"安装metrics-server\"></a>安装metrics-server</h4><p>集群指标监控组件</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vi metrics.yaml</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"metrics-yaml文件内容如下\"><a href=\"#metrics-yaml文件内容如下\" class=\"headerlink\" title=\"metrics.yaml文件内容如下\"></a>metrics.yaml文件内容如下</h5><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kube-system</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ClusterRole</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">    <span class=\"attr\">rbac.authorization.k8s.io/aggregate-to-admin:</span> <span class=\"string\">&quot;true&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">rbac.authorization.k8s.io/aggregate-to-edit:</span> <span class=\"string\">&quot;true&quot;</span></span><br><span class=\"line\">    <span class=\"attr\">rbac.authorization.k8s.io/aggregate-to-view:</span> <span class=\"string\">&quot;true&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">system:aggregated-metrics-reader</span></span><br><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">metrics.k8s.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">pods</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">nodes</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">get</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">list</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">watch</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ClusterRole</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">system:metrics-server</span></span><br><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">pods</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">nodes</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">nodes/stats</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">namespaces</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">configmaps</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">get</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">list</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">watch</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">RoleBinding</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">metrics-server-auth-reader</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kube-system</span></span><br><span class=\"line\"><span class=\"attr\">roleRef:</span></span><br><span class=\"line\">  <span class=\"attr\">apiGroup:</span> <span class=\"string\">rbac.authorization.k8s.io</span></span><br><span class=\"line\">  <span class=\"attr\">kind:</span> <span class=\"string\">Role</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">extension-apiserver-authentication-reader</span></span><br><span class=\"line\"><span class=\"attr\">subjects:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kube-system</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ClusterRoleBinding</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">metrics-server:system:auth-delegator</span></span><br><span class=\"line\"><span class=\"attr\">roleRef:</span></span><br><span class=\"line\">  <span class=\"attr\">apiGroup:</span> <span class=\"string\">rbac.authorization.k8s.io</span></span><br><span class=\"line\">  <span class=\"attr\">kind:</span> <span class=\"string\">ClusterRole</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">system:auth-delegator</span></span><br><span class=\"line\"><span class=\"attr\">subjects:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kube-system</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ClusterRoleBinding</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">system:metrics-server</span></span><br><span class=\"line\"><span class=\"attr\">roleRef:</span></span><br><span class=\"line\">  <span class=\"attr\">apiGroup:</span> <span class=\"string\">rbac.authorization.k8s.io</span></span><br><span class=\"line\">  <span class=\"attr\">kind:</span> <span class=\"string\">ClusterRole</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">system:metrics-server</span></span><br><span class=\"line\"><span class=\"attr\">subjects:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kube-system</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Service</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kube-system</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">ports:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">https</span></span><br><span class=\"line\">    <span class=\"attr\">port:</span> <span class=\"number\">443</span></span><br><span class=\"line\">    <span class=\"attr\">protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\">    <span class=\"attr\">targetPort:</span> <span class=\"string\">https</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kube-system</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">strategy:</span></span><br><span class=\"line\">    <span class=\"attr\">rollingUpdate:</span></span><br><span class=\"line\">      <span class=\"attr\">maxUnavailable:</span> <span class=\"number\">0</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">args:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">--cert-dir=/tmp</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">--kubelet-insecure-tls</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">--secure-port=4443</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">--kubelet-preferred-address-types=InternalIP,ExternalIP,Hostname</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"string\">--kubelet-use-node-status-port</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">registry.cn-hangzhou.aliyuncs.com/lfy_k8s_images/metrics-server:v0.4.3</span></span><br><span class=\"line\">        <span class=\"attr\">imagePullPolicy:</span> <span class=\"string\">IfNotPresent</span></span><br><span class=\"line\">        <span class=\"attr\">livenessProbe:</span></span><br><span class=\"line\">          <span class=\"attr\">failureThreshold:</span> <span class=\"number\">3</span></span><br><span class=\"line\">          <span class=\"attr\">httpGet:</span></span><br><span class=\"line\">            <span class=\"attr\">path:</span> <span class=\"string\">/livez</span></span><br><span class=\"line\">            <span class=\"attr\">port:</span> <span class=\"string\">https</span></span><br><span class=\"line\">            <span class=\"attr\">scheme:</span> <span class=\"string\">HTTPS</span></span><br><span class=\"line\">          <span class=\"attr\">periodSeconds:</span> <span class=\"number\">10</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">        <span class=\"attr\">ports:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">containerPort:</span> <span class=\"number\">4443</span></span><br><span class=\"line\">          <span class=\"attr\">name:</span> <span class=\"string\">https</span></span><br><span class=\"line\">          <span class=\"attr\">protocol:</span> <span class=\"string\">TCP</span></span><br><span class=\"line\">        <span class=\"attr\">readinessProbe:</span></span><br><span class=\"line\">          <span class=\"attr\">failureThreshold:</span> <span class=\"number\">3</span></span><br><span class=\"line\">          <span class=\"attr\">httpGet:</span></span><br><span class=\"line\">            <span class=\"attr\">path:</span> <span class=\"string\">/readyz</span></span><br><span class=\"line\">            <span class=\"attr\">port:</span> <span class=\"string\">https</span></span><br><span class=\"line\">            <span class=\"attr\">scheme:</span> <span class=\"string\">HTTPS</span></span><br><span class=\"line\">          <span class=\"attr\">periodSeconds:</span> <span class=\"number\">10</span></span><br><span class=\"line\">        <span class=\"attr\">securityContext:</span></span><br><span class=\"line\">          <span class=\"attr\">readOnlyRootFilesystem:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">          <span class=\"attr\">runAsNonRoot:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">          <span class=\"attr\">runAsUser:</span> <span class=\"number\">1000</span></span><br><span class=\"line\">        <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">mountPath:</span> <span class=\"string\">/tmp</span></span><br><span class=\"line\">          <span class=\"attr\">name:</span> <span class=\"string\">tmp-dir</span></span><br><span class=\"line\">      <span class=\"attr\">nodeSelector:</span></span><br><span class=\"line\">        <span class=\"attr\">kubernetes.io/os:</span> <span class=\"string\">linux</span></span><br><span class=\"line\">      <span class=\"attr\">priorityClassName:</span> <span class=\"string\">system-cluster-critical</span></span><br><span class=\"line\">      <span class=\"attr\">serviceAccountName:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">      <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">emptyDir:</span> &#123;&#125;</span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">tmp-dir</span></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apiregistration.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">APIService</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">k8s-app:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">v1beta1.metrics.k8s.io</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">group:</span> <span class=\"string\">metrics.k8s.io</span></span><br><span class=\"line\">  <span class=\"attr\">groupPriorityMinimum:</span> <span class=\"number\">100</span></span><br><span class=\"line\">  <span class=\"attr\">insecureSkipTLSVerify:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">service:</span></span><br><span class=\"line\">    <span class=\"attr\">name:</span> <span class=\"string\">metrics-server</span></span><br><span class=\"line\">    <span class=\"attr\">namespace:</span> <span class=\"string\">kube-system</span></span><br><span class=\"line\">  <span class=\"attr\">version:</span> <span class=\"string\">v1beta1</span></span><br><span class=\"line\">  <span class=\"attr\">versionPriority:</span> <span class=\"number\">100</span></span><br></pre></td></tr></table></figure>\n\n<h5 id=\"应用metrics-yaml\"><a href=\"#应用metrics-yaml\" class=\"headerlink\" title=\"应用metrics.yaml\"></a>应用metrics.yaml</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl apply -f metrics.yaml</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"检查是否生效\"><a href=\"#检查是否生效\" class=\"headerlink\" title=\"检查是否生效\"></a>检查是否生效</h5><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl top nodes</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"安装KubeSphere\"><a href=\"#安装KubeSphere\" class=\"headerlink\" title=\"安装KubeSphere\"></a>安装KubeSphere</h3><h4 id=\"下载核心文件\"><a href=\"#下载核心文件\" class=\"headerlink\" title=\"下载核心文件\"></a>下载核心文件</h4><h5 id=\"下载kubesphere-installer-yaml\"><a href=\"#下载kubesphere-installer-yaml\" class=\"headerlink\" title=\"下载kubesphere-installer.yaml\"></a>下载kubesphere-installer.yaml</h5><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://github.com/kubesphere/ks-installer/releases/download/v3.3.1/kubesphere-installer.yaml</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">或者自行下载然后创建</span></span><br><span class=\"line\">vi kubesphere-installer.yaml</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apiextensions.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">CustomResourceDefinition</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">clusterconfigurations.installer.kubesphere.io</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">group:</span> <span class=\"string\">installer.kubesphere.io</span></span><br><span class=\"line\">  <span class=\"attr\">versions:</span></span><br><span class=\"line\">    <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">v1alpha1</span></span><br><span class=\"line\">      <span class=\"attr\">served:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      <span class=\"attr\">storage:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      <span class=\"attr\">schema:</span></span><br><span class=\"line\">        <span class=\"attr\">openAPIV3Schema:</span></span><br><span class=\"line\">          <span class=\"attr\">type:</span> <span class=\"string\">object</span></span><br><span class=\"line\">          <span class=\"attr\">properties:</span></span><br><span class=\"line\">            <span class=\"attr\">spec:</span></span><br><span class=\"line\">              <span class=\"attr\">type:</span> <span class=\"string\">object</span></span><br><span class=\"line\">              <span class=\"attr\">x-kubernetes-preserve-unknown-fields:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">            <span class=\"attr\">status:</span></span><br><span class=\"line\">              <span class=\"attr\">type:</span> <span class=\"string\">object</span></span><br><span class=\"line\">              <span class=\"attr\">x-kubernetes-preserve-unknown-fields:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">scope:</span> <span class=\"string\">Namespaced</span></span><br><span class=\"line\">  <span class=\"attr\">names:</span></span><br><span class=\"line\">    <span class=\"attr\">plural:</span> <span class=\"string\">clusterconfigurations</span></span><br><span class=\"line\">    <span class=\"attr\">singular:</span> <span class=\"string\">clusterconfiguration</span></span><br><span class=\"line\">    <span class=\"attr\">kind:</span> <span class=\"string\">ClusterConfiguration</span></span><br><span class=\"line\">    <span class=\"attr\">shortNames:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"string\">cc</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Namespace</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">kubesphere-system</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">ks-installer</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kubesphere-system</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ClusterRole</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">ks-installer</span></span><br><span class=\"line\"><span class=\"attr\">rules:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">apps</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">extensions</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">batch</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">rbac.authorization.k8s.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">apiregistration.k8s.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">apiextensions.k8s.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">tenant.kubesphere.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">certificates.k8s.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">devops.kubesphere.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">monitoring.coreos.com</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">logging.kubesphere.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">jaegertracing.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">storage.k8s.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">admissionregistration.k8s.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">policy</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">autoscaling</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">networking.istio.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">config.istio.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">iam.kubesphere.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">notification.kubesphere.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">auditing.kubesphere.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">events.kubesphere.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">core.kubefed.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">installer.kubesphere.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">storage.kubesphere.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">security.istio.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">monitoring.kiali.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">kiali.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">networking.k8s.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">edgeruntime.kubesphere.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">types.kubefed.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">monitoring.kubesphere.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">apiGroups:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">application.kubesphere.io</span></span><br><span class=\"line\">  <span class=\"attr\">resources:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">verbs:</span></span><br><span class=\"line\">  <span class=\"bullet\">-</span> <span class=\"string\">&#x27;*&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ClusterRoleBinding</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">rbac.authorization.k8s.io/v1</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">ks-installer</span></span><br><span class=\"line\"><span class=\"attr\">subjects:</span></span><br><span class=\"line\"><span class=\"bullet\">-</span> <span class=\"attr\">kind:</span> <span class=\"string\">ServiceAccount</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">ks-installer</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kubesphere-system</span></span><br><span class=\"line\"><span class=\"attr\">roleRef:</span></span><br><span class=\"line\">  <span class=\"attr\">kind:</span> <span class=\"string\">ClusterRole</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">ks-installer</span></span><br><span class=\"line\">  <span class=\"attr\">apiGroup:</span> <span class=\"string\">rbac.authorization.k8s.io</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">apps/v1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">Deployment</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">ks-installer</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kubesphere-system</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">app:</span> <span class=\"string\">ks-installer</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">replicas:</span> <span class=\"number\">1</span></span><br><span class=\"line\">  <span class=\"attr\">selector:</span></span><br><span class=\"line\">    <span class=\"attr\">matchLabels:</span></span><br><span class=\"line\">      <span class=\"attr\">app:</span> <span class=\"string\">ks-installer</span></span><br><span class=\"line\">  <span class=\"attr\">template:</span></span><br><span class=\"line\">    <span class=\"attr\">metadata:</span></span><br><span class=\"line\">      <span class=\"attr\">labels:</span></span><br><span class=\"line\">        <span class=\"attr\">app:</span> <span class=\"string\">ks-installer</span></span><br><span class=\"line\">    <span class=\"attr\">spec:</span></span><br><span class=\"line\">      <span class=\"attr\">serviceAccountName:</span> <span class=\"string\">ks-installer</span></span><br><span class=\"line\">      <span class=\"attr\">containers:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">installer</span></span><br><span class=\"line\">        <span class=\"attr\">image:</span> <span class=\"string\">kubesphere/ks-installer:v3.3.1</span></span><br><span class=\"line\">        <span class=\"attr\">imagePullPolicy:</span> <span class=\"string\">&quot;Always&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">resources:</span></span><br><span class=\"line\">          <span class=\"attr\">limits:</span></span><br><span class=\"line\">            <span class=\"attr\">cpu:</span> <span class=\"string\">&quot;1&quot;</span></span><br><span class=\"line\">            <span class=\"attr\">memory:</span> <span class=\"string\">1Gi</span></span><br><span class=\"line\">          <span class=\"attr\">requests:</span></span><br><span class=\"line\">            <span class=\"attr\">cpu:</span> <span class=\"string\">20m</span></span><br><span class=\"line\">            <span class=\"attr\">memory:</span> <span class=\"string\">100Mi</span></span><br><span class=\"line\">        <span class=\"attr\">volumeMounts:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">mountPath:</span> <span class=\"string\">/etc/localtime</span></span><br><span class=\"line\">          <span class=\"attr\">name:</span> <span class=\"string\">host-time</span></span><br><span class=\"line\">          <span class=\"attr\">readOnly:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      <span class=\"attr\">volumes:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">hostPath:</span></span><br><span class=\"line\">          <span class=\"attr\">path:</span> <span class=\"string\">/etc/localtime</span></span><br><span class=\"line\">          <span class=\"attr\">type:</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">name:</span> <span class=\"string\">host-time</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n\n\n<h5 id=\"下载cluster-configuration-yaml\"><a href=\"#下载cluster-configuration-yaml\" class=\"headerlink\" title=\"下载cluster-configuration.yaml\"></a>下载cluster-configuration.yaml</h5><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wget https://github.com/kubesphere/ks-installer/releases/download/v3.3.1/cluster-configuration.yaml</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">或者自行下载然后创建</span></span><br><span class=\"line\">vi cluster-configuration.yaml</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"修改后的cluster-configuration-yaml\"><a href=\"#修改后的cluster-configuration-yaml\" class=\"headerlink\" title=\"修改后的cluster-configuration.yaml\"></a>修改后的cluster-configuration.yaml</h5><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">---</span></span><br><span class=\"line\"><span class=\"attr\">apiVersion:</span> <span class=\"string\">installer.kubesphere.io/v1alpha1</span></span><br><span class=\"line\"><span class=\"attr\">kind:</span> <span class=\"string\">ClusterConfiguration</span></span><br><span class=\"line\"><span class=\"attr\">metadata:</span></span><br><span class=\"line\">  <span class=\"attr\">name:</span> <span class=\"string\">ks-installer</span></span><br><span class=\"line\">  <span class=\"attr\">namespace:</span> <span class=\"string\">kubesphere-system</span></span><br><span class=\"line\">  <span class=\"attr\">labels:</span></span><br><span class=\"line\">    <span class=\"attr\">version:</span> <span class=\"string\">v3.3.1</span></span><br><span class=\"line\"><span class=\"attr\">spec:</span></span><br><span class=\"line\">  <span class=\"attr\">persistence:</span></span><br><span class=\"line\">    <span class=\"attr\">storageClass:</span> <span class=\"string\">&quot;&quot;</span>        <span class=\"comment\"># If there is no default StorageClass in your cluster, you need to specify an existing StorageClass here.</span></span><br><span class=\"line\">  <span class=\"attr\">authentication:</span></span><br><span class=\"line\">    <span class=\"comment\"># adminPassword: &quot;&quot;     # Custom password of the admin user. If the parameter exists but the value is empty, a random password is generated. If the parameter does not exist, P@88w0rd is used.</span></span><br><span class=\"line\">    <span class=\"attr\">jwtSecret:</span> <span class=\"string\">&quot;&quot;</span>           <span class=\"comment\"># Keep the jwtSecret consistent with the Host Cluster. Retrieve the jwtSecret by executing &quot;kubectl -n kubesphere-system get cm kubesphere-config -o yaml | grep -v &quot;apiVersion&quot; | grep jwtSecret&quot; on the Host Cluster.</span></span><br><span class=\"line\">  <span class=\"attr\">local_registry:</span> <span class=\"string\">&quot;&quot;</span>        <span class=\"comment\"># Add your private registry address if it is needed.</span></span><br><span class=\"line\">  <span class=\"comment\"># dev_tag: &quot;&quot;               # Add your kubesphere image tag you want to install, by default it&#x27;s same as ks-installer release version.</span></span><br><span class=\"line\">  <span class=\"attr\">etcd:</span></span><br><span class=\"line\">    <span class=\"attr\">monitoring:</span> <span class=\"literal\">false</span>       <span class=\"comment\"># Enable or disable etcd monitoring dashboard installation. You have to create a Secret for etcd before you enable it.</span></span><br><span class=\"line\">    <span class=\"attr\">endpointIps:</span> <span class=\"number\">172.16</span><span class=\"number\">.0</span><span class=\"number\">.4</span>  <span class=\"comment\"># etcd cluster EndpointIps. It can be a bunch of IPs here.</span></span><br><span class=\"line\">    <span class=\"attr\">port:</span> <span class=\"number\">2379</span>              <span class=\"comment\"># etcd port.</span></span><br><span class=\"line\">    <span class=\"attr\">tlsEnable:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">  <span class=\"attr\">common:</span></span><br><span class=\"line\">    <span class=\"attr\">core:</span></span><br><span class=\"line\">      <span class=\"attr\">console:</span></span><br><span class=\"line\">        <span class=\"attr\">enableMultiLogin:</span> <span class=\"literal\">true</span>  <span class=\"comment\"># Enable or disable simultaneous logins. It allows different users to log in with the same account at the same time.</span></span><br><span class=\"line\">        <span class=\"attr\">port:</span> <span class=\"number\">30880</span></span><br><span class=\"line\">        <span class=\"attr\">type:</span> <span class=\"string\">NodePort</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># apiserver:            # Enlarge the apiserver and controller manager&#x27;s resource requests and limits for the large cluster</span></span><br><span class=\"line\">    <span class=\"comment\">#  resources: &#123;&#125;</span></span><br><span class=\"line\">    <span class=\"comment\"># controllerManager:</span></span><br><span class=\"line\">    <span class=\"comment\">#  resources: &#123;&#125;</span></span><br><span class=\"line\">    <span class=\"attr\">redis:</span></span><br><span class=\"line\">      <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      <span class=\"attr\">enableHA:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">      <span class=\"attr\">volumeSize:</span> <span class=\"string\">2Gi</span> <span class=\"comment\"># Redis PVC size.</span></span><br><span class=\"line\">    <span class=\"attr\">openldap:</span></span><br><span class=\"line\">      <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      <span class=\"attr\">volumeSize:</span> <span class=\"string\">2Gi</span>   <span class=\"comment\"># openldap PVC size.</span></span><br><span class=\"line\">    <span class=\"attr\">minio:</span></span><br><span class=\"line\">      <span class=\"attr\">volumeSize:</span> <span class=\"string\">20Gi</span> <span class=\"comment\"># Minio PVC size.</span></span><br><span class=\"line\">    <span class=\"attr\">monitoring:</span></span><br><span class=\"line\">      <span class=\"comment\"># type: external   # Whether to specify the external prometheus stack, and need to modify the endpoint at the next line.</span></span><br><span class=\"line\">      <span class=\"attr\">endpoint:</span> <span class=\"string\">http://prometheus-operated.kubesphere-monitoring-system.svc:9090</span> <span class=\"comment\"># Prometheus endpoint to get metrics data.</span></span><br><span class=\"line\">      <span class=\"attr\">GPUMonitoring:</span>     <span class=\"comment\"># Enable or disable the GPU-related metrics. If you enable this switch but have no GPU resources, Kubesphere will set it to zero.</span></span><br><span class=\"line\">        <span class=\"attr\">enabled:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">    <span class=\"attr\">gpu:</span>                 <span class=\"comment\"># Install GPUKinds. The default GPU kind is nvidia.com/gpu. Other GPU kinds can be added here according to your needs.</span></span><br><span class=\"line\">      <span class=\"attr\">kinds:</span></span><br><span class=\"line\">      <span class=\"bullet\">-</span> <span class=\"attr\">resourceName:</span> <span class=\"string\">&quot;nvidia.com/gpu&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">resourceType:</span> <span class=\"string\">&quot;GPU&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">default:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    <span class=\"attr\">es:</span>   <span class=\"comment\"># Storage backend for logging, events and auditing.</span></span><br><span class=\"line\">      <span class=\"comment\"># master:</span></span><br><span class=\"line\">      <span class=\"comment\">#   volumeSize: 4Gi  # The volume size of Elasticsearch master nodes.</span></span><br><span class=\"line\">      <span class=\"comment\">#   replicas: 1      # The total number of master nodes. Even numbers are not allowed.</span></span><br><span class=\"line\">      <span class=\"comment\">#   resources: &#123;&#125;</span></span><br><span class=\"line\">      <span class=\"comment\"># data:</span></span><br><span class=\"line\">      <span class=\"comment\">#   volumeSize: 20Gi  # The volume size of Elasticsearch data nodes.</span></span><br><span class=\"line\">      <span class=\"comment\">#   replicas: 1       # The total number of data nodes.</span></span><br><span class=\"line\">      <span class=\"comment\">#   resources: &#123;&#125;</span></span><br><span class=\"line\">      <span class=\"attr\">logMaxAge:</span> <span class=\"number\">7</span>             <span class=\"comment\"># Log retention time in built-in Elasticsearch. It is 7 days by default.</span></span><br><span class=\"line\">      <span class=\"attr\">elkPrefix:</span> <span class=\"string\">logstash</span>      <span class=\"comment\"># The string making up index names. The index name will be formatted as ks-&lt;elk_prefix&gt;-log.</span></span><br><span class=\"line\">      <span class=\"attr\">basicAuth:</span></span><br><span class=\"line\">        <span class=\"attr\">enabled:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">        <span class=\"attr\">username:</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">        <span class=\"attr\">password:</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">      <span class=\"attr\">externalElasticsearchHost:</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">      <span class=\"attr\">externalElasticsearchPort:</span> <span class=\"string\">&quot;&quot;</span></span><br><span class=\"line\">  <span class=\"attr\">alerting:</span>                <span class=\"comment\"># (CPU: 0.1 Core, Memory: 100 MiB) It enables users to customize alerting policies to send messages to receivers in time with different time intervals and alerting levels to choose from.</span></span><br><span class=\"line\">    <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span>         <span class=\"comment\"># Enable or disable the KubeSphere Alerting System.</span></span><br><span class=\"line\">    <span class=\"comment\"># thanosruler:</span></span><br><span class=\"line\">    <span class=\"comment\">#   replicas: 1</span></span><br><span class=\"line\">    <span class=\"comment\">#   resources: &#123;&#125;</span></span><br><span class=\"line\">  <span class=\"attr\">auditing:</span>                <span class=\"comment\"># Provide a security-relevant chronological set of records，recording the sequence of activities happening on the platform, initiated by different tenants.</span></span><br><span class=\"line\">    <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span>         <span class=\"comment\"># Enable or disable the KubeSphere Auditing Log System.</span></span><br><span class=\"line\">    <span class=\"comment\"># operator:</span></span><br><span class=\"line\">    <span class=\"comment\">#   resources: &#123;&#125;</span></span><br><span class=\"line\">    <span class=\"comment\"># webhook:</span></span><br><span class=\"line\">    <span class=\"comment\">#   resources: &#123;&#125;</span></span><br><span class=\"line\">  <span class=\"attr\">devops:</span>                  <span class=\"comment\"># (CPU: 0.47 Core, Memory: 8.6 G) Provide an out-of-the-box CI/CD system based on Jenkins, and automated workflow tools including Source-to-Image &amp; Binary-to-Image.</span></span><br><span class=\"line\">    <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span>             <span class=\"comment\"># Enable or disable the KubeSphere DevOps System.</span></span><br><span class=\"line\">    <span class=\"comment\"># resources: &#123;&#125;</span></span><br><span class=\"line\">    <span class=\"attr\">jenkinsMemoryLim:</span> <span class=\"string\">8Gi</span>      <span class=\"comment\"># Jenkins memory limit.</span></span><br><span class=\"line\">    <span class=\"attr\">jenkinsMemoryReq:</span> <span class=\"string\">4Gi</span>   <span class=\"comment\"># Jenkins memory request.</span></span><br><span class=\"line\">    <span class=\"attr\">jenkinsVolumeSize:</span> <span class=\"string\">8Gi</span>     <span class=\"comment\"># Jenkins volume size.</span></span><br><span class=\"line\">  <span class=\"attr\">events:</span>                  <span class=\"comment\"># Provide a graphical web console for Kubernetes Events exporting, filtering and alerting in multi-tenant Kubernetes clusters.</span></span><br><span class=\"line\">    <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span>         <span class=\"comment\"># Enable or disable the KubeSphere Events System.</span></span><br><span class=\"line\">    <span class=\"comment\"># operator:</span></span><br><span class=\"line\">    <span class=\"comment\">#   resources: &#123;&#125;</span></span><br><span class=\"line\">    <span class=\"comment\"># exporter:</span></span><br><span class=\"line\">    <span class=\"comment\">#   resources: &#123;&#125;</span></span><br><span class=\"line\">    <span class=\"comment\"># ruler:</span></span><br><span class=\"line\">    <span class=\"comment\">#   enabled: true</span></span><br><span class=\"line\">    <span class=\"comment\">#   replicas: 2</span></span><br><span class=\"line\">    <span class=\"comment\">#   resources: &#123;&#125;</span></span><br><span class=\"line\">  <span class=\"attr\">logging:</span>                 <span class=\"comment\"># (CPU: 57 m, Memory: 2.76 G) Flexible logging functions are provided for log query, collection and management in a unified console. Additional log collectors can be added, such as Elasticsearch, Kafka and Fluentd.</span></span><br><span class=\"line\">    <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span>         <span class=\"comment\"># Enable or disable the KubeSphere Logging System.</span></span><br><span class=\"line\">    <span class=\"attr\">logsidecar:</span></span><br><span class=\"line\">      <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span></span><br><span class=\"line\">      <span class=\"attr\">replicas:</span> <span class=\"number\">2</span></span><br><span class=\"line\">      <span class=\"comment\"># resources: &#123;&#125;</span></span><br><span class=\"line\">  <span class=\"attr\">metrics_server:</span>                    <span class=\"comment\"># (CPU: 56 m, Memory: 44.35 MiB) It enables HPA (Horizontal Pod Autoscaler).</span></span><br><span class=\"line\">    <span class=\"attr\">enabled:</span> <span class=\"literal\">false</span>                   <span class=\"comment\"># Enable or disable metrics-server.</span></span><br><span class=\"line\">  <span class=\"attr\">monitoring:</span></span><br><span class=\"line\">    <span class=\"attr\">storageClass:</span> <span class=\"string\">&quot;&quot;</span>                 <span class=\"comment\"># If there is an independent StorageClass you need for Prometheus, you can specify it here. The default StorageClass is used by default.</span></span><br><span class=\"line\">    <span class=\"attr\">node_exporter:</span></span><br><span class=\"line\">      <span class=\"attr\">port:</span> <span class=\"number\">9100</span></span><br><span class=\"line\">      <span class=\"comment\"># resources: &#123;&#125;</span></span><br><span class=\"line\">    <span class=\"comment\"># kube_rbac_proxy:</span></span><br><span class=\"line\">    <span class=\"comment\">#   resources: &#123;&#125;</span></span><br><span class=\"line\">    <span class=\"comment\"># kube_state_metrics:</span></span><br><span class=\"line\">    <span class=\"comment\">#   resources: &#123;&#125;</span></span><br><span class=\"line\">    <span class=\"comment\"># prometheus:</span></span><br><span class=\"line\">    <span class=\"comment\">#   replicas: 1  # Prometheus replicas are responsible for monitoring different segments of data source and providing high availability.</span></span><br><span class=\"line\">    <span class=\"comment\">#   volumeSize: 20Gi  # Prometheus PVC size.</span></span><br><span class=\"line\">    <span class=\"comment\">#   resources: &#123;&#125;</span></span><br><span class=\"line\">    <span class=\"comment\">#   operator:</span></span><br><span class=\"line\">    <span class=\"comment\">#     resources: &#123;&#125;</span></span><br><span class=\"line\">    <span class=\"comment\"># alertmanager:</span></span><br><span class=\"line\">    <span class=\"comment\">#   replicas: 1          # AlertManager Replicas.</span></span><br><span class=\"line\">    <span class=\"comment\">#   resources: &#123;&#125;</span></span><br><span class=\"line\">    <span class=\"comment\"># notification_manager:</span></span><br><span class=\"line\">    <span class=\"comment\">#   resources: &#123;&#125;</span></span><br><span class=\"line\">    <span class=\"comment\">#   operator:</span></span><br><span class=\"line\">    <span class=\"comment\">#     resources: &#123;&#125;</span></span><br><span class=\"line\">    <span class=\"comment\">#   proxy:</span></span><br><span class=\"line\">    <span class=\"comment\">#     resources: &#123;&#125;</span></span><br><span class=\"line\">    <span class=\"attr\">gpu:</span>                           <span class=\"comment\"># GPU monitoring-related plug-in installation.</span></span><br><span class=\"line\">      <span class=\"attr\">nvidia_dcgm_exporter:</span>        <span class=\"comment\"># Ensure that gpu resources on your hosts can be used normally, otherwise this plug-in will not work properly.</span></span><br><span class=\"line\">        <span class=\"attr\">enabled:</span> <span class=\"literal\">false</span>             <span class=\"comment\"># Check whether the labels on the GPU hosts contain &quot;nvidia.com/gpu.present=true&quot; to ensure that the DCGM pod is scheduled to these nodes.</span></span><br><span class=\"line\">        <span class=\"comment\"># resources: &#123;&#125;</span></span><br><span class=\"line\">  <span class=\"attr\">multicluster:</span></span><br><span class=\"line\">    <span class=\"attr\">clusterRole:</span> <span class=\"string\">none</span>  <span class=\"comment\"># host | member | none  # You can install a solo cluster, or specify it as the Host or Member Cluster.</span></span><br><span class=\"line\">  <span class=\"attr\">network:</span></span><br><span class=\"line\">    <span class=\"attr\">networkpolicy:</span> <span class=\"comment\"># Network policies allow network isolation within the same cluster, which means firewalls can be set up between certain instances (Pods).</span></span><br><span class=\"line\">      <span class=\"comment\"># Make sure that the CNI network plugin used by the cluster supports NetworkPolicy. There are a number of CNI network plugins that support NetworkPolicy, including Calico, Cilium, Kube-router, Romana and Weave Net.</span></span><br><span class=\"line\">      <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span> <span class=\"comment\"># Enable or disable network policies.</span></span><br><span class=\"line\">    <span class=\"attr\">ippool:</span> <span class=\"comment\"># Use Pod IP Pools to manage the Pod network address space. Pods to be created can be assigned IP addresses from a Pod IP Pool.</span></span><br><span class=\"line\">      <span class=\"attr\">type:</span> <span class=\"string\">none</span> <span class=\"comment\"># Specify &quot;calico&quot; for this field if Calico is used as your CNI plugin. &quot;none&quot; means that Pod IP Pools are disabled.</span></span><br><span class=\"line\">    <span class=\"attr\">topology:</span> <span class=\"comment\"># Use Service Topology to view Service-to-Service communication based on Weave Scope.</span></span><br><span class=\"line\">      <span class=\"attr\">type:</span> <span class=\"string\">none</span> <span class=\"comment\"># Specify &quot;weave-scope&quot; for this field to enable Service Topology. &quot;none&quot; means that Service Topology is disabled.</span></span><br><span class=\"line\">  <span class=\"attr\">openpitrix:</span> <span class=\"comment\"># An App Store that is accessible to all platform tenants. You can use it to manage apps across their entire lifecycle.</span></span><br><span class=\"line\">    <span class=\"attr\">store:</span></span><br><span class=\"line\">      <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span> <span class=\"comment\"># Enable or disable the KubeSphere App Store.</span></span><br><span class=\"line\">  <span class=\"attr\">servicemesh:</span>         <span class=\"comment\"># (0.3 Core, 300 MiB) Provide fine-grained traffic management, observability and tracing, and visualized traffic topology.</span></span><br><span class=\"line\">    <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span>     <span class=\"comment\"># Base component (pilot). Enable or disable KubeSphere Service Mesh (Istio-based).</span></span><br><span class=\"line\">    <span class=\"attr\">istio:</span>  <span class=\"comment\"># Customizing the istio installation configuration, refer to https://istio.io/latest/docs/setup/additional-setup/customize-installation/</span></span><br><span class=\"line\">      <span class=\"attr\">components:</span></span><br><span class=\"line\">        <span class=\"attr\">ingressGateways:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">name:</span> <span class=\"string\">istio-ingressgateway</span></span><br><span class=\"line\">          <span class=\"attr\">enabled:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">        <span class=\"attr\">cni:</span></span><br><span class=\"line\">          <span class=\"attr\">enabled:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">  <span class=\"attr\">edgeruntime:</span>          <span class=\"comment\"># Add edge nodes to your cluster and deploy workloads on edge nodes.</span></span><br><span class=\"line\">    <span class=\"attr\">enabled:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">    <span class=\"attr\">kubeedge:</span>        <span class=\"comment\"># kubeedge configurations</span></span><br><span class=\"line\">      <span class=\"attr\">enabled:</span> <span class=\"literal\">false</span></span><br><span class=\"line\">      <span class=\"attr\">cloudCore:</span></span><br><span class=\"line\">        <span class=\"attr\">cloudHub:</span></span><br><span class=\"line\">          <span class=\"attr\">advertiseAddress:</span> <span class=\"comment\"># At least a public IP address or an IP address which can be accessed by edge nodes must be provided.</span></span><br><span class=\"line\">            <span class=\"bullet\">-</span> <span class=\"string\">&quot;&quot;</span>            <span class=\"comment\"># Note that once KubeEdge is enabled, CloudCore will malfunction if the address is not provided.</span></span><br><span class=\"line\">        <span class=\"attr\">service:</span></span><br><span class=\"line\">          <span class=\"attr\">cloudhubNodePort:</span> <span class=\"string\">&quot;30000&quot;</span></span><br><span class=\"line\">          <span class=\"attr\">cloudhubQuicNodePort:</span> <span class=\"string\">&quot;30001&quot;</span></span><br><span class=\"line\">          <span class=\"attr\">cloudhubHttpsNodePort:</span> <span class=\"string\">&quot;30002&quot;</span></span><br><span class=\"line\">          <span class=\"attr\">cloudstreamNodePort:</span> <span class=\"string\">&quot;30003&quot;</span></span><br><span class=\"line\">          <span class=\"attr\">tunnelNodePort:</span> <span class=\"string\">&quot;30004&quot;</span></span><br><span class=\"line\">        <span class=\"comment\"># resources: &#123;&#125;</span></span><br><span class=\"line\">        <span class=\"comment\"># hostNetWork: false</span></span><br><span class=\"line\">      <span class=\"attr\">iptables-manager:</span></span><br><span class=\"line\">        <span class=\"attr\">enabled:</span> <span class=\"literal\">true</span> </span><br><span class=\"line\">        <span class=\"attr\">mode:</span> <span class=\"string\">&quot;external&quot;</span></span><br><span class=\"line\">        <span class=\"comment\"># resources: &#123;&#125;</span></span><br><span class=\"line\">      <span class=\"comment\"># edgeService:</span></span><br><span class=\"line\">      <span class=\"comment\">#   resources: &#123;&#125;</span></span><br><span class=\"line\">  <span class=\"attr\">gatekeeper:</span>        <span class=\"comment\"># Provide admission policy and rule management, A validating (mutating TBA) webhook that enforces CRD-based policies executed by Open Policy Agent.</span></span><br><span class=\"line\">    <span class=\"attr\">enabled:</span> <span class=\"literal\">false</span>   <span class=\"comment\"># Enable or disable Gatekeeper.</span></span><br><span class=\"line\">    <span class=\"comment\"># controller_manager:</span></span><br><span class=\"line\">    <span class=\"comment\">#   resources: &#123;&#125;</span></span><br><span class=\"line\">    <span class=\"comment\"># audit:</span></span><br><span class=\"line\">    <span class=\"comment\">#   resources: &#123;&#125;</span></span><br><span class=\"line\">  <span class=\"attr\">terminal:</span></span><br><span class=\"line\">    <span class=\"comment\"># image: &#x27;alpine:3.15&#x27; # There must be an nsenter program in the image</span></span><br><span class=\"line\">    <span class=\"attr\">timeout:</span> <span class=\"number\">600</span>         <span class=\"comment\"># Container timeout, if set to 0, no timeout will be used. The unit is seconds</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<h4 id=\"执行安装\"><a href=\"#执行安装\" class=\"headerlink\" title=\"执行安装\"></a>执行安装</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl apply -f kubesphere-installer.yaml</span><br><span class=\"line\">kubectl apply -f cluster-configuration.yaml</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">如果出错 执行命令 删除后重新apply</span></span><br><span class=\"line\">kubectl delete -f kubesphere-installer.yaml</span><br><span class=\"line\">kubectl delete -f cluster-configuration.yaml</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"安装中的坑\"><a href=\"#安装中的坑\" class=\"headerlink\" title=\"安装中的坑\"></a>安装中的坑</h5><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">minio <span class=\"built_in\">timeout</span></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">修改</span></span><br><span class=\"line\">kubectl -n kube-system edit configmap coredns</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">注释掉下面的</span></span><br><span class=\"line\">forward . /etc/resolv.conf &#123;</span><br><span class=\"line\">max_concurrent 1000</span><br><span class=\"line\">&#125;        </span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">修改后重新执行</span></span><br><span class=\"line\">kubectl apply -f kubesphere-installer.yaml</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">执行完成后 恢复到默认配置 然后再次执行</span></span><br><span class=\"line\">kubectl delete -f cluster-configuration.yaml</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"查看安装日志\"><a href=\"#查看安装日志\" class=\"headerlink\" title=\"查看安装日志\"></a>查看安装日志</h4><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">kubectl logs -n kubesphere-system $(kubectl get pod -n kubesphere-system -l &#x27;app in (ks-install, ks-installer)&#x27; -o jsonpath=&#x27;&#123;.items[0].metadata.name&#125;&#x27;) -f</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"安装成功\"><a href=\"#安装成功\" class=\"headerlink\" title=\"安装成功\"></a>安装成功</h4><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#####################################################</span><br><span class=\"line\">###              Welcome to KubeSphere!           ###</span><br><span class=\"line\">#####################################################</span><br><span class=\"line\"></span><br><span class=\"line\">Console: http://172.16.0.4:30880</span><br><span class=\"line\">Account: admin</span><br><span class=\"line\">Password: P@88w0rd</span><br><span class=\"line\">NOTES：</span><br><span class=\"line\">  1. After you log into the console, please check the</span><br><span class=\"line\">     monitoring status of service components in</span><br><span class=\"line\">     &quot;Cluster Management&quot;. If any service is not</span><br><span class=\"line\">     ready, please wait patiently until all components </span><br><span class=\"line\">     are up and running.</span><br><span class=\"line\">  2. Please change the default password after login.</span><br><span class=\"line\"></span><br><span class=\"line\">#####################################################</span><br><span class=\"line\">https://kubesphere.io             2022-11-25 14:04:12</span><br><span class=\"line\">#####################################################</span><br></pre></td></tr></table></figure>\n\n\n\n"}],"PostAsset":[],"PostCategory":[{"post_id":"clch7zqnc0001gcv0dp07gjgl","category_id":"clch7zqne0002gcv0gtkue90y","_id":"clch7zqnf0003gcv06ce1c1jg"}],"PostTag":[],"Tag":[]}}